<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Kernels for <span class="caps">GP</span> Modelling in&nbsp;PyMC4.</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="Tirth Patel">

    <!-- Le styles -->
    <link rel="stylesheet" href="/theme/css/bootstrap.min.css" type="text/css" />
    <style type="text/css">
      body {
        padding-top: 60px;
        padding-bottom: 40px;
      }
      .sidebar-nav {
        padding: 9px 0;
      }
      .tag-1 {
        font-size: 13pt;
      }
      .tag-2 {
        font-size: 10pt;
      }
      .tag-2 {
        font-size: 8pt;
      }
      .tag-4 {
        font-size: 6pt;
     }
    </style>
    <link href="/theme/css/bootstrap-responsive.min.css" rel="stylesheet">
        <link href="/theme/css/font-awesome.css" rel="stylesheet">

    <link href="/theme/css/pygments.css" rel="stylesheet">

    <!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="//html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le fav and touch icons -->
    <link rel="shortcut icon" href="/theme/images/favicon.ico">
    <link rel="apple-touch-icon" href="/theme/images/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/theme/images/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/theme/images/apple-touch-icon-114x114.png">

    <link href="/" type="application/atom+xml" rel="alternate" title="Tirth Patel ATOM Feed" />

  </head>

  <body>

    <div class="navbar navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container-fluid">
          <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </a>
          <a class="brand" href="/index.html">Tirth Patel </a>
          <div class="nav-collapse">
            <ul class="nav">
                <li><a href="/about/">About</a></li>
                <li><a href="/gsoc-2020/">GSoC&nbsp;2020</a></li>
                <li><a href="/gsoc-2021/">GSoC&nbsp;2021</a></li>
                          <li class="divider-vertical"></li>

                          <ul class="nav pull-right">
                                <li><a href="/archives.html"><i class="icon-th-list"></i>Archives</a></li>
                          </ul>

            </ul>
            <!--<p class="navbar-text pull-right">Logged in as <a href="#">username</a></p>-->
          </div><!--/.nav-collapse -->
        </div>
      </div>
    </div>

    <div class="container-fluid">
      <div class="row">
        <div class="span9" id="content">
<section id="content">
        <article>
                <div class="alert">
                        <span class="closebtn" onclick="this.parentElement.style.display='none';">&times;</span>
                        <strong>Note</strong>: This article has been migrated from my previous website without modification; some
                        images might be missing or be disproportionately large.
                </div>
                <header>
                        <h1>
                                <a href=""
                                        rel="bookmark"
                                        title="Permalink to Kernels for GP Modelling in PyMC4.">
                                        Kernels for <span class="caps">GP</span> Modelling in&nbsp;PyMC4.
                                </a>
                        </h1>
                </header>
                <div class="entry-content">
                <div class="well">
<footer class="post-info">
<span class="label">Date</span>
<abbr class="published" title="2020-07-03T00:00:00+05:30">
        <i class="icon-calendar"></i>Fri 03 July 2020
</abbr>
<span class="label">By</span>
<a href="/author/tirth-patel/"><i class="icon-user"></i>Tirth Patel</a>
<span class="label">Category</span>
<a href="/category/gsoc-2020/"><i class="icon-folder-open"></i>GSoC 2020</a>.


<span class="label">Tags</span>
	<a href="/tag/machine-learning/"><i class="icon-tag"></i>machine learning</a>
	<a href="/tag/gsoc-2020/"><i class="icon-tag"></i>gsoc 2020</a>
	<a href="/tag/gaussian-processes/"><i class="icon-tag"></i>gaussian processes</a>
</footer><!-- /.post-info -->                </div>
                <h1>Kernels for <span class="caps">GP</span> Modelling in&nbsp;PyMC4.</h1>
<p>In this tutorial, we will explore the covariance functions aka kernels present in <code>pm.gp</code> module and study their properties. This will help choose the appropriate kernel to model your data properly. We will also see the semantics of additive and multiplicative&nbsp;kernels.</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">arviz</span> <span class="k">as</span> <span class="nn">az</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">matplotlib.cm</span> <span class="k">as</span> <span class="nn">cmap</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">import</span> <span class="nn">pymc4</span> <span class="k">as</span> <span class="nn">pm</span>
<span class="kn">from</span> <span class="nn">pymc4.gp.cov</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">pymc4.gp.util</span> <span class="kn">import</span> <span class="n">stabilize</span>

<span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>

<span class="kn">from</span> <span class="nn">utils</span> <span class="kn">import</span> <span class="n">plot_samples</span><span class="p">,</span> <span class="n">plot_cov_matrix</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="o">%</span><span class="n">config</span> <span class="n">InlineBackend</span><span class="o">.</span><span class="n">figure_format</span> <span class="o">=</span> <span class="s1">&#39;retina&#39;</span>
<span class="n">RANDOM_SEED</span> <span class="o">=</span> <span class="mi">4200</span>
<span class="n">tf</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">set_seed</span><span class="p">(</span><span class="n">RANDOM_SEED</span><span class="p">)</span>
<span class="n">az</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s1">&#39;arviz-darkgrid&#39;</span><span class="p">)</span>
</code></pre></div>

<h2>Basic <span class="caps">API</span>&nbsp;Walkthrough</h2>
<p>Let&#8217;s start with a basic kernel called the constant kernel. Using this kernel, I will walk you through the basic <span class="caps">API</span> for working with any kernel function in <span class="caps">GP</span>.</p>
<p>The constant kernel just evaluates to a constant value in each entry of the covariance matrix irrespective of the input. It is very useful as a lightweight kernel when speed and performance is a primary goal. It doesn’t evaluate a complex function and so its gradients are faster and easier to&nbsp;compute.</p>
<p>The mathematical formula of the constant kernel is pretty straight&nbsp;forward:</p>
<div class="math">$$k(x, x') = c$$</div>
<p>The signature of the constant kernel implemented in <code>pymc4</code> is:</p>
<div class="highlight"><pre><span></span><code><span class="n">K</span> <span class="o">=</span> <span class="n">Constant</span><span class="p">(</span><span class="n">coef</span><span class="p">,</span> <span class="n">feature_ndims</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">active_dims</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">scale_diag</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</code></pre></div>

<p>The first argument <code>coef</code> to the constructor is the constant value <code>c</code> which represents the covariance between any two points. Thus, the covariance matrix just evaluates to this constant&nbsp;value.</p>
<p>The argument <code>feature_ndims</code> is the number of feature dimensions of the input between which you want to evaluate the covariance. We will see the effect of this argument&nbsp;later.</p>
<p>The third argument <code>active_dims</code> is the feature or the number of features of each of the <code>feature_ndims</code> number of feature dimensions that will be considered during the computation. We will explore this in detail&nbsp;later.</p>
<p>The last argument <code>scale_diag</code> is used to perform <strong>A</strong>utomatic <strong>R</strong>elevance <strong>D</strong>etermination (<span class="caps">ARD</span>) and is a scaling factor of the <code>length_scale</code> parameter of stationary covariance&nbsp;kernels.</p>
<p>One important boolean keyword argument is <code>ARD</code> that tells <code>pymc4</code> whether or not to perform <span class="caps">ARD</span> while modeling GPs. Its default value is <code>True</code>. A little overhead is incurred when <code>ARD</code> is&nbsp;enabled.</p>
<p>These four arguments <code>feature_ndims</code>, <code>active_dims</code>, <code>scale_diag</code>, and <code>ARD</code> are common in all the kernels implemented in <code>pymc4</code> and&nbsp;optional.</p>
<p>Other keywords arguments that can be passed are:
 - <code>validate_args</code>: A boolean indicating whether or not to validate arguments. Incurs a little overhead when set to <code>True</code>. Its default value is <code>False</code>.
 - <code>name</code>: You can optionally give a name to the kernels. All the operations will be preformed under that&nbsp;name.</p>
<div class="highlight"><pre><span></span><code><span class="n">coef</span> <span class="o">=</span> <span class="mf">1.0</span>

<span class="n">k</span> <span class="o">=</span> <span class="n">Constant</span><span class="p">(</span><span class="n">coef</span><span class="o">=</span><span class="n">coef</span><span class="p">,</span> <span class="n">ARD</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div>

<p>We can call the kernel object <code>k</code> to evaluate the covariance matrix between two arrays or tensors of points. It outputs a covariance matrix which is a <code>tf.Tensor</code> object.</p>
<p>It accepts any inputs with the shape of the form <code>(batch_shapes_1, m, features_1)</code> and <code>(batch_shapes_2, n, features_2)</code>. <code>batch_shapes_1</code> is the batch shape of the first tensor and <code>batch_shapes_2</code> is the batch shape of the second tensor. Multiple batches can be stacked together. Batch shapes must be equal or broadcastable according to the <a href="https://numpy.org/doc/stable/user/basics.broadcasting.html#general-broadcasting-rules">numpy&#8217;s rules for broadcasting</a>. <code>features_1</code> and <code>features_2</code> are the feature dimensions and their length must be equal to <code>feature_ndims</code>. The feature dimensions don&#8217;t need to be broadcastable. When the kernel object <code>k</code> is called on such inputs, it outputs a tensor of shape <code>(broadcasted_batch_shapes, m, n)</code> where <code>broadcasted_batch_shapes</code> is the broadcasted batch&nbsp;shape.</p>
<p>As an outer product is taken along all the entries of each <code>feature_ndims</code> dimensions, the output doesn&#8217;t contain these dimensions. Hence, having two feature dimensions of shape <code>(3, 3)</code> yields the same result as having a single feature dimension with all the <code>9</code> nine&nbsp;entries.</p>
<p>For example, take two inputs with the following&nbsp;shape:</p>
<div class="highlight"><pre><span></span><code>x1 has shape `(5, 4, 1, 40, 2, 2)`
x2 has shape `(5, 1, 3, 80, 2, 2)`
              |______| |__| |___|
                 |      |     |
       batch_shapes     |   feature_ndims
                      points
</code></pre></div>

<p>Such input will produce an output of&nbsp;shape:</p>
<div class="highlight"><pre><span></span><code>k(x1, x2) has shape `(5, 4, 3, 40, 80)`
                     |______| |__||__|
                        |      |   |
  broadcasted_batch_shapes     |   points in x2
                      points in x1
</code></pre></div>

<p>Let&#8217;s see some more&nbsp;examples</p>
<h4>Example 1 : Only one batch and one feature&nbsp;dimension.</h4>
<div class="highlight"><pre><span></span><code><span class="n">x1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">],</span> <span class="p">[</span><span class="mf">3.0</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">]])</span>
<span class="n">x2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">5.0</span><span class="p">,</span> <span class="mf">6.0</span><span class="p">],</span> <span class="p">[</span><span class="mf">7.0</span><span class="p">,</span> <span class="mf">8.0</span><span class="p">]])</span>

<span class="n">k</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">)</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="p">&lt;</span><span class="nx">tf</span><span class="p">.</span><span class="nx">Tensor</span><span class="p">:</span><span class="w"> </span><span class="nx">shape</span><span class="p">=(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">),</span><span class="w"> </span><span class="nx">dtype</span><span class="p">=</span><span class="nx">float32</span><span class="p">,</span><span class="w"> </span><span class="nx">numpy</span><span class="p">=</span>
<span class="nx">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">.,</span><span class="w"> </span><span class="mi">1</span><span class="p">.],</span>
<span class="w">        </span><span class="p">[</span><span class="mi">1</span><span class="p">.,</span><span class="w"> </span><span class="mi">1</span><span class="p">.]],</span><span class="w"> </span><span class="nx">dtype</span><span class="p">=</span><span class="nx">float32</span><span class="p">)&gt;</span>
</code></pre></div>

<h4>Example 2 : Multiple batch dimensions and one feature&nbsp;dimension</h4>
<p>Let&#8217;s batch two tensors of shape <code>(2, 2)</code> and call the kernel with&nbsp;that </p>
<div class="highlight"><pre><span></span><code><span class="n">batched_x1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">],</span> <span class="p">[</span><span class="mf">3.0</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">]],</span> <span class="p">[[</span><span class="mf">5.0</span><span class="p">,</span> <span class="mf">6.0</span><span class="p">],</span> <span class="p">[</span><span class="mf">7.0</span><span class="p">,</span> <span class="mf">8.0</span><span class="p">]]])</span>
<span class="n">batched_x2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[[</span><span class="mf">9.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">],</span> <span class="p">[</span><span class="mf">11.0</span><span class="p">,</span> <span class="mf">12.0</span><span class="p">]],</span> <span class="p">[[</span><span class="mf">13.0</span><span class="p">,</span> <span class="mf">14.0</span><span class="p">],</span> <span class="p">[</span><span class="mf">15.0</span><span class="p">,</span> <span class="mf">16.0</span><span class="p">]]])</span>

<span class="nb">print</span><span class="p">(</span><span class="n">batched_x1</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">batched_x2</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">k</span><span class="p">(</span><span class="n">batched_x1</span><span class="p">,</span> <span class="n">batched_x2</span><span class="p">))</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span>
<span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span>
<span class="nx">tf</span><span class="p">.</span><span class="nx">Tensor</span><span class="p">(</span>
<span class="p">[[[</span><span class="mi">1</span><span class="p">.</span><span class="w"> </span><span class="mi">1</span><span class="p">.]</span>
<span class="w">    </span><span class="p">[</span><span class="mi">1</span><span class="p">.</span><span class="w"> </span><span class="mi">1</span><span class="p">.]]</span>

<span class="w">    </span><span class="p">[[</span><span class="mi">1</span><span class="p">.</span><span class="w"> </span><span class="mi">1</span><span class="p">.]</span>
<span class="w">    </span><span class="p">[</span><span class="mi">1</span><span class="p">.</span><span class="w"> </span><span class="mi">1</span><span class="p">.]]],</span><span class="w"> </span><span class="nx">shape</span><span class="p">=(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">),</span><span class="w"> </span><span class="nx">dtype</span><span class="p">=</span><span class="nx">float32</span><span class="p">)</span>
</code></pre></div>

<h4>Example 3 : Multiple batches and feature&nbsp;dimensions</h4>
<p>The below example has 2 batch dimensions and 2 feature dimensions. So the output will have a shape with the first two dimensions being the batch dimensions and the other two dimensions being the number of examples in each tensor. The <code>feature_ndims</code> are absorbed during the&nbsp;computation.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Notice that the batch shape is broadcatable but the</span>
<span class="c1"># feature dimensions need not be broadcastable.</span>
<span class="n">batched_x1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">batched_x2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

<span class="n">k</span> <span class="o">=</span> <span class="n">Constant</span><span class="p">(</span><span class="n">coef</span><span class="o">=</span><span class="n">coef</span><span class="p">,</span> <span class="n">feature_ndims</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">ARD</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">batched_x1</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">batched_x2</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">k</span><span class="p">(</span><span class="n">batched_x1</span><span class="p">,</span> <span class="n">batched_x2</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code>(5, 4, 1, 40, 3, 3)
(5, 1, 3, 80, 2, 2)
(5, 4, 3, 40, 80)
</code></pre></div>

<p><strong>Note</strong>: It is not recommended to work with multiple feature dimensions as it incurs a substantial&nbsp;overhead.</p>
<div class="highlight"><pre><span></span><code><span class="o">%</span><span class="n">timeit</span> <span class="n">k</span><span class="p">(</span><span class="n">batched_x1</span><span class="p">,</span> <span class="n">batched_x2</span><span class="p">)</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="mf">2</span><span class="w"> </span><span class="n">ms</span><span class="w"> </span><span class="err">±</span><span class="w"> </span><span class="mf">56.8</span><span class="w"> </span><span class="n">µs</span><span class="w"> </span><span class="n">per</span><span class="w"> </span><span class="n">loop</span><span class="w"> </span><span class="p">(</span><span class="n">mean</span><span class="w"> </span><span class="err">±</span><span class="w"> </span><span class="n">std</span><span class="mf">.</span><span class="w"> </span><span class="n">dev</span><span class="mf">.</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="mf">7</span><span class="w"> </span><span class="kr">run</span><span class="n">s</span><span class="p">,</span><span class="w"> </span><span class="mf">100</span><span class="w"> </span><span class="n">loops</span><span class="w"> </span><span class="n">each</span><span class="p">)</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="c1"># Let&#39;s see how it performs with a single feature dimension.</span>

<span class="n">batched_x1</span> <span class="o">=</span> <span class="n">batched_x1</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>
<span class="n">batched_x2</span> <span class="o">=</span> <span class="n">batched_x2</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>

<span class="n">k</span> <span class="o">=</span> <span class="n">Constant</span><span class="p">(</span><span class="n">coef</span><span class="o">=</span><span class="n">coef</span><span class="p">,</span> <span class="n">feature_ndims</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ARD</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="o">%</span><span class="n">timeit</span> <span class="n">k</span><span class="p">(</span><span class="n">batched_x1</span><span class="p">,</span> <span class="n">batched_x2</span><span class="p">)</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="mf">2.01</span><span class="w"> </span><span class="n">ms</span><span class="w"> </span><span class="err">±</span><span class="w"> </span><span class="mf">54.8</span><span class="w"> </span><span class="n">µs</span><span class="w"> </span><span class="n">per</span><span class="w"> </span><span class="n">loop</span><span class="w"> </span><span class="p">(</span><span class="n">mean</span><span class="w"> </span><span class="err">±</span><span class="w"> </span><span class="n">std</span><span class="mf">.</span><span class="w"> </span><span class="n">dev</span><span class="mf">.</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="mf">7</span><span class="w"> </span><span class="kr">run</span><span class="n">s</span><span class="p">,</span><span class="w"> </span><span class="mf">100</span><span class="w"> </span><span class="n">loops</span><span class="w"> </span><span class="n">each</span><span class="p">)</span>
</code></pre></div>

<h4>Example 4: Active&nbsp;Dimensions</h4>
<p>Active dimensions are (as the name suggests) active dimensions of each feature dimension which will be used during the computation of the covariance matrix. This sounds too complicated but easy to understand with an example. Let&#8217;s say we have two feature dimensions of size <code>(10, )</code> and <code>(20, )</code>. This means that our input is going to be of shape <code>(..., m, 10, 20)</code> and <code>(..., n, 10, 20)</code>.</p>
<p>Active dimensions allows you to choose only those dimensions that you want the kernel to use to calculate the covariance matrix. For example, <code>active_dims=[5, 10]</code> means the first 5 entries of the first feature dimension and the first 10 entries of the second feature dimension will be used during the&nbsp;computation.</p>
<div class="highlight"><pre><span></span><code><span class="n">active_dims</span> <span class="o">=</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">]</span>

<span class="n">x1</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">))</span>
<span class="n">x2</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">((</span><span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">))</span>

<span class="n">k</span> <span class="o">=</span> <span class="n">ExpQuad</span><span class="p">(</span><span class="n">length_scale</span><span class="o">=</span><span class="mf">10.0</span><span class="p">,</span> <span class="n">feature_ndims</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">active_dims</span><span class="o">=</span><span class="n">active_dims</span><span class="p">,</span> <span class="n">ARD</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">k</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">)</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="p">&lt;</span><span class="nx">tf</span><span class="p">.</span><span class="nx">Tensor</span><span class="p">:</span><span class="w"> </span><span class="nx">shape</span><span class="p">=(</span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">),</span><span class="w"> </span><span class="nx">dtype</span><span class="p">=</span><span class="nx">float32</span><span class="p">,</span><span class="w"> </span><span class="nx">numpy</span><span class="p">=</span>
<span class="nx">array</span><span class="p">([[</span><span class="m m-Double">0.6</span><span class="mi">71924</span><span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="m m-Double">0.6</span><span class="mi">0107315</span><span class="p">,</span><span class="w"> </span><span class="m m-Double">0.6</span><span class="mi">406969</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="m m-Double">0.5</span><span class="mi">356703</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="m m-Double">0.6</span><span class="mi">1101484</span><span class="p">],</span>
<span class="w">        </span><span class="p">[</span><span class="m m-Double">0.6</span><span class="mi">593888</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="m m-Double">0.6</span><span class="mi">020972</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="m m-Double">0.6</span><span class="mi">8694246</span><span class="p">,</span><span class="w"> </span><span class="m m-Double">0.6</span><span class="mi">295366</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="m m-Double">0.5</span><span class="mi">677304</span><span class="w"> </span><span class="p">],</span>
<span class="w">        </span><span class="p">[</span><span class="m m-Double">0.6</span><span class="mi">531334</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="m m-Double">0.6</span><span class="mi">526655</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="m m-Double">0.6</span><span class="mi">5813994</span><span class="p">,</span><span class="w"> </span><span class="m m-Double">0.5</span><span class="mi">5865365</span><span class="p">,</span><span class="w"> </span><span class="m m-Double">0.5</span><span class="mi">552639</span><span class="w"> </span><span class="p">],</span>
<span class="w">        </span><span class="p">[</span><span class="m m-Double">0.6</span><span class="mi">973517</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="m m-Double">0.5</span><span class="mi">949804</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="m m-Double">0.6</span><span class="mi">89168</span><span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="m m-Double">0.6</span><span class="mi">187942</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="m m-Double">0.6</span><span class="mi">739167</span><span class="w"> </span><span class="p">]],</span>
<span class="w">        </span><span class="nx">dtype</span><span class="p">=</span><span class="nx">float32</span><span class="p">)&gt;</span>
</code></pre></div>

<p>You can also pick the entries you want to be active for each feature&nbsp;dimension.</p>
<p>For example, <code>active_dims=[[1, 4, 5], 10]</code> means 2&#8217;nd, 5&#8217;th, and 6&#8217;th entries are active in the first feature dimension and the first 10 entries are active in the second feature&nbsp;dimension.</p>
<div class="highlight"><pre><span></span><code><span class="n">active_dims</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span> <span class="mi">10</span><span class="p">]</span>

<span class="n">x1</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">))</span>
<span class="n">x2</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">((</span><span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">))</span>

<span class="n">k</span> <span class="o">=</span> <span class="n">ExpQuad</span><span class="p">(</span><span class="n">length_scale</span><span class="o">=</span><span class="mf">10.0</span><span class="p">,</span> <span class="n">feature_ndims</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">active_dims</span><span class="o">=</span><span class="n">active_dims</span><span class="p">,</span> <span class="n">ARD</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">k</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">)</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="p">&lt;</span><span class="nx">tf</span><span class="p">.</span><span class="nx">Tensor</span><span class="p">:</span><span class="w"> </span><span class="nx">shape</span><span class="p">=(</span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">),</span><span class="w"> </span><span class="nx">dtype</span><span class="p">=</span><span class="nx">float32</span><span class="p">,</span><span class="w"> </span><span class="nx">numpy</span><span class="p">=</span>
<span class="nx">array</span><span class="p">([[</span><span class="m m-Double">0.7</span><span class="mi">338076</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="m m-Double">0.7</span><span class="mi">271027</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="m m-Double">0.6</span><span class="mi">3948095</span><span class="p">,</span><span class="w"> </span><span class="m m-Double">0.7</span><span class="mi">4313736</span><span class="p">,</span><span class="w"> </span><span class="m m-Double">0.6</span><span class="mi">497098</span><span class="w"> </span><span class="p">],</span>
<span class="w">        </span><span class="p">[</span><span class="m m-Double">0.7</span><span class="mi">6253086</span><span class="p">,</span><span class="w"> </span><span class="m m-Double">0.7</span><span class="mi">478951</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="m m-Double">0.7</span><span class="mi">1348906</span><span class="p">,</span><span class="w"> </span><span class="m m-Double">0.7</span><span class="mi">848295</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="m m-Double">0.8</span><span class="mi">584582</span><span class="w"> </span><span class="p">],</span>
<span class="w">        </span><span class="p">[</span><span class="m m-Double">0.7</span><span class="mi">686134</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="m m-Double">0.7</span><span class="mi">458844</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="m m-Double">0.6</span><span class="mi">849413</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="m m-Double">0.8</span><span class="mi">28126</span><span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="m m-Double">0.7</span><span class="mi">4713683</span><span class="p">],</span>
<span class="w">        </span><span class="p">[</span><span class="m m-Double">0.7</span><span class="mi">5363666</span><span class="p">,</span><span class="w"> </span><span class="m m-Double">0.8</span><span class="mi">0211973</span><span class="p">,</span><span class="w"> </span><span class="m m-Double">0.6</span><span class="mi">4971805</span><span class="p">,</span><span class="w"> </span><span class="m m-Double">0.8</span><span class="mi">0924386</span><span class="p">,</span><span class="w"> </span><span class="m m-Double">0.7</span><span class="mi">4323034</span><span class="p">]],</span>
<span class="w">        </span><span class="nx">dtype</span><span class="p">=</span><span class="nx">float32</span><span class="p">)&gt;</span>
</code></pre></div>

<h3>Scale&nbsp;Diag</h3>
<p>This is the scaling factor for the <code>length_scale</code> parameter present in the stationary kernels that come from <code>Squared Exponential</code>, <code>Rational Quadratic</code>, <code>Matern</code>, and <code>Periodic</code> families. It is ignored if <code>ARD=False</code>. </p>
<p>It is used to perform Automatic Relevance Determination (<span class="caps">ARD</span>) on stationary kernels. This parameter can be inferred during sampling or <span class="caps">MAP</span>&nbsp;estimation. </p>
<div class="highlight"><pre><span></span><code><span class="n">x1</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">([[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">],</span> <span class="p">[</span><span class="mf">3.0</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">]])</span>
<span class="n">x2</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">([[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">],</span> <span class="p">[</span><span class="mf">3.0</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">]])</span>

<span class="n">k</span> <span class="o">=</span> <span class="n">ExpQuad</span><span class="p">(</span><span class="n">length_scale</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">feature_ndims</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ARD</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">k</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">))</span>

<span class="n">k</span> <span class="o">=</span> <span class="n">ExpQuad</span><span class="p">(</span><span class="n">length_scale</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">feature_ndims</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">scale_diag</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">ARD</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">k</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">))</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="nx">tf</span><span class="p">.</span><span class="nx">Tensor</span><span class="p">(</span>
<span class="p">[[</span><span class="mi">1</span><span class="p">.</span><span class="w">         </span><span class="m m-Double">0.0</span><span class="mi">1831564</span><span class="p">]</span>
<span class="w">    </span><span class="p">[</span><span class="m m-Double">0.0</span><span class="mi">1831564</span><span class="w"> </span><span class="mi">1</span><span class="p">.</span><span class="w">        </span><span class="p">]],</span><span class="w"> </span><span class="nx">shape</span><span class="p">=(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">),</span><span class="w"> </span><span class="nx">dtype</span><span class="p">=</span><span class="nx">float32</span><span class="p">)</span>
<span class="nx">tf</span><span class="p">.</span><span class="nx">Tensor</span><span class="p">(</span>
<span class="p">[[</span><span class="mi">1</span><span class="p">.</span><span class="w">         </span><span class="m m-Double">0.0</span><span class="mi">1831564</span><span class="p">]</span>
<span class="w">    </span><span class="p">[</span><span class="m m-Double">0.0</span><span class="mi">1831564</span><span class="w"> </span><span class="mi">1</span><span class="p">.</span><span class="w">        </span><span class="p">]],</span><span class="w"> </span><span class="nx">shape</span><span class="p">=(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">),</span><span class="w"> </span><span class="nx">dtype</span><span class="p">=</span><span class="nx">float32</span><span class="p">)</span>
</code></pre></div>

<p>As you can see, the off-diagonal entries got scaled by <code>2</code> because <code>scale_diag</code> was <code>2</code>.</p>
<h2>Stationary Kernels in&nbsp;PyMC4!</h2>
<p>PyMC4 implements 8 stationary kernels which are used extensively in Gaussian Process modeling. These kernels don&#8217;t change their parameter values at different points in&nbsp;space.</p>
<p>The stationary kernels implemented in PyMC4&nbsp;are:</p>
<ul>
<li><a href="#Constant-Kernel">Constant&nbsp;Kernel</a></li>
<li><a href="#White-Nosie-Kernel">White Noise&nbsp;Kernel</a></li>
<li><a href="#Exponential-Quadratic-Kernel">Exponential Quadratic&nbsp;Kernel</a></li>
<li><a href="#Rational-Quadratic-Kernel">Rational Quadratic&nbsp;Kernel</a></li>
<li><a href="#Matern-1/2-Kernel">Matern 1/2&nbsp;Kernel</a></li>
<li><a href="#Mtern-3/2-Kernel">Matern 3/2&nbsp;Kernel</a></li>
<li><a href="#Mtern-5/2-Kernel">Matern 5/3&nbsp;Kernel</a></li>
<li><a href="#Exponential-Kernel">Exponential&nbsp;Kernel</a></li>
</ul>
<h3>Constant&nbsp;Kernel</h3>
<p>As we have seen above, the constant kernel is a lightweight constant function and gradients are easy to calculate. Now, let&#8217;s look at the function space and the covariance&nbsp;matrix.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># This is a batch of coefficients. You can batch several</span>
<span class="c1"># constant kernels together for fast vectorized computations.</span>
<span class="n">coefs</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>

<span class="n">k</span> <span class="o">=</span> <span class="n">Constant</span><span class="p">(</span><span class="n">coef</span><span class="o">=</span><span class="n">coefs</span><span class="p">,</span> <span class="n">ARD</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="mi">100</span><span class="p">)[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>

<span class="c1"># We stabilize the kernel to make it Positive Semi-Definite.</span>
<span class="c1"># It just adds a small shift to the diagonal entries and is</span>
<span class="c1"># necessary to sample from the MvNormal distribution.</span>
<span class="n">covs</span> <span class="o">=</span> <span class="n">stabilize</span><span class="p">(</span><span class="n">k</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">),</span> <span class="n">shift</span><span class="o">=</span><span class="mf">1e-13</span><span class="p">)</span>
<span class="n">dists</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">MvNormal</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">covariance_matrix</span><span class="o">=</span><span class="n">covs</span><span class="p">)</span>
<span class="n">samples</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">dists</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">perm</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="n">plot_samples</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">samples</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">coefs</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="s2">&quot;coef&quot;</span><span class="p">)</span>
</code></pre></div>

<p><img alt="png" src="/images/GP-Kernels_files/GP-Kernels_26_0.png"></p>
<div class="highlight"><pre><span></span><code><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">X2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">x1</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">40</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">x2</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">40</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">coef</span> <span class="o">=</span> <span class="p">[</span><span class="mf">5.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">]</span>
<span class="n">k</span> <span class="o">=</span> <span class="n">Constant</span><span class="p">(</span><span class="n">coef</span><span class="o">=</span><span class="n">coef</span><span class="p">,</span> <span class="n">ARD</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">plot_cov_matrix</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">X2</span><span class="p">,</span> <span class="p">[</span><span class="n">coef</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;coef&quot;</span><span class="p">])</span>
</code></pre></div>

<p><img alt="png" src="/images/GP-Kernels_files/GP-Kernels_27_0.png"></p>
<h3>White Noise&nbsp;Kernel</h3>
<p>This kernel adds some noise to the covariance functions and is mostly
used to stabilize other Positive Semi-Definite (<span class="caps">PSD</span>) kernels. This helps them become non-singular
and makes cholesky decomposition possible for sampling from the
<code>MvNormalCholesky</code> distribution. It is recommended to use this kernel in
combination with other covariance/kernel function when working with <span class="caps">GP</span> on
large&nbsp;data.</p>
<div class="math">$$
X(x_i, x_j) =
\begin{cases}
  \eta^2,  &amp;   i = j \\
  0,       &amp;   \text{otherwise}
\end{cases}
$$</div>
<p>where <span class="math">\(\eta^2\)</span> is &#8216;noise level&#8217; or simply&nbsp;noise.</p>
<p>The signature of <code>WhiteNoise</code> kernel implemented in <code>pymc4</code> is:</p>
<div class="highlight"><pre><span></span><code><span class="n">k</span> <span class="o">=</span> <span class="n">WhiteNoise</span><span class="p">(</span><span class="n">noise</span><span class="p">,</span> <span class="n">feature_ndims</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">active_dims</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">scale_diag</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="n">noises</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">([</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">,</span> <span class="mf">2.1</span><span class="p">])</span>

<span class="n">k</span> <span class="o">=</span> <span class="n">WhiteNoise</span><span class="p">(</span><span class="n">noise</span><span class="o">=</span><span class="n">noises</span><span class="p">,</span> <span class="n">ARD</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="mi">500</span><span class="p">)[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>

<span class="n">covs</span> <span class="o">=</span> <span class="n">stabilize</span><span class="p">(</span><span class="n">k</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">),</span> <span class="n">shift</span><span class="o">=</span><span class="mf">1e-6</span><span class="p">)</span>
<span class="n">dists</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">MvNormal</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">covariance_matrix</span><span class="o">=</span><span class="n">covs</span><span class="p">)</span>
<span class="n">samples</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">dists</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">perm</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="n">plot_samples</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">samples</span><span class="p">,</span> <span class="n">noises</span><span class="p">,</span> <span class="s2">&quot;$</span><span class="se">\\</span><span class="s2">eta$&quot;</span><span class="p">)</span>
</code></pre></div>

<p><img alt="png" src="/images/GP-Kernels_files/GP-Kernels_31_0.png"></p>
<div class="highlight"><pre><span></span><code><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">X2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">x1</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">40</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">x2</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">40</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">noise</span> <span class="o">=</span> <span class="p">[</span><span class="mf">5.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">]</span>
<span class="n">k</span> <span class="o">=</span> <span class="n">WhiteNoise</span><span class="p">(</span><span class="n">noise</span><span class="o">=</span><span class="n">noise</span><span class="p">,</span> <span class="n">ARD</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">plot_cov_matrix</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">X2</span><span class="p">,</span> <span class="p">[</span><span class="n">noise</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;$</span><span class="se">\\</span><span class="s2">eta$&quot;</span><span class="p">])</span>
</code></pre></div>

<p><img alt="png" src="/images/GP-Kernels_files/GP-Kernels_32_0.png"></p>
<h3>Exponential Quadratic&nbsp;Kernel</h3>
<p>This is the most used kernel in <span class="caps">GP</span> Modelling because of its mathematical properties. It is infinitely differentiable and forces the covariance function to be smooth. It comes from Squared Exponential (<span class="caps">SE</span>) family of kernels which is also commonly called as the Radial Basis Kernel (<span class="caps">RBF</span>)&nbsp;Family.</p>
<p>It&#8217;s mathematical expression&nbsp;is:</p>
<div class="math">$$k(x, x') = \sigma^2 \exp\left( \frac{\|x-x'\|^2}{2\ell^2} \right)$$</div>
<p>where <span class="math">\(\sigma\)</span> is called &#8220;amplitude&#8221; and <span class="math">\(\ell\)</span> is called &#8220;length scale&#8221; of the&nbsp;kernel.</p>
<p>Amplitude controls how many units away the covariance is from the mean and length scale controls the &#8216;wiggles&#8217; in the function prior. In general, you won&#8217;t be able to extrapolate more than ℓ units away from your data. If a float, an isotropic kernel is used. If an array and <code>ARD=True</code>, an anisotropic kernel is used where each dimension defines the length-scale of the respective feature&nbsp;dimension.</p>
<p>The signature of Exponential Quadratic kernel implemented in <code>pymc4</code> is:</p>
<div class="highlight"><pre><span></span><code><span class="n">k</span> <span class="o">=</span> <span class="n">ExpQuad</span><span class="p">(</span><span class="n">length_scale</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">amplitude</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">feature_ndims</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">active_dims</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">scale_diag</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="c1"># We are using tf.float64 for better numerical accuracy.</span>
<span class="n">length_scales</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">([</span><span class="mf">0.4</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mf">6.0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
<span class="n">amplitudes</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>

<span class="n">k</span> <span class="o">=</span> <span class="n">ExpQuad</span><span class="p">(</span><span class="n">length_scale</span><span class="o">=</span><span class="n">length_scales</span><span class="p">,</span> <span class="n">amplitude</span><span class="o">=</span><span class="n">amplitudes</span><span class="p">,</span> <span class="n">ARD</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="mi">100</span><span class="p">)[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>

<span class="n">covs</span> <span class="o">=</span> <span class="n">stabilize</span><span class="p">(</span><span class="n">k</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">),</span> <span class="n">shift</span><span class="o">=</span><span class="mf">1e-8</span><span class="p">)</span>
<span class="n">dists</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">MvNormal</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">covariance_matrix</span><span class="o">=</span><span class="n">covs</span><span class="p">)</span>
<span class="n">samples</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">dists</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">perm</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="n">plot_samples</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">samples</span><span class="p">,</span> <span class="p">[</span><span class="n">length_scales</span><span class="p">,</span> <span class="n">amplitudes</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;$</span><span class="se">\\</span><span class="s2">ell$&quot;</span><span class="p">,</span> <span class="s2">&quot;$</span><span class="se">\\</span><span class="s2">sigma$&quot;</span><span class="p">])</span>
</code></pre></div>

<p><img alt="png" src="/images/GP-Kernels_files/GP-Kernels_36_0.png"></p>
<div class="highlight"><pre><span></span><code><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">X2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">x1</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">40</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">x2</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">40</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">ls</span><span class="p">,</span> <span class="n">amp</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">],</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.4</span><span class="p">]</span>
<span class="n">k</span> <span class="o">=</span> <span class="n">ExpQuad</span><span class="p">(</span><span class="n">length_scale</span><span class="o">=</span><span class="n">ls</span><span class="p">,</span> <span class="n">amplitude</span><span class="o">=</span><span class="n">amp</span><span class="p">,</span> <span class="n">ARD</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">plot_cov_matrix</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">X2</span><span class="p">,</span> <span class="p">[</span><span class="n">ls</span><span class="p">,</span> <span class="n">amp</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;$</span><span class="se">\\</span><span class="s2">ell$&quot;</span><span class="p">,</span> <span class="s2">&quot;$</span><span class="se">\\</span><span class="s2">sigma$&quot;</span><span class="p">])</span>
</code></pre></div>

<p><img alt="png" src="/images/GP-Kernels_files/GP-Kernels_37_0.png"></p>
<h3>Rational Quadratic&nbsp;Kernel</h3>
<p>Rational Quadratic Kernel is a generalization over the Exponential Quadratic Kernel. It is equivalent to using a combination of Exponential Quadratic kernel with different length scales. One extra parameter <span class="math">\(\alpha\)</span> controls the &#8220;<em>mixture rate</em>&#8221; of the kernel and is also known as &#8220;scale mixture rate&#8221;. As this parameter approaches infinity, the kernel becomes exactly equivalent to the Exponential Quadratic Kernel. The mathematical formula for the kernel is given&nbsp;by:</p>
<div class="math">$$k(x,x') = \sigma^2 \left( 1 + \frac{\|x-x'\|^2}{2\alpha\ell^2} \right)^\alpha$$</div>
<p>where <span class="math">\(\sigma\)</span> is the amplitude, <span class="math">\(\ell\)</span> is the length scale, and <span class="math">\(\alpha\)</span> is the scale mixture&nbsp;rate.</p>
<p>The signature of the kernel implemented in <code>pymc4</code> is:</p>
<div class="highlight"><pre><span></span><code><span class="n">k</span> <span class="o">=</span> <span class="n">RatQuad</span><span class="p">(</span><span class="n">length_scale</span><span class="p">,</span> <span class="n">amplitude</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">scale_mixture_rate</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">feature_ndims</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">active_dims</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">scale_diag</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="n">length_scales</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">([</span><span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
<span class="n">amplitudes</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
<span class="n">scale_mixture_rates</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">([</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">,</span> <span class="mf">10000.0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>

<span class="n">k</span> <span class="o">=</span> <span class="n">RatQuad</span><span class="p">(</span>
    <span class="n">length_scale</span><span class="o">=</span><span class="n">length_scales</span><span class="p">,</span>
    <span class="n">amplitude</span><span class="o">=</span><span class="n">amplitudes</span><span class="p">,</span>
    <span class="n">scale_mixture_rate</span><span class="o">=</span><span class="n">scale_mixture_rates</span><span class="p">,</span>
    <span class="n">ARD</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="mi">100</span><span class="p">)[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>

<span class="n">covs</span> <span class="o">=</span> <span class="n">stabilize</span><span class="p">(</span><span class="n">k</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">),</span> <span class="n">shift</span><span class="o">=</span><span class="mf">1e-8</span><span class="p">)</span>
<span class="n">dists</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">MvNormal</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">covariance_matrix</span><span class="o">=</span><span class="n">covs</span><span class="p">)</span>
<span class="n">samples</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">dists</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">perm</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="n">plot_samples</span><span class="p">(</span>
    <span class="n">x</span><span class="p">,</span>
    <span class="n">samples</span><span class="p">,</span>
    <span class="p">[</span><span class="n">length_scales</span><span class="p">,</span> <span class="n">amplitudes</span><span class="p">,</span> <span class="n">scale_mixture_rates</span><span class="p">],</span>
    <span class="p">[</span><span class="s2">&quot;$</span><span class="se">\\</span><span class="s2">ell$&quot;</span><span class="p">,</span> <span class="s2">&quot;$</span><span class="se">\\</span><span class="s2">sigma$&quot;</span><span class="p">,</span> <span class="s2">&quot;$</span><span class="se">\\</span><span class="s2">alpha$&quot;</span><span class="p">],</span>
<span class="p">)</span>
</code></pre></div>

<p><img alt="png" src="/images/GP-Kernels_files/GP-Kernels_41_0.png"></p>
<div class="highlight"><pre><span></span><code><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">X2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">x1</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">40</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">x2</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">40</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">ls</span><span class="p">,</span> <span class="n">amp</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">],</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">5000.0</span><span class="p">]</span>
<span class="n">k</span> <span class="o">=</span> <span class="n">RatQuad</span><span class="p">(</span><span class="n">length_scale</span><span class="o">=</span><span class="n">ls</span><span class="p">,</span> <span class="n">amplitude</span><span class="o">=</span><span class="n">amp</span><span class="p">,</span> <span class="n">scale_mixture_rate</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span> <span class="n">ARD</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">plot_cov_matrix</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">X2</span><span class="p">,</span> <span class="p">[</span><span class="n">ls</span><span class="p">,</span> <span class="n">amp</span><span class="p">,</span> <span class="n">alpha</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;$</span><span class="se">\\</span><span class="s2">ell$&quot;</span><span class="p">,</span> <span class="s2">&quot;$</span><span class="se">\\</span><span class="s2">sigma$&quot;</span><span class="p">,</span> <span class="s2">&quot;$</span><span class="se">\\</span><span class="s2">alpha$&quot;</span><span class="p">])</span>
</code></pre></div>

<p><img alt="png" src="/images/GP-Kernels_files/GP-Kernels_42_0.png"></p>
<h3>Matern Family of&nbsp;Kernels</h3>
<p>Matern family of kernels is a generalization over the <span class="caps">RBF</span> family of kernels. The <span class="math">\(\nu\)</span> parameter controls the smoothness of the kernel function. Higher values of <span class="math">\(\nu\)</span> result in smoother functions. The most common values of <span class="math">\(\nu\)</span> are 0.5, 1.5 and 2.5 as the modified Bessel&#8217;s function is analytical there. The full mathematical formula of matern kernels is given&nbsp;by:</p>
<div class="math">$$k(x_i, x_j) =  \frac{1}{\Gamma(\nu)2^{\nu-1}}\Bigg(
\frac{\sqrt{2\nu}}{l} d(x_i , x_j )
\Bigg)^\nu K_\nu\Bigg(
\frac{\sqrt{2\nu}}{l} d(x_i , x_j )\Bigg)$$</div>
<p>where <span class="math">\(d(.)\)</span> is the Euclidean distance, <span class="math">\(K_\nu(.)\)</span> is a modified Bessel function and <span class="math">\(\Gamma(.)\)</span> is the gamma&nbsp;function.</p>
<p>For other values of <span class="math">\(\nu\)</span>, the computational cost to evaluate the kernel is extremely high and so isn&#8217;t implemented in <code>pymc4</code>.</p>
<p>Let&#8217;s see the kernels we get for some special values of <span class="math">\(\nu\)</span></p>
<h3>Matern 1/2&nbsp;Kernel</h3>
<p>This kernel has the value of <span class="math">\(\nu = 0.5\)</span>. It is used to model <em>Ornstein-Uhlenbeck processes</em>.</p>
<p>It is given&nbsp;by:</p>
<div class="math">$$k(x, x') = \sigma^2\mathrm{exp}\left( -\frac{\|x - x'\|}{\ell} \right)$$</div>
<p>Its signature in <code>pymc4</code> is:</p>
<div class="highlight"><pre><span></span><code><span class="n">k</span> <span class="o">=</span> <span class="n">Matern12</span><span class="p">(</span><span class="n">length_scale</span><span class="p">,</span> <span class="n">amplitude</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">feature_ndims</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">active_dims</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">scale_diag</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</code></pre></div>

<h4>Example&nbsp;1</h4>
<div class="highlight"><pre><span></span><code><span class="n">length_scales</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">([</span><span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
<span class="n">amplitudes</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>

<span class="n">k</span> <span class="o">=</span> <span class="n">Matern12</span><span class="p">(</span><span class="n">length_scale</span><span class="o">=</span><span class="n">length_scales</span><span class="p">,</span> <span class="n">amplitude</span><span class="o">=</span><span class="n">amplitudes</span><span class="p">,</span> <span class="n">ARD</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="mi">500</span><span class="p">)[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>

<span class="n">covs</span> <span class="o">=</span> <span class="n">stabilize</span><span class="p">(</span><span class="n">k</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">),</span> <span class="n">shift</span><span class="o">=</span><span class="mf">1e-8</span><span class="p">)</span>
<span class="n">dists</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">MvNormal</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">covariance_matrix</span><span class="o">=</span><span class="n">covs</span><span class="p">)</span>
<span class="n">samples</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">dists</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">perm</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="n">plot_samples</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">samples</span><span class="p">,</span> <span class="p">[</span><span class="n">length_scales</span><span class="p">,</span> <span class="n">amplitudes</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;$\ell$&quot;</span><span class="p">,</span> <span class="s2">&quot;$</span><span class="se">\\</span><span class="s2">sigma$&quot;</span><span class="p">])</span>
</code></pre></div>

<p><img alt="png" src="/images/GP-Kernels_files/GP-Kernels_48_0.png"></p>
<h4>Example&nbsp;2</h4>
<div class="highlight"><pre><span></span><code><span class="n">length_scales</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">([</span><span class="mf">3.4</span><span class="p">,</span> <span class="mf">3.4</span><span class="p">,</span> <span class="mf">3.4</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
<span class="n">amplitudes</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>

<span class="n">k</span> <span class="o">=</span> <span class="n">Matern12</span><span class="p">(</span><span class="n">length_scale</span><span class="o">=</span><span class="n">length_scales</span><span class="p">,</span> <span class="n">amplitude</span><span class="o">=</span><span class="n">amplitudes</span><span class="p">,</span> <span class="n">ARD</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="mi">500</span><span class="p">)[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>

<span class="n">covs</span> <span class="o">=</span> <span class="n">stabilize</span><span class="p">(</span><span class="n">k</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">),</span> <span class="n">shift</span><span class="o">=</span><span class="mf">1e-8</span><span class="p">)</span>
<span class="n">dists</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">MvNormal</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">covariance_matrix</span><span class="o">=</span><span class="n">covs</span><span class="p">)</span>
<span class="n">samples</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">dists</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">perm</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="n">plot_samples</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">samples</span><span class="p">,</span> <span class="p">[</span><span class="n">length_scales</span><span class="p">,</span> <span class="n">amplitudes</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;$\ell$&quot;</span><span class="p">,</span> <span class="s2">&quot;$</span><span class="se">\\</span><span class="s2">sigma$&quot;</span><span class="p">])</span>
</code></pre></div>

<p><img alt="png" src="/images/GP-Kernels_files/GP-Kernels_52_0.png"></p>
<div class="highlight"><pre><span></span><code><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">X2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">x1</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">40</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">x2</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">40</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">ls</span><span class="p">,</span> <span class="n">amp</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.4</span><span class="p">,</span> <span class="mf">1.4</span><span class="p">],</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]</span>
<span class="n">k</span> <span class="o">=</span> <span class="n">Matern12</span><span class="p">(</span><span class="n">length_scale</span><span class="o">=</span><span class="n">ls</span><span class="p">,</span> <span class="n">amplitude</span><span class="o">=</span><span class="n">amp</span><span class="p">,</span> <span class="n">ARD</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">plot_cov_matrix</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">X2</span><span class="p">,</span> <span class="p">[</span><span class="n">ls</span><span class="p">,</span> <span class="n">amp</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;$</span><span class="se">\\</span><span class="s2">ell$&quot;</span><span class="p">,</span> <span class="s2">&quot;$</span><span class="se">\\</span><span class="s2">sigma$&quot;</span><span class="p">])</span>
</code></pre></div>

<p><img alt="png" src="/images/GP-Kernels_files/GP-Kernels_53_0.png"></p>
<h3>Matern 3/2&nbsp;Kernel</h3>
<p>This kernel has the value of <span class="math">\(\nu = 1.5\)</span>.</p>
<p>It is given&nbsp;by:</p>
<div class="math">$$k(x, x') = \left(1 + \frac{\sqrt{3(x - x')^2}}{\ell}\right)
                   \mathrm{exp}\left( - \frac{\sqrt{3(x - x')^2}}{\ell} \right)$$</div>
<p>Its signature in <code>pymc4</code> is:</p>
<div class="highlight"><pre><span></span><code><span class="n">k</span> <span class="o">=</span> <span class="n">Matern32</span><span class="p">(</span><span class="n">length_scale</span><span class="p">,</span> <span class="n">amplitude</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">feature_ndims</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">active_dims</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">scale_diag</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</code></pre></div>

<h4>Example&nbsp;1</h4>
<div class="highlight"><pre><span></span><code><span class="n">length_scales</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">([</span><span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
<span class="n">amplitudes</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>

<span class="n">k</span> <span class="o">=</span> <span class="n">Matern32</span><span class="p">(</span><span class="n">length_scale</span><span class="o">=</span><span class="n">length_scales</span><span class="p">,</span> <span class="n">amplitude</span><span class="o">=</span><span class="n">amplitudes</span><span class="p">,</span> <span class="n">ARD</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="mi">500</span><span class="p">)[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>

<span class="n">covs</span> <span class="o">=</span> <span class="n">stabilize</span><span class="p">(</span><span class="n">k</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">),</span> <span class="n">shift</span><span class="o">=</span><span class="mf">1e-8</span><span class="p">)</span>
<span class="n">dists</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">MvNormal</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">covariance_matrix</span><span class="o">=</span><span class="n">covs</span><span class="p">)</span>
<span class="n">samples</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">dists</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">perm</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="n">plot_samples</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">samples</span><span class="p">,</span> <span class="p">[</span><span class="n">length_scales</span><span class="p">,</span> <span class="n">amplitudes</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;$</span><span class="se">\\</span><span class="s2">ell$&quot;</span><span class="p">,</span> <span class="s2">&quot;$</span><span class="se">\\</span><span class="s2">sigma$&quot;</span><span class="p">])</span>
</code></pre></div>

<p><img alt="png" src="/images/GP-Kernels_files/GP-Kernels_58_0.png"></p>
<h4>Example&nbsp;2</h4>
<div class="highlight"><pre><span></span><code><span class="n">length_scales</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">([</span><span class="mf">1.4</span><span class="p">,</span> <span class="mf">1.4</span><span class="p">,</span> <span class="mf">1.4</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
<span class="n">amplitudes</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>

<span class="n">k</span> <span class="o">=</span> <span class="n">Matern32</span><span class="p">(</span><span class="n">length_scale</span><span class="o">=</span><span class="n">length_scales</span><span class="p">,</span> <span class="n">amplitude</span><span class="o">=</span><span class="n">amplitudes</span><span class="p">,</span> <span class="n">ARD</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="mi">500</span><span class="p">)[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>

<span class="n">covs</span> <span class="o">=</span> <span class="n">stabilize</span><span class="p">(</span><span class="n">k</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">),</span> <span class="n">shift</span><span class="o">=</span><span class="mf">1e-8</span><span class="p">)</span>
<span class="n">dists</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">MvNormal</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">covariance_matrix</span><span class="o">=</span><span class="n">covs</span><span class="p">)</span>
<span class="n">samples</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">dists</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="n">plot_samples</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">samples</span><span class="p">,</span> <span class="p">[</span><span class="n">length_scales</span><span class="p">,</span> <span class="n">amplitudes</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;$</span><span class="se">\\</span><span class="s2">ell$&quot;</span><span class="p">,</span> <span class="s2">&quot;$</span><span class="se">\\</span><span class="s2">sigma$&quot;</span><span class="p">])</span>
</code></pre></div>

<p><img alt="png" src="/images/GP-Kernels_files/GP-Kernels_62_0.png"></p>
<div class="highlight"><pre><span></span><code><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">X2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">x1</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">40</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">x2</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">40</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">ls</span><span class="p">,</span> <span class="n">amp</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.4</span><span class="p">,</span> <span class="mf">1.4</span><span class="p">],</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]</span>
<span class="n">k</span> <span class="o">=</span> <span class="n">Matern32</span><span class="p">(</span><span class="n">length_scale</span><span class="o">=</span><span class="n">ls</span><span class="p">,</span> <span class="n">amplitude</span><span class="o">=</span><span class="n">amp</span><span class="p">,</span> <span class="n">ARD</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">plot_cov_matrix</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">X2</span><span class="p">,</span> <span class="p">[</span><span class="n">ls</span><span class="p">,</span> <span class="n">amp</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;$</span><span class="se">\\</span><span class="s2">ell$&quot;</span><span class="p">,</span> <span class="s2">&quot;$</span><span class="se">\\</span><span class="s2">sigma$&quot;</span><span class="p">])</span>
</code></pre></div>

<p><img alt="png" src="/images/GP-Kernels_files/GP-Kernels_63_0.png"></p>
<h3>Matern 5/2&nbsp;Kernel</h3>
<p>This kernel has the value of <span class="math">\(\nu = 2.5\)</span> It can be analytically shown&nbsp;as:</p>
<div class="math">$$k(x, x') = \left(1 + \frac{\sqrt{5(x - x')^2}}{\ell} +
                   \frac{5(x-x')^2}{3\ell^2}\right)
                   \mathrm{exp}\left[ - \frac{\sqrt{5(x - x')^2}}{\ell} \right]$$</div>
<p>Its signature in PyMC4&nbsp;is:</p>
<div class="highlight"><pre><span></span><code><span class="n">k</span> <span class="o">=</span> <span class="n">Matern52</span><span class="p">(</span><span class="n">length_scale</span><span class="p">,</span> <span class="n">amplitude</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">feature_ndims</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">active_dims</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">scale_diag</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</code></pre></div>

<h4>Example&nbsp;1</h4>
<div class="highlight"><pre><span></span><code><span class="n">length_scales</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">([</span><span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
<span class="n">amplitudes</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>

<span class="n">k</span> <span class="o">=</span> <span class="n">Matern52</span><span class="p">(</span><span class="n">length_scale</span><span class="o">=</span><span class="n">length_scales</span><span class="p">,</span> <span class="n">amplitude</span><span class="o">=</span><span class="n">amplitudes</span><span class="p">,</span> <span class="n">ARD</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="mi">500</span><span class="p">)[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>

<span class="n">covs</span> <span class="o">=</span> <span class="n">stabilize</span><span class="p">(</span><span class="n">k</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">),</span> <span class="n">shift</span><span class="o">=</span><span class="mf">1e-8</span><span class="p">)</span>
<span class="n">dists</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">MvNormal</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">covariance_matrix</span><span class="o">=</span><span class="n">covs</span><span class="p">)</span>
<span class="n">samples</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">dists</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">perm</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="n">plot_samples</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">samples</span><span class="p">,</span> <span class="p">[</span><span class="n">length_scales</span><span class="p">,</span> <span class="n">amplitudes</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;$</span><span class="se">\\</span><span class="s2">ell$&quot;</span><span class="p">,</span> <span class="s2">&quot;$</span><span class="se">\\</span><span class="s2">sigma$&quot;</span><span class="p">])</span>
</code></pre></div>

<p><img alt="png" src="/images/GP-Kernels_files/GP-Kernels_68_0.png"></p>
<h4>Example&nbsp;2</h4>
<div class="highlight"><pre><span></span><code><span class="n">length_scales</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">([</span><span class="mf">3.4</span><span class="p">,</span> <span class="mf">3.4</span><span class="p">,</span> <span class="mf">3.4</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
<span class="n">amplitudes</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>

<span class="n">k</span> <span class="o">=</span> <span class="n">Matern52</span><span class="p">(</span><span class="n">length_scale</span><span class="o">=</span><span class="n">length_scales</span><span class="p">,</span> <span class="n">amplitude</span><span class="o">=</span><span class="n">amplitudes</span><span class="p">,</span> <span class="n">ARD</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="mi">100</span><span class="p">)[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>

<span class="n">covs</span> <span class="o">=</span> <span class="n">stabilize</span><span class="p">(</span><span class="n">k</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">),</span> <span class="n">shift</span><span class="o">=</span><span class="mf">1e-8</span><span class="p">)</span>
<span class="n">dists</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">MvNormal</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">covariance_matrix</span><span class="o">=</span><span class="n">covs</span><span class="p">)</span>
<span class="n">samples</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">dists</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">perm</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="n">plot_samples</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">samples</span><span class="p">,</span> <span class="p">[</span><span class="n">length_scales</span><span class="p">,</span> <span class="n">amplitudes</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;$</span><span class="se">\\</span><span class="s2">ell$&quot;</span><span class="p">,</span> <span class="s2">&quot;$</span><span class="se">\\</span><span class="s2">sigma$&quot;</span><span class="p">])</span>
</code></pre></div>

<p><img alt="png" src="/images/GP-Kernels_files/GP-Kernels_72_0.png"></p>
<div class="highlight"><pre><span></span><code><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">X2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">x1</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">40</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">x2</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">40</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">ls</span><span class="p">,</span> <span class="n">amp</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.4</span><span class="p">,</span> <span class="mf">1.4</span><span class="p">,</span> <span class="mf">1.4</span><span class="p">],</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.3</span><span class="p">]</span>
<span class="n">k</span> <span class="o">=</span> <span class="n">Matern52</span><span class="p">(</span><span class="n">length_scale</span><span class="o">=</span><span class="n">ls</span><span class="p">,</span> <span class="n">amplitude</span><span class="o">=</span><span class="n">amp</span><span class="p">,</span> <span class="n">ARD</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">plot_cov_matrix</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">X2</span><span class="p">,</span> <span class="p">[</span><span class="n">ls</span><span class="p">,</span> <span class="n">amp</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;$</span><span class="se">\\</span><span class="s2">ell$&quot;</span><span class="p">,</span> <span class="s2">&quot;$</span><span class="se">\\</span><span class="s2">sigma$&quot;</span><span class="p">])</span>
</code></pre></div>

<p><img alt="png" src="/images/GP-Kernels_files/GP-Kernels_73_0.png"></p>
<h3>Exponential&nbsp;Kernel</h3>
<p>It is also known as <code>Laplacian</code> kernel.</p>
<p>It&#8217;s mathematical formula can be given&nbsp;as:</p>
<div class="math">$$k(x,x') = \sigma^2 \mathrm{exp}\left( -\frac{||x - x'||}{2\ell^2} \right)$$</div>
<p>The signature of this kernel&nbsp;is:</p>
<div class="highlight"><pre><span></span><code><span class="n">k</span> <span class="o">=</span> <span class="n">Exponential</span><span class="p">(</span><span class="n">length_scale</span><span class="p">,</span> <span class="n">amplitude</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">feature_ndims</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">active_dims</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">scale_diag</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</code></pre></div>

<h4>Example&nbsp;1</h4>
<div class="highlight"><pre><span></span><code><span class="n">length_scales</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">([</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
<span class="n">amplitudes</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>

<span class="n">k</span> <span class="o">=</span> <span class="n">Exponential</span><span class="p">(</span><span class="n">length_scale</span><span class="o">=</span><span class="n">length_scales</span><span class="p">,</span> <span class="n">amplitude</span><span class="o">=</span><span class="n">amplitudes</span><span class="p">,</span> <span class="n">ARD</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="mi">500</span><span class="p">)[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>

<span class="n">covs</span> <span class="o">=</span> <span class="n">stabilize</span><span class="p">(</span><span class="n">k</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">),</span> <span class="n">shift</span><span class="o">=</span><span class="mf">1e-8</span><span class="p">)</span>
<span class="n">dists</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">MvNormal</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">covariance_matrix</span><span class="o">=</span><span class="n">covs</span><span class="p">)</span>
<span class="n">samples</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">dists</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">perm</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="n">plot_samples</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">samples</span><span class="p">,</span> <span class="p">[</span><span class="n">length_scales</span><span class="p">,</span> <span class="n">amplitudes</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;$</span><span class="se">\\</span><span class="s2">ell$&quot;</span><span class="p">,</span> <span class="s2">&quot;$</span><span class="se">\\</span><span class="s2">sigma$&quot;</span><span class="p">])</span>
</code></pre></div>

<p><img alt="png" src="/images/GP-Kernels_files/GP-Kernels_78_0.png"></p>
<h4>Example&nbsp;2</h4>
<div class="highlight"><pre><span></span><code><span class="n">length_scales</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">([</span><span class="mf">3.4</span><span class="p">,</span> <span class="mf">3.4</span><span class="p">,</span> <span class="mf">3.4</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
<span class="n">amplitudes</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>

<span class="n">k</span> <span class="o">=</span> <span class="n">Exponential</span><span class="p">(</span><span class="n">length_scale</span><span class="o">=</span><span class="n">length_scales</span><span class="p">,</span> <span class="n">amplitude</span><span class="o">=</span><span class="n">amplitudes</span><span class="p">,</span> <span class="n">ARD</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="mi">500</span><span class="p">)[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>

<span class="n">covs</span> <span class="o">=</span> <span class="n">stabilize</span><span class="p">(</span><span class="n">k</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">),</span> <span class="n">shift</span><span class="o">=</span><span class="mf">1e-8</span><span class="p">)</span>
<span class="n">dists</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">MvNormal</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">covariance_matrix</span><span class="o">=</span><span class="n">covs</span><span class="p">)</span>
<span class="n">samples</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">dists</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">perm</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="n">plot_samples</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">samples</span><span class="p">,</span> <span class="p">[</span><span class="n">length_scales</span><span class="p">,</span> <span class="n">amplitudes</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;$\ell$&quot;</span><span class="p">,</span> <span class="s2">&quot;$</span><span class="se">\\</span><span class="s2">sigma$&quot;</span><span class="p">])</span>
</code></pre></div>

<p><img alt="png" src="/images/GP-Kernels_files/GP-Kernels_82_0.png"></p>
<div class="highlight"><pre><span></span><code><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">X2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">x1</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">40</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">x2</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">40</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">ls</span><span class="p">,</span> <span class="n">amp</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">],</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]</span>
<span class="n">k</span> <span class="o">=</span> <span class="n">Exponential</span><span class="p">(</span><span class="n">length_scale</span><span class="o">=</span><span class="n">ls</span><span class="p">,</span> <span class="n">amplitude</span><span class="o">=</span><span class="n">amp</span><span class="p">,</span> <span class="n">ARD</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">plot_cov_matrix</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">X2</span><span class="p">,</span> <span class="p">[</span><span class="n">ls</span><span class="p">,</span> <span class="n">amp</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;$</span><span class="se">\\</span><span class="s2">ell$&quot;</span><span class="p">,</span> <span class="s2">&quot;$</span><span class="se">\\</span><span class="s2">sigma$&quot;</span><span class="p">])</span>
</code></pre></div>

<p><img alt="png" src="/images/GP-Kernels_files/GP-Kernels_83_0.png"></p>
<h2>Periodic Kernels in&nbsp;PyMC4!</h2>
<p>A total of 2 periodic kernels have been implemented in&nbsp;PyMC4.</p>
<ul>
<li><a href="#Exponential-Sine-Squared-Kernel">Exponential Sine Squared&nbsp;Kernel</a></li>
<li><a href="#Cosine-Kernel">Cosine&nbsp;Kernel</a></li>
</ul>
<h3>Exponential Sine Squared&nbsp;Kernel</h3>
<p>Periodic kernel aka Exponential Sine Squared Kernel comes from the Periodic Family of kernels. This kernels occilates in space with a period <span class="math">\(T\)</span>. This kernel is used mostly for time-series and other temporal prediction tasks. It can be expressed&nbsp;as:</p>
<div class="math">$$k(x, x') = \sigma^2 \exp\left(-\frac{2\sin^2\left(\frac{\pi\|x-x'\|}
           {T}\right)}{\ell^2}\right)$$</div>
<p>where <span class="math">\(T\)</span> is the period of the&nbsp;kernel.</p>
<p>Its signature in PyMC4&nbsp;is:</p>
<div class="highlight"><pre><span></span><code><span class="n">k</span> <span class="o">=</span> <span class="n">Periodic</span><span class="p">(</span><span class="n">length_scale</span><span class="p">,</span> <span class="n">amplitude</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">period</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">feature_ndims</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">active_dims</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">scale_diag</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="n">length_scales</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">([</span><span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
<span class="n">amplitudes</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
<span class="n">periods</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>

<span class="n">k</span> <span class="o">=</span> <span class="n">Periodic</span><span class="p">(</span>
    <span class="n">length_scale</span><span class="o">=</span><span class="n">length_scales</span><span class="p">,</span> <span class="n">amplitude</span><span class="o">=</span><span class="n">amplitudes</span><span class="p">,</span> <span class="n">period</span><span class="o">=</span><span class="n">periods</span><span class="p">,</span> <span class="n">ARD</span><span class="o">=</span><span class="kc">False</span>
<span class="p">)</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="mi">500</span><span class="p">)[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>

<span class="n">covs</span> <span class="o">=</span> <span class="n">stabilize</span><span class="p">(</span><span class="n">k</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">),</span> <span class="n">shift</span><span class="o">=</span><span class="mf">1e-8</span><span class="p">)</span>
<span class="n">dists</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">MvNormal</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">covariance_matrix</span><span class="o">=</span><span class="n">covs</span><span class="p">)</span>
<span class="n">samples</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">dists</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">perm</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="n">plot_samples</span><span class="p">(</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">samples</span><span class="p">,</span> <span class="p">[</span><span class="n">length_scales</span><span class="p">,</span> <span class="n">amplitudes</span><span class="p">,</span> <span class="n">periods</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;$</span><span class="se">\\</span><span class="s2">ell$&quot;</span><span class="p">,</span> <span class="s2">&quot;$</span><span class="se">\\</span><span class="s2">sigma$&quot;</span><span class="p">,</span> <span class="s2">&quot;$T$&quot;</span><span class="p">]</span>
<span class="p">)</span>
</code></pre></div>

<p><img alt="png" src="/images/GP-Kernels_files/GP-Kernels_88_0.png"></p>
<div class="highlight"><pre><span></span><code><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">30</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="n">X2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">x1</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">90</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">x2</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">90</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">ls</span><span class="p">,</span> <span class="n">amp</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">],</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span> <span class="p">[</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">]</span>
<span class="n">k</span> <span class="o">=</span> <span class="n">Periodic</span><span class="p">(</span><span class="n">length_scale</span><span class="o">=</span><span class="n">ls</span><span class="p">,</span> <span class="n">amplitude</span><span class="o">=</span><span class="n">amp</span><span class="p">,</span> <span class="n">period</span><span class="o">=</span><span class="n">t</span><span class="p">,</span> <span class="n">ARD</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">plot_cov_matrix</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">X2</span><span class="p">,</span> <span class="p">[</span><span class="n">ls</span><span class="p">,</span> <span class="n">amp</span><span class="p">,</span> <span class="n">t</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;$</span><span class="se">\\</span><span class="s2">ell$&quot;</span><span class="p">,</span> <span class="s2">&quot;$</span><span class="se">\\</span><span class="s2">sigma$&quot;</span><span class="p">,</span> <span class="s2">&quot;T&quot;</span><span class="p">])</span>
</code></pre></div>

<p><img alt="png" src="/images/GP-Kernels_files/GP-Kernels_89_0.png"></p>
<h3>Cosine&nbsp;Kernel</h3>
<p>This kernel is a part of the Periodic Kernels. It represents purely sinusoidal functions. It is given&nbsp;by:</p>
<div class="math">$$k(x,x') = \sigma^2\cos\left(\frac{2\pi\|x-x'\|^2}{\ell^2}\right)$$</div>
<p>Its signature in PyMC4&nbsp;is:</p>
<div class="highlight"><pre><span></span><code><span class="n">k</span> <span class="o">=</span> <span class="n">Cosine</span><span class="p">(</span><span class="n">length_scale</span><span class="p">,</span> <span class="n">amplitude</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">feature_ndims</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">active_dims</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">scale_diag</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</code></pre></div>

<h4>Example&nbsp;1</h4>
<div class="highlight"><pre><span></span><code><span class="n">length_scales</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">([</span><span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
<span class="n">amplitudes</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>

<span class="n">k</span> <span class="o">=</span> <span class="n">Periodic</span><span class="p">(</span><span class="n">length_scale</span><span class="o">=</span><span class="n">length_scales</span><span class="p">,</span> <span class="n">amplitude</span><span class="o">=</span><span class="n">amplitudes</span><span class="p">,</span> <span class="n">ARD</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="mi">500</span><span class="p">)[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>

<span class="n">covs</span> <span class="o">=</span> <span class="n">stabilize</span><span class="p">(</span><span class="n">k</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">),</span> <span class="n">shift</span><span class="o">=</span><span class="mf">1e-8</span><span class="p">)</span>
<span class="n">dists</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">MvNormal</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">covariance_matrix</span><span class="o">=</span><span class="n">covs</span><span class="p">)</span>
<span class="n">samples</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">dists</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">perm</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="n">plot_samples</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">samples</span><span class="p">,</span> <span class="p">[</span><span class="n">length_scales</span><span class="p">,</span> <span class="n">amplitudes</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;$</span><span class="se">\\</span><span class="s2">ell$&quot;</span><span class="p">,</span> <span class="s2">&quot;$</span><span class="se">\\</span><span class="s2">sigma$&quot;</span><span class="p">])</span>
</code></pre></div>

<p><img alt="png" src="/images/GP-Kernels_files/GP-Kernels_94_0.png"></p>
<h4>Example&nbsp;2</h4>
<div class="highlight"><pre><span></span><code><span class="n">length_scales</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">([</span><span class="mf">3.4</span><span class="p">,</span> <span class="mf">3.4</span><span class="p">,</span> <span class="mf">3.4</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
<span class="n">amplitudes</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>

<span class="n">k</span> <span class="o">=</span> <span class="n">Periodic</span><span class="p">(</span><span class="n">length_scale</span><span class="o">=</span><span class="n">length_scales</span><span class="p">,</span> <span class="n">amplitude</span><span class="o">=</span><span class="n">amplitudes</span><span class="p">,</span> <span class="n">ARD</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="mi">500</span><span class="p">)[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>

<span class="n">covs</span> <span class="o">=</span> <span class="n">stabilize</span><span class="p">(</span><span class="n">k</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">),</span> <span class="n">shift</span><span class="o">=</span><span class="mf">1e-8</span><span class="p">)</span>
<span class="n">dists</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">MvNormal</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">covariance_matrix</span><span class="o">=</span><span class="n">covs</span><span class="p">)</span>
<span class="n">samples</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">dists</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">perm</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="n">plot_samples</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">samples</span><span class="p">,</span> <span class="p">[</span><span class="n">length_scales</span><span class="p">,</span> <span class="n">amplitudes</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;$</span><span class="se">\\</span><span class="s2">ell$&quot;</span><span class="p">,</span> <span class="s2">&quot;$</span><span class="se">\\</span><span class="s2">sigma$&quot;</span><span class="p">])</span>
</code></pre></div>

<p><img alt="png" src="/images/GP-Kernels_files/GP-Kernels_98_0.png"></p>
<div class="highlight"><pre><span></span><code><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">30</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="n">X2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">x1</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">90</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">x2</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">90</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">ls</span><span class="p">,</span> <span class="n">amp</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.8</span><span class="p">,</span> <span class="mf">1.8</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">],</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]</span>
<span class="n">k</span> <span class="o">=</span> <span class="n">Cosine</span><span class="p">(</span><span class="n">length_scale</span><span class="o">=</span><span class="n">ls</span><span class="p">,</span> <span class="n">amplitude</span><span class="o">=</span><span class="n">amp</span><span class="p">,</span> <span class="n">ARD</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">plot_cov_matrix</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">X2</span><span class="p">,</span> <span class="p">[</span><span class="n">ls</span><span class="p">,</span> <span class="n">amp</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;$</span><span class="se">\\</span><span class="s2">ell$&quot;</span><span class="p">,</span> <span class="s2">&quot;$</span><span class="se">\\</span><span class="s2">sigma$&quot;</span><span class="p">])</span>
</code></pre></div>

<p><img alt="png" src="/images/GP-Kernels_files/GP-Kernels_99_0.png"></p>
<h2>Non-Stationary&nbsp;Kernels</h2>
<p>There are a total of 5 non-stationary distributions in PyMC4. These kernels vary not only with respect to the parameters but also with the position of data in&nbsp;space.</p>
<ul>
<li><a href="#">Linear</a></li>
<li><a href="#">Polynomial</a></li>
<li><a href="#Gibbs-Kernel">Gibbs&nbsp;Kernel</a></li>
<li><a href="#Scaled-Covariance-Kernel">Scaled Covariance&nbsp;Kernel</a></li>
<li><a href="#Warped-Input-Kernel">Warped Input&nbsp;Kernel</a></li>
</ul>
<h3>Linear&nbsp;Kernel</h3>
<p>This kernel evaluates a linear function of the inputs <span class="math">\(x\)</span> and <span class="math">\(x'\)</span>. It performs Bayesian linear regression on the inputs to produce random linear functions. The parameter <span class="math">\(\sigma_b\)</span> controls how far the covariance is from the mean value and is called &#8220;bias variance&#8221;. <span class="math">\(\sigma_v\)</span> controls how fast the covariance grows with respect to the origin point and is called &#8220;slope variance&#8221;. <span class="math">\(c\)</span> is the shift parameter which shift points closer to the origin by <span class="math">\(c\)</span>&nbsp;units.</p>
<div class="math">$$k(x, x') = \sigma_b^2 + \sigma_v^2\left(x - c\right)\left(x'-c\right)$$</div>
<p>where <span class="math">\(\sigma_b\)</span> is bias variance, <span class="math">\(\sigma_v\)</span> is slope variance,
and <span class="math">\(c\)</span> is the shift&nbsp;parameter.</p>
<p>Its signature in <code>pymc4</code> is:</p>
<div class="highlight"><pre><span></span><code><span class="n">k</span> <span class="o">=</span> <span class="n">Linear</span><span class="p">(</span><span class="n">bias_variance</span><span class="p">,</span> <span class="n">slope_variance</span><span class="p">,</span> <span class="n">shift</span><span class="p">,</span> <span class="n">feature_ndims</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">active_dims</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">scale_diag</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="n">bias_variances</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
<span class="n">slope_variances</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
<span class="n">shifts</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">,</span> <span class="mf">50.0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>

<span class="n">k</span> <span class="o">=</span> <span class="n">Linear</span><span class="p">(</span>
    <span class="n">bias_variance</span><span class="o">=</span><span class="n">bias_variances</span><span class="p">,</span>
    <span class="n">slope_variance</span><span class="o">=</span><span class="n">slope_variances</span><span class="p">,</span>
    <span class="n">shift</span><span class="o">=</span><span class="n">shifts</span><span class="p">,</span>
    <span class="n">ARD</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">100.0</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="mi">100</span><span class="p">)[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>

<span class="n">covs</span> <span class="o">=</span> <span class="n">stabilize</span><span class="p">(</span><span class="n">k</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">),</span> <span class="n">shift</span><span class="o">=</span><span class="mf">1e-8</span><span class="p">)</span>
<span class="n">dists</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">MvNormal</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">covariance_matrix</span><span class="o">=</span><span class="n">covs</span><span class="p">)</span>
<span class="n">samples</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">dists</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">perm</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="n">plot_samples</span><span class="p">(</span>
    <span class="n">x</span><span class="p">,</span>
    <span class="n">samples</span><span class="p">,</span>
    <span class="p">[</span><span class="n">bias_variances</span><span class="p">,</span> <span class="n">slope_variances</span><span class="p">,</span> <span class="n">shifts</span><span class="p">],</span>
    <span class="p">[</span><span class="s2">&quot;$</span><span class="se">\\</span><span class="s2">sigma_b$&quot;</span><span class="p">,</span> <span class="s2">&quot;$</span><span class="se">\\</span><span class="s2">sigma_v$&quot;</span><span class="p">,</span> <span class="s2">&quot;$c$&quot;</span><span class="p">],</span>
<span class="p">)</span>
</code></pre></div>

<p><img alt="png" src="/images/GP-Kernels_files/GP-Kernels_104_0.png"></p>
<div class="highlight"><pre><span></span><code><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">X2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">x1</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">40</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">x2</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">40</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">bv</span><span class="p">,</span> <span class="n">sv</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">],</span> <span class="p">[</span><span class="mf">1.8</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]</span>
<span class="n">k</span> <span class="o">=</span> <span class="n">Linear</span><span class="p">(</span><span class="n">bias_variance</span><span class="o">=</span><span class="n">bv</span><span class="p">,</span> <span class="n">slope_variance</span><span class="o">=</span><span class="n">sv</span><span class="p">,</span> <span class="n">shift</span><span class="o">=</span><span class="n">c</span><span class="p">,</span> <span class="n">ARD</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">plot_cov_matrix</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">X2</span><span class="p">,</span> <span class="p">[</span><span class="n">bv</span><span class="p">,</span> <span class="n">sv</span><span class="p">,</span> <span class="n">c</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;$</span><span class="se">\\</span><span class="s2">sigma_b$&quot;</span><span class="p">,</span> <span class="s2">&quot;$</span><span class="se">\\</span><span class="s2">sigma_v$&quot;</span><span class="p">,</span> <span class="s2">&quot;c&quot;</span><span class="p">])</span>
</code></pre></div>

<p><img alt="png" src="/images/GP-Kernels_files/GP-Kernels_105_0.png"></p>
<h3>Polynomial&nbsp;Kernel</h3>
<p>This kernel is a generalization over the Linear Kernel and performs polynomial regression on the data to evaluate the covariance matrix. An extra parameter <span class="math">\(\alpha\)</span> controls the degree of the polynomial. This kernel is exactly the same as the Linear Kernel when <span class="math">\(\alpha=1\)</span>.</p>
<p>This kernel can be represented mathematically&nbsp;as:</p>
<div class="math">$$k(x,x') = \sigma_b^2 + \sigma_v^2\left((x-c)(x'-c)\right)^\alpha$$</div>
<p>where <span class="math">\(\sigma_b\)</span>, <span class="math">\(\sigma_v\)</span> and <span class="math">\(c\)</span> are the same as before and <span class="math">\(\alpha\)</span> is the&nbsp;exponent.</p>
<p>Its signature in <code>pymc4</code> is:</p>
<div class="highlight"><pre><span></span><code><span class="n">k</span> <span class="o">=</span> <span class="n">Polynomial</span><span class="p">(</span><span class="n">bias_variance</span><span class="p">,</span> <span class="n">slope_variance</span><span class="p">,</span> <span class="n">shift</span><span class="p">,</span> <span class="n">exponent</span><span class="p">,</span> <span class="n">feature_ndims</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">active_dims</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">scale_diag</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="n">bias_variances</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">([</span><span class="mf">1.0</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
<span class="n">slope_variances</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">([</span><span class="mf">2.0</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
<span class="n">shifts</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">([</span><span class="mf">0.0</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
<span class="n">exponents</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>

<span class="n">k</span> <span class="o">=</span> <span class="n">Polynomial</span><span class="p">(</span>
    <span class="n">bias_variance</span><span class="o">=</span><span class="n">bias_variances</span><span class="p">,</span>
    <span class="n">slope_variance</span><span class="o">=</span><span class="n">slope_variances</span><span class="p">,</span>
    <span class="n">shift</span><span class="o">=</span><span class="n">shifts</span><span class="p">,</span>
    <span class="n">exponent</span><span class="o">=</span><span class="n">exponents</span><span class="p">,</span>
    <span class="n">ARD</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="mi">100</span><span class="p">)[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>

<span class="n">covs</span> <span class="o">=</span> <span class="n">stabilize</span><span class="p">(</span><span class="n">k</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">),</span> <span class="n">shift</span><span class="o">=</span><span class="mf">1e-8</span><span class="p">)</span>
<span class="n">dists</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">MvNormal</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">covariance_matrix</span><span class="o">=</span><span class="n">covs</span><span class="p">)</span>
<span class="n">samples</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">dists</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">perm</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="n">plot_samples</span><span class="p">(</span>
    <span class="n">x</span><span class="p">,</span>
    <span class="n">samples</span><span class="p">,</span>
    <span class="p">[</span><span class="n">bias_variances</span><span class="p">,</span> <span class="n">slope_variances</span><span class="p">,</span> <span class="n">shifts</span><span class="p">,</span> <span class="n">exponents</span><span class="p">],</span>
    <span class="p">[</span><span class="s2">&quot;$</span><span class="se">\\</span><span class="s2">sigma_b$&quot;</span><span class="p">,</span> <span class="s2">&quot;$</span><span class="se">\\</span><span class="s2">sigma_v$&quot;</span><span class="p">,</span> <span class="s2">&quot;$c$&quot;</span><span class="p">,</span> <span class="s2">&quot;$</span><span class="se">\\</span><span class="s2">alpha$&quot;</span><span class="p">],</span>
<span class="p">)</span>
</code></pre></div>

<p><img alt="png" src="/images/GP-Kernels_files/GP-Kernels_109_0.png"></p>
<div class="highlight"><pre><span></span><code><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">X2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">x1</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">40</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">x2</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">40</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">bv</span><span class="p">,</span> <span class="n">sv</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">e</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">]</span>
<span class="n">k</span> <span class="o">=</span> <span class="n">Polynomial</span><span class="p">(</span><span class="n">bias_variance</span><span class="o">=</span><span class="n">bv</span><span class="p">,</span> <span class="n">slope_variance</span><span class="o">=</span><span class="n">sv</span><span class="p">,</span> <span class="n">shift</span><span class="o">=</span><span class="n">c</span><span class="p">,</span> <span class="n">exponent</span><span class="o">=</span><span class="n">e</span><span class="p">,</span> <span class="n">ARD</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">plot_cov_matrix</span><span class="p">(</span>
    <span class="n">k</span><span class="p">,</span> <span class="n">X2</span><span class="p">,</span> <span class="p">[</span><span class="n">bv</span><span class="p">,</span> <span class="n">sv</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">e</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;$</span><span class="se">\\</span><span class="s2">sigma_b$&quot;</span><span class="p">,</span> <span class="s2">&quot;$</span><span class="se">\\</span><span class="s2">sigma_v$&quot;</span><span class="p">,</span> <span class="s2">&quot;$c$&quot;</span><span class="p">,</span> <span class="s2">&quot;$</span><span class="se">\\</span><span class="s2">alpha$&quot;</span><span class="p">]</span>
<span class="p">)</span>
</code></pre></div>

<p><img alt="png" src="/images/GP-Kernels_files/GP-Kernels_110_0.png"></p>
<h3>Gibbs&nbsp;Kernel</h3>
<p>This kernel comes from a non-stationary family of kernels. The <code>length_scale</code> parameter varies with varying inputs. It is expressed&nbsp;as:</p>
<div class="math">$$k(x, x') = \sqrt{\frac{2\ell(x)\ell(x')}{\ell^2(x) + \ell^2(x')}}
                   \mathrm{exp}\left( -\frac{\|x - x'\|^2}
                   {\ell^2(x) + \ell^2(x')} \right)$$</div>
<p>where <span class="math">\(\ell(.)\)</span> is a function of inputs that outputs a different length scale for each of the input&nbsp;points.</p>
<p>The signature of this kernel in PyMC4&nbsp;is</p>
<div class="highlight"><pre><span></span><code><span class="n">k</span> <span class="o">=</span> <span class="n">Gibbs</span><span class="p">(</span><span class="n">length_scale_fn</span><span class="p">,</span> <span class="n">fn_args</span><span class="p">,</span> <span class="n">feature_ndims</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">active_dims</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">scale_diag</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</code></pre></div>

<p>This kernel expects <code>length_scale_fn</code> to have the following&nbsp;signature:</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">length_scale_fn</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">array_like</span><span class="p">,</span> <span class="o">*</span><span class="n">fn_args</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">array_like</span><span class="p">:</span>
    <span class="o">...</span>
</code></pre></div>

<p>The <code>array_like</code> type can be any type of array (numpy array, tensorflow tensor, etc) of the same shape as the input where each entry corresponds to the <code>length_scale</code> for that&nbsp;point.</p>
<h4>Notes</h4>
<p>This kernel is very slow and computationally heavy compared to other kernels. It works best with inputs having a single feature dimension and a single entry in that dimension. This means the inputs should have the shape <code>(..., n, 1)</code> and <code>(..., m, 1)</code>. Other inputs will work but the evaluation will be very&nbsp;slow.</p>
<p>No argument validation is done even when <code>validate_args=True</code>.</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">tanh_fn</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">ls1</span><span class="p">,</span> <span class="n">ls2</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">x0</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    ls1: left saturation value</span>
<span class="sd">    ls2: right saturation value</span>
<span class="sd">    w:   transition width</span>
<span class="sd">    x0:  transition location.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">ls1</span> <span class="o">+</span> <span class="n">ls2</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="p">(</span><span class="n">ls1</span> <span class="o">-</span> <span class="n">ls2</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">tf</span><span class="o">.</span><span class="n">tanh</span><span class="p">((</span><span class="n">x</span> <span class="o">-</span> <span class="n">x0</span><span class="p">)</span> <span class="o">/</span> <span class="n">w</span><span class="p">)</span>


<span class="n">ls1</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
<span class="n">ls2</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">(</span><span class="mf">1.6</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
<span class="n">w</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">(</span><span class="mf">1.3</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
<span class="n">x0</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
<span class="c1"># You can also partial the length_scale function to avoid passing extra argumets.</span>
<span class="c1"># from functools import partial</span>
<span class="c1"># fn = partial(tanh_fn, ls1=ls1, ls2=ls2, w=w, x0=x0)</span>
<span class="n">k</span> <span class="o">=</span> <span class="n">Gibbs</span><span class="p">(</span>
    <span class="n">length_scale_fn</span><span class="o">=</span><span class="n">tanh_fn</span><span class="p">,</span> <span class="n">fn_args</span><span class="o">=</span><span class="p">(</span><span class="n">ls1</span><span class="p">,</span> <span class="n">ls2</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">x0</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="n">ARD</span><span class="o">=</span><span class="kc">False</span>
<span class="p">)</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="c1"># Let&#39;s visualize the tanh function</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">5.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="mi">100</span><span class="p">)[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>

<span class="n">wf</span> <span class="o">=</span> <span class="n">tanh_fn</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">ls1</span><span class="p">,</span> <span class="n">ls2</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">x0</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">wf</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;lengthscale&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;X&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Lengthscale as a function of X&quot;</span><span class="p">);</span>
</code></pre></div>

<p><img alt="png" src="/images/GP-Kernels_files/GP-Kernels_113_0.png"></p>
<div class="highlight"><pre><span></span><code><span class="c1"># Let&#39;s evaluate the covariance matrix.</span>
<span class="n">covs</span> <span class="o">=</span> <span class="n">stabilize</span><span class="p">(</span><span class="n">k</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">),</span> <span class="n">shift</span><span class="o">=</span><span class="mf">1e-8</span><span class="p">)</span>
<span class="n">dists</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">MvNormal</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">covariance_matrix</span><span class="o">=</span><span class="n">covs</span><span class="p">)</span>
<span class="n">samples</span> <span class="o">=</span> <span class="n">dists</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="p">[</span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">samples</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)]</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;X&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>

<p><img alt="png" src="/images/GP-Kernels_files/GP-Kernels_115_0.png"></p>
<div class="highlight"><pre><span></span><code><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">40</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="n">X2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">x1</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">x2</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">k</span> <span class="o">=</span> <span class="n">Gibbs</span><span class="p">(</span>
    <span class="n">length_scale_fn</span><span class="o">=</span><span class="n">tanh_fn</span><span class="p">,</span> <span class="n">fn_args</span><span class="o">=</span><span class="p">(</span><span class="n">ls1</span><span class="p">,</span> <span class="n">ls2</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">x0</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="n">ARD</span><span class="o">=</span><span class="kc">False</span>
<span class="p">)</span>

<span class="n">cov</span> <span class="o">=</span> <span class="n">k</span><span class="p">(</span><span class="n">X2</span><span class="p">,</span> <span class="n">X2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">m</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">cov</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;inferno&quot;</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">m</span><span class="p">);</span>
</code></pre></div>

<p><img alt="png" src="/images/GP-Kernels_files/GP-Kernels_116_0.png"></p>
<h3>Scaled Covariance&nbsp;Kernel</h3>
<p>This kernel uses a scaling function to scale the covariance between two points evaluated using some other kernel. This scaling function is a function of the inputs and returns an output of the same shape. It can be expressed&nbsp;as</p>
<div class="math">$$k'(x,x') = f(x) k(x,x')$$</div>
<p>where <span class="math">\(k(x,x')\)</span> is the kernel function used to evaluate the covariance matrix and <span class="math">\(f(x, \theta)\)</span> is the scaling function of the inputs <span class="math">\(x\)</span> and some <span class="math">\(\theta\)</span> that can be inferred during&nbsp;sampling/inference.</p>
<p>Its signature in PyMC4&nbsp;is</p>
<div class="highlight"><pre><span></span><code><span class="n">k</span> <span class="o">=</span> <span class="n">ScaledCov</span><span class="p">(</span><span class="n">kernel</span><span class="p">,</span> <span class="n">scaling_fn</span><span class="p">,</span> <span class="n">fn_args</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</code></pre></div>

<p>This kernel expects the function <code>scaling_fn</code> to have a&nbsp;signature</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">scaling_fn</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">array_like</span><span class="p">,</span> <span class="o">*</span><span class="n">fn_args</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">array_like</span><span class="p">:</span>
    <span class="o">...</span>
</code></pre></div>

<p>It must return an array of the same shape as that of the input <code>x</code>.</p>
<h4>Notes</h4>
<p>This kernel doesn&#8217;t perform argument validation even when <code>validate_args=True</code>.</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">logistic</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
    <span class="c1"># a is the slope, x0 is the location</span>
    <span class="c1"># d is the coefficient of the sigmoid term</span>
    <span class="c1"># c is the bias of the linear equation</span>
    <span class="k">return</span> <span class="n">d</span> <span class="o">*</span> <span class="n">tf</span><span class="o">.</span><span class="n">sigmoid</span><span class="p">(</span><span class="n">a</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">x0</span><span class="p">))</span> <span class="o">+</span> <span class="n">c</span>


<span class="n">a</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">(</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
<span class="n">x0</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">(</span><span class="mf">5.0</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
<span class="n">c</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
<span class="n">d</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">(</span><span class="mf">10.0</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>

<span class="n">kernel</span> <span class="o">=</span> <span class="n">ExpQuad</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">(</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">),</span> <span class="n">ARD</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">k</span> <span class="o">=</span> <span class="n">ScaledCov</span><span class="p">(</span><span class="n">kernel</span><span class="o">=</span><span class="n">kernel</span><span class="p">,</span> <span class="n">scaling_fn</span><span class="o">=</span><span class="n">logistic</span><span class="p">,</span> <span class="n">fn_args</span><span class="o">=</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">),</span> <span class="n">ARD</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="c1"># Let&#39;s visualize the logistic function.</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">3.0</span><span class="p">,</span> <span class="mf">13.0</span><span class="p">,</span> <span class="mi">500</span><span class="p">)[:,</span> <span class="kc">None</span><span class="p">]</span>
<span class="n">lfunc</span> <span class="o">=</span> <span class="n">logistic</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">lfunc</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;X&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;$\phi(x)$&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;The scaling function&quot;</span><span class="p">);</span>
</code></pre></div>

<p><img alt="png" src="/images/GP-Kernels_files/GP-Kernels_119_0.png"></p>
<div class="highlight"><pre><span></span><code><span class="c1"># Let&#39;s evaluate the covariance matrix.</span>
<span class="n">covs</span> <span class="o">=</span> <span class="n">stabilize</span><span class="p">(</span><span class="n">k</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">),</span> <span class="n">shift</span><span class="o">=</span><span class="mf">1e-8</span><span class="p">)</span>
<span class="n">dists</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">MvNormal</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">covariance_matrix</span><span class="o">=</span><span class="n">covs</span><span class="p">)</span>
<span class="n">samples</span> <span class="o">=</span> <span class="n">dists</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="p">[</span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">samples</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)]</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;X&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>

<p><img alt="png" src="/images/GP-Kernels_files/GP-Kernels_121_0.png"></p>
<div class="highlight"><pre><span></span><code><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">50</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="n">X2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">x1</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">150</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">x2</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">150</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">ls</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.2</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">]</span>
<span class="n">kernel</span> <span class="o">=</span> <span class="n">ExpQuad</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">(</span><span class="n">ls</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">),</span> <span class="n">ARD</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">k</span> <span class="o">=</span> <span class="n">ScaledCov</span><span class="p">(</span><span class="n">kernel</span><span class="o">=</span><span class="n">kernel</span><span class="p">,</span> <span class="n">scaling_fn</span><span class="o">=</span><span class="n">logistic</span><span class="p">,</span> <span class="n">fn_args</span><span class="o">=</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">),</span> <span class="n">ARD</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">plot_cov_matrix</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">X2</span><span class="p">,</span> <span class="p">[</span><span class="n">ls</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;$</span><span class="se">\\</span><span class="s2">ell$&quot;</span><span class="p">])</span>
</code></pre></div>

<p><img alt="png" src="/images/GP-Kernels_files/GP-Kernels_122_0.png"></p>
<h3>Warped Input&nbsp;Kernel</h3>
<p>This kernel transforms the input using a transformation function and uses it instead to evaluate the covariance matrix. This is also called <code>FeatureTransformed</code> kernel. It&#8217;s mathematical form&nbsp;is</p>
<div class="math">$$k'(x,x') = k(f(x), f(x'))$$</div>
<p>where <span class="math">\(f(.)\)</span> is a warping (transformation)&nbsp;function.</p>
<p>Its signature in PyMC4&nbsp;is</p>
<div class="highlight"><pre><span></span><code><span class="n">k</span> <span class="o">=</span> <span class="n">WarpedInput</span><span class="p">(</span><span class="n">kernel</span><span class="p">,</span> <span class="n">warp_fn</span><span class="p">,</span> <span class="n">fn_args</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</code></pre></div>

<p>It expects the signature of function <code>warp_fn</code> to&nbsp;be:</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">warp_fn</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">array_like</span><span class="p">,</span> <span class="o">*</span><span class="n">fn_args</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">array_like</span><span class="p">:</span>
    <span class="o">...</span>
</code></pre></div>

<p>Below is an example of constructing a <code>Periodic</code> kernel using the warped input&nbsp;kernel!</p>
<h4>Notes</h4>
<p>This kernel doesn&#8217;t perform argument validation even if <code>validate_args=True</code>.</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">mapping</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">T</span><span class="p">):</span>
    <span class="n">c</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="n">T</span><span class="p">)</span>
    <span class="n">u</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">concat</span><span class="p">((</span><span class="n">tf</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">c</span> <span class="o">*</span> <span class="n">x</span><span class="p">),</span> <span class="n">tf</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">c</span> <span class="o">*</span> <span class="n">x</span><span class="p">)),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">u</span>


<span class="n">T</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">(</span><span class="mf">0.6</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
<span class="n">ls</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">(</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>

<span class="n">kernel</span> <span class="o">=</span> <span class="n">ExpQuad</span><span class="p">(</span><span class="n">ls</span><span class="p">,</span> <span class="n">ARD</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">k</span> <span class="o">=</span> <span class="n">WarpedInput</span><span class="p">(</span><span class="n">kernel</span><span class="o">=</span><span class="n">kernel</span><span class="p">,</span> <span class="n">warp_fn</span><span class="o">=</span><span class="n">mapping</span><span class="p">,</span> <span class="n">fn_args</span><span class="o">=</span><span class="p">(</span><span class="n">T</span><span class="p">,),</span> <span class="n">ARD</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">400</span><span class="p">)[:,</span> <span class="kc">None</span><span class="p">]</span>
<span class="n">covs</span> <span class="o">=</span> <span class="n">stabilize</span><span class="p">(</span><span class="n">k</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">),</span> <span class="n">shift</span><span class="o">=</span><span class="mf">1e-8</span><span class="p">)</span>
<span class="n">dists</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">MvNormal</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">covariance_matrix</span><span class="o">=</span><span class="n">covs</span><span class="p">)</span>
<span class="n">samples</span> <span class="o">=</span> <span class="n">dists</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="p">[</span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">samples</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)]</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;X&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>

<p><img alt="png" src="/images/GP-Kernels_files/GP-Kernels_126_0.png"></p>
<div class="highlight"><pre><span></span><code><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">50</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="n">X2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">x1</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">150</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">x2</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">150</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">ls</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">([</span><span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
<span class="n">kernel</span> <span class="o">=</span> <span class="n">ExpQuad</span><span class="p">(</span><span class="n">ls</span><span class="p">,</span> <span class="n">ARD</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">k</span> <span class="o">=</span> <span class="n">WarpedInput</span><span class="p">(</span><span class="n">kernel</span><span class="o">=</span><span class="n">kernel</span><span class="p">,</span> <span class="n">warp_fn</span><span class="o">=</span><span class="n">mapping</span><span class="p">,</span> <span class="n">fn_args</span><span class="o">=</span><span class="p">(</span><span class="n">T</span><span class="p">,),</span> <span class="n">ARD</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">plot_cov_matrix</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">X2</span><span class="p">,</span> <span class="p">[</span><span class="n">ls</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;$</span><span class="se">\\</span><span class="s2">ell$&quot;</span><span class="p">])</span>
</code></pre></div>

<p><img alt="png" src="/images/GP-Kernels_files/GP-Kernels_127_0.png"></p>
<h2>Combinations of&nbsp;Kernel</h2>
<p>PyMC4 allows combinations of kernels to generate new kernels. This can be very helpful to construct new kernels that aren&#8217;t directly imlemented in PyMC4. This&nbsp;includes</p>
<ul>
<li><a href="#Locally-Periodic-Kernel">Locally Periodic&nbsp;Kernel.</a></li>
<li><a href="#Changepoint-Kernel">Changepoint&nbsp;Kernel.</a></li>
</ul>
<p>This section shows how to use both addition and multiplication on&nbsp;kernels.</p>
<h3>Locally Periodic&nbsp;Kernel</h3>
<p>Locally Periodic kernel is a product of the <code>ExpQuad</code> and periodic kernel. Its mathematical formula&nbsp;is</p>
<div class="math">$$k_{\textrm{LocalPer}}(x, x') = k_{\textrm{Per}}(x, x')k_{\textrm{SE}}(x, x') = \sigma^2\exp\left(-\frac{2\sin^2(\frac{\pi|x - x'|}{T})}{\ell^2}\right) \exp\left(-\frac{\|x - x'\|^2}{2\ell^2}\right)$$</div>
<p>It can be impemented in PyMC4 using the product <code>*</code> operator.</p>
<div class="highlight"><pre><span></span><code><span class="n">k</span> <span class="o">=</span> <span class="n">ExpQuad</span><span class="p">(</span><span class="n">length_scale</span><span class="p">,</span> <span class="n">amplitude</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span> <span class="o">*</span> <span class="n">Periodic</span><span class="p">(</span><span class="n">length_scale</span><span class="p">,</span> <span class="n">amplitude</span><span class="p">,</span> <span class="n">period</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>
</code></pre></div>

<p>This new kernel <code>k</code> has all the methods that other covariance functions&nbsp;have.</p>
<h4>Example&nbsp;1</h4>
<div class="highlight"><pre><span></span><code><span class="n">ls</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">([</span><span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
<span class="n">amp</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>

<span class="n">k1</span> <span class="o">=</span> <span class="n">ExpQuad</span><span class="p">(</span><span class="n">length_scale</span><span class="o">=</span><span class="n">ls</span><span class="p">,</span> <span class="n">amplitude</span><span class="o">=</span><span class="n">amp</span><span class="p">,</span> <span class="n">ARD</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">periods</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">([</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>

<span class="n">k2</span> <span class="o">=</span> <span class="n">Periodic</span><span class="p">(</span><span class="n">length_scale</span><span class="o">=</span><span class="n">ls</span><span class="p">,</span> <span class="n">amplitude</span><span class="o">=</span><span class="n">amp</span><span class="p">,</span> <span class="n">period</span><span class="o">=</span><span class="n">periods</span><span class="p">,</span> <span class="n">ARD</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">k</span> <span class="o">=</span> <span class="n">k1</span> <span class="o">*</span> <span class="n">k2</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="mi">500</span><span class="p">)[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>

<span class="n">covs</span> <span class="o">=</span> <span class="n">stabilize</span><span class="p">(</span><span class="n">k</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">),</span> <span class="n">shift</span><span class="o">=</span><span class="mf">1e-8</span><span class="p">)</span>
<span class="n">dists</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">MvNormal</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">covariance_matrix</span><span class="o">=</span><span class="n">covs</span><span class="p">)</span>
<span class="n">samples</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">dists</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">perm</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="n">plot_samples</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">samples</span><span class="p">,</span> <span class="p">[</span><span class="n">ls</span><span class="p">,</span> <span class="n">amp</span><span class="p">,</span> <span class="n">periods</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;$</span><span class="se">\\</span><span class="s2">ell$&quot;</span><span class="p">,</span> <span class="s2">&quot;$</span><span class="se">\\</span><span class="s2">sigma$&quot;</span><span class="p">,</span> <span class="s2">&quot;$T$&quot;</span><span class="p">])</span>
</code></pre></div>

<p><img alt="png" src="/images/GP-Kernels_files/GP-Kernels_133_0.png"></p>
<h4>Example&nbsp;2</h4>
<div class="highlight"><pre><span></span><code><span class="n">ls</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">([</span><span class="mf">1.4</span><span class="p">,</span> <span class="mf">1.4</span><span class="p">,</span> <span class="mf">1.4</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
<span class="n">amp</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">([</span><span class="mf">2.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>

<span class="n">k1</span> <span class="o">=</span> <span class="n">ExpQuad</span><span class="p">(</span><span class="n">length_scale</span><span class="o">=</span><span class="n">ls</span><span class="p">,</span> <span class="n">amplitude</span><span class="o">=</span><span class="n">amp</span><span class="p">,</span> <span class="n">ARD</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">periods</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">([</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>

<span class="n">k2</span> <span class="o">=</span> <span class="n">Periodic</span><span class="p">(</span><span class="n">length_scale</span><span class="o">=</span><span class="n">ls</span><span class="p">,</span> <span class="n">amplitude</span><span class="o">=</span><span class="n">amp</span><span class="p">,</span> <span class="n">period</span><span class="o">=</span><span class="n">periods</span><span class="p">,</span> <span class="n">ARD</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">k</span> <span class="o">=</span> <span class="n">k1</span> <span class="o">*</span> <span class="n">k2</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="mi">500</span><span class="p">)[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>

<span class="n">covs</span> <span class="o">=</span> <span class="n">stabilize</span><span class="p">(</span><span class="n">k</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">),</span> <span class="n">shift</span><span class="o">=</span><span class="mf">1e-8</span><span class="p">)</span>
<span class="n">dists</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">MvNormal</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">covariance_matrix</span><span class="o">=</span><span class="n">covs</span><span class="p">)</span>
<span class="n">samples</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">dists</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">perm</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="n">plot_samples</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">samples</span><span class="p">,</span> <span class="p">[</span><span class="n">ls</span><span class="p">,</span> <span class="n">amp</span><span class="p">,</span> <span class="n">periods</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;$</span><span class="se">\\</span><span class="s2">ell$&quot;</span><span class="p">,</span> <span class="s2">&quot;$</span><span class="se">\\</span><span class="s2">sigma$&quot;</span><span class="p">,</span> <span class="s2">&quot;$T$&quot;</span><span class="p">])</span>
</code></pre></div>

<p><img alt="png" src="/images/GP-Kernels_files/GP-Kernels_137_0.png"></p>
<h3>Changepoint&nbsp;Kernel</h3>
<p>The <code>ScaledCov</code> kernel can be used to create the <code>Changepoint</code> covariance. This covariance models a process that gradually transitions from one type of behavior to&nbsp;another.</p>
<p>The changepoint kernel is given&nbsp;by</p>
<div class="math">$$k(x,x') = \phi(x)k_1(x,x')\phi(x') + (1-\phi(x))k_2(x,x')(1-\phi(x'))$$</div>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">logistic</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">x0</span><span class="p">):</span>
    <span class="c1"># a is the slope, x0 is the location</span>
    <span class="k">return</span> <span class="n">tf</span><span class="o">.</span><span class="n">sigmoid</span><span class="p">(</span><span class="n">a</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">x0</span><span class="p">))</span>


<span class="n">a</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">(</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
<span class="n">x0</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">(</span><span class="mf">5.0</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>

<span class="n">k1</span> <span class="o">=</span> <span class="n">ScaledCov</span><span class="p">(</span>
    <span class="n">kernel</span><span class="o">=</span><span class="n">ExpQuad</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="mf">0.2</span><span class="p">),</span> <span class="n">ARD</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
    <span class="n">scaling_fn</span><span class="o">=</span><span class="n">logistic</span><span class="p">,</span>
    <span class="n">fn_args</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="n">a</span><span class="p">,</span> <span class="n">x0</span><span class="p">),</span>
    <span class="n">ARD</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">k2</span> <span class="o">=</span> <span class="n">ScaledCov</span><span class="p">(</span>
    <span class="n">kernel</span><span class="o">=</span><span class="n">Cosine</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="mf">0.5</span><span class="p">),</span> <span class="n">ARD</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
    <span class="n">scaling_fn</span><span class="o">=</span><span class="n">logistic</span><span class="p">,</span>
    <span class="n">fn_args</span><span class="o">=</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">x0</span><span class="p">),</span>
    <span class="n">ARD</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">k</span> <span class="o">=</span> <span class="n">k1</span> <span class="o">+</span> <span class="n">k2</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">400</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span>
    <span class="n">x</span><span class="p">,</span>
    <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">400</span><span class="p">),</span>
    <span class="n">logistic</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="o">-</span><span class="n">a</span><span class="p">,</span> <span class="n">x0</span><span class="p">),</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;ExpQuad region&quot;</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;slateblue&quot;</span><span class="p">,</span>
    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span>
    <span class="n">x</span><span class="p">,</span>
    <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">400</span><span class="p">),</span>
    <span class="n">logistic</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">x0</span><span class="p">),</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Cosine region&quot;</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;firebrick&quot;</span><span class="p">,</span>
    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;X&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;$\phi(x)$&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;The two scaling functions&quot;</span><span class="p">);</span>
</code></pre></div>

<p><img alt="png" src="/images/GP-Kernels_files/GP-Kernels_140_0.png"></p>
<div class="highlight"><pre><span></span><code><span class="n">covs</span> <span class="o">=</span> <span class="n">stabilize</span><span class="p">(</span><span class="n">k</span><span class="p">(</span><span class="n">x</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">],</span> <span class="n">x</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">]),</span> <span class="n">shift</span><span class="o">=</span><span class="mf">1e-8</span><span class="p">)</span>
<span class="n">dists</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">MvNormal</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">covariance_matrix</span><span class="o">=</span><span class="n">covs</span><span class="p">)</span>
<span class="n">samples</span> <span class="o">=</span> <span class="n">dists</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="p">[</span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">samples</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)]</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;X&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>

<p><img alt="png" src="/images/GP-Kernels_files/GP-Kernels_142_0.png"></p>
<div class="highlight"><pre><span></span><code><span class="o">%</span><span class="n">load_ext</span> <span class="n">watermark</span>
<span class="o">%</span><span class="n">watermark</span> <span class="o">-</span><span class="n">n</span> <span class="o">-</span><span class="n">u</span> <span class="o">-</span><span class="n">v</span> <span class="o">-</span><span class="n">iv</span> <span class="o">-</span><span class="n">w</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code>pymc4      4.0a2
numpy      1.18.5
tensorflow 2.3.0-dev20200608
arviz      0.8.3
last updated: Thu Jul 02 2020 

CPython 3.7.3
IPython 7.15.0
watermark 2.0.2
</code></pre></div>

<h2>References</h2>
<ul>
<li><a href="https://scikit-learn.org/stable/modules/generated/sklearn.gaussian_process.kernels.Matern.html">SciKit-Learn Matern Kernels&nbsp;Documentation</a></li>
<li><a href="https://www.cs.toronto.edu/~duvenaud/cookbook/">The Kernel Cookbook by David&nbsp;Duvenaud</a></li>
<li><a href="https://github.com/pymc-devs/pymc3/blob/master/docs/source/notebooks/GP-MeansAndCovs.ipynb">PyMC3&#8217;s <span class="caps">GP</span>&nbsp;submodule</a></li>
</ul>
<script type="text/javascript">if (!document.getElementById('mathjaxscript_pelican_#%@#$@#')) {
    var align = "center",
        indent = "0em",
        linebreak = "false";

    if (false) {
        align = (screen.width < 768) ? "left" : align;
        indent = (screen.width < 768) ? "0em" : indent;
        linebreak = (screen.width < 768) ? 'true' : linebreak;
    }

    var mathjaxscript = document.createElement('script');
    mathjaxscript.id = 'mathjaxscript_pelican_#%@#$@#';
    mathjaxscript.type = 'text/javascript';
    mathjaxscript.src = 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.3/latest.js?config=TeX-AMS-MML_HTMLorMML';

    var configscript = document.createElement('script');
    configscript.type = 'text/x-mathjax-config';
    configscript[(window.opera ? "innerHTML" : "text")] =
        "MathJax.Hub.Config({" +
        "    config: ['MMLorHTML.js']," +
        "    TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'none' } }," +
        "    jax: ['input/TeX','input/MathML','output/HTML-CSS']," +
        "    extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']," +
        "    displayAlign: '"+ align +"'," +
        "    displayIndent: '"+ indent +"'," +
        "    showMathMenu: true," +
        "    messageStyle: 'normal'," +
        "    tex2jax: { " +
        "        inlineMath: [ ['\\\\(','\\\\)'] ], " +
        "        displayMath: [ ['$$','$$'] ]," +
        "        processEscapes: true," +
        "        preview: 'TeX'," +
        "    }, " +
        "    'HTML-CSS': { " +
        "        availableFonts: ['STIX', 'TeX']," +
        "        preferredFont: 'STIX'," +
        "        styles: { '.MathJax_Display, .MathJax .mo, .MathJax .mi, .MathJax .mn': {color: 'inherit ! important'} }," +
        "        linebreaks: { automatic: "+ linebreak +", width: '90% container' }," +
        "    }, " +
        "}); " +
        "if ('default' !== 'default') {" +
            "MathJax.Hub.Register.StartupHook('HTML-CSS Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax['HTML-CSS'].FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
            "MathJax.Hub.Register.StartupHook('SVG Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax.SVG.FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
        "}";

    (document.body || document.getElementsByTagName('head')[0]).appendChild(configscript);
    (document.body || document.getElementsByTagName('head')[0]).appendChild(mathjaxscript);
}
</script>
                </div><!-- /.entry-content -->
        </article>
</section>
        </div><!--/span-->

                <div class="span3 well sidebar-nav" id="sidebar">
<ul class="nav nav-list">

<li class="nav-header"><h4><i class="icon-folder-close icon-large"></i>Categories</h4></li>
<li>
<a href="/category/gsoc-2020/">
    <i class="icon-folder-open icon-large"></i>GSoC 2020
</a>
</li>
<li>
<a href="/category/gsoc-2021/">
    <i class="icon-folder-open icon-large"></i>GSoC 2021
</a>
</li>
<li>
<a href="/category/rng/">
    <i class="icon-folder-open icon-large"></i>RNG
</a>
</li>
<li>
<a href="/category/scipy/">
    <i class="icon-folder-open icon-large"></i>SciPy
</a>
</li>

<li class="nav-header"><h4><i class="icon-tags icon-large"></i>Tags</h4></li>


</ul>        </div><!--/.well -->

      </div><!--/row-->

      <hr>

      <footer>
        <address id="about">
                Proudly powered by <a href="http://pelican.notmyidea.org/">Pelican <i class="icon-external-link"></i></a>,
                                which takes great advantage of <a href="http://python.org">Python <i class="icon-external-link"></i></a>.
        </address><!-- /#about -->

        <p>The theme is from <a href="http://twitter.github.com/bootstrap/">Bootstrap from Twitter <i class="icon-external-link"></i></a>,
                   and <a href="http://fortawesome.github.com/Font-Awesome/">Font-Awesome <i class="icon-external-link"></i></a>, thanks!</p>
      </footer>

    </div><!--/.fluid-container-->



    <!-- Le javascript -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="/theme/js/jquery-1.7.2.min.js"></script>
    <script src="/theme/js/bootstrap.min.js"></script>
  </body>
</html>