

<!doctype html>
<html lang="en" class="no-js">
  <head>
    

<meta charset="utf-8">



<!-- begin SEO -->









<title>Kernels for GP Modelling in PyMC4. - Tirth Patel</title>







<meta property="og:locale" content="en-US">
<meta property="og:site_name" content="Tirth Patel">
<meta property="og:title" content="Kernels for GP Modelling in PyMC4.">


  <link rel="canonical" href="http://localhost:4000/gsoc2020/kernels-for-gp-modelling-in-pymc4">
  <meta property="og:url" content="http://localhost:4000/gsoc2020/kernels-for-gp-modelling-in-pymc4">



  <meta property="og:description" content="Ungergrad student at Nirma University. GSoC’20 @NumFOCUS with PyMC3">





  

  





  <meta property="og:type" content="article">
  <meta property="article:published_time" content="2020-07-03T00:00:00-07:00">








  <script type="application/ld+json">
    {
      "@context" : "http://schema.org",
      "@type" : "Person",
      "name" : "Tirth Patel",
      "url" : "http://localhost:4000",
      "sameAs" : null
    }
  </script>






<!-- end SEO -->


<link href="http://localhost:4000/feed.xml" type="application/atom+xml" rel="alternate" title="Tirth Patel Feed">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="http://localhost:4000/assets/css/main.css">

<meta http-equiv="cleartype" content="on">
    

<!-- start custom head snippets -->

<link rel="apple-touch-icon" sizes="57x57" href="http://localhost:4000/images/apple-touch-icon-57x57.png?v=M44lzPylqQ">
<link rel="apple-touch-icon" sizes="60x60" href="http://localhost:4000/images/apple-touch-icon-60x60.png?v=M44lzPylqQ">
<link rel="apple-touch-icon" sizes="72x72" href="http://localhost:4000/images/apple-touch-icon-72x72.png?v=M44lzPylqQ">
<link rel="apple-touch-icon" sizes="76x76" href="http://localhost:4000/images/apple-touch-icon-76x76.png?v=M44lzPylqQ">
<link rel="apple-touch-icon" sizes="114x114" href="http://localhost:4000/images/apple-touch-icon-114x114.png?v=M44lzPylqQ">
<link rel="apple-touch-icon" sizes="120x120" href="http://localhost:4000/images/apple-touch-icon-120x120.png?v=M44lzPylqQ">
<link rel="apple-touch-icon" sizes="144x144" href="http://localhost:4000/images/apple-touch-icon-144x144.png?v=M44lzPylqQ">
<link rel="apple-touch-icon" sizes="152x152" href="http://localhost:4000/images/apple-touch-icon-152x152.png?v=M44lzPylqQ">
<link rel="apple-touch-icon" sizes="180x180" href="http://localhost:4000/images/apple-touch-icon-180x180.png?v=M44lzPylqQ">
<link rel="icon" type="image/png" href="http://localhost:4000/images/favicon-32x32.png?v=M44lzPylqQ" sizes="32x32">
<link rel="icon" type="image/png" href="http://localhost:4000/images/android-chrome-192x192.png?v=M44lzPylqQ" sizes="192x192">
<link rel="icon" type="image/png" href="http://localhost:4000/images/favicon-96x96.png?v=M44lzPylqQ" sizes="96x96">
<link rel="icon" type="image/png" href="http://localhost:4000/images/favicon-16x16.png?v=M44lzPylqQ" sizes="16x16">
<link rel="manifest" href="http://localhost:4000/images/manifest.json?v=M44lzPylqQ">
<link rel="mask-icon" href="http://localhost:4000/images/safari-pinned-tab.svg?v=M44lzPylqQ" color="#000000">
<link rel="shortcut icon" href="/images/favicon.ico?v=M44lzPylqQ">
<meta name="msapplication-TileColor" content="#000000">
<meta name="msapplication-TileImage" content="http://localhost:4000/images/mstile-144x144.png?v=M44lzPylqQ">
<meta name="msapplication-config" content="http://localhost:4000/images/browserconfig.xml?v=M44lzPylqQ">
<meta name="theme-color" content="#ffffff">
<link rel="stylesheet" href="http://localhost:4000/assets/css/academicons.css"/>

<script type="text/x-mathjax-config"> MathJax.Hub.Config({ TeX: { equationNumbers: { autoNumber: "all" } } }); </script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
</script>
<script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/latest.js?config=TeX-MML-AM_CHTML' async></script>

<!-- end custom head snippets -->

  </head>

  <body>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->
    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        <button><div class="navicon"></div></button>
        <ul class="visible-links">
          <li class="masthead__menu-item masthead__menu-item--lg"><a href="http://localhost:4000/">Tirth Patel</a></li>
          
            
            <li class="masthead__menu-item"><a href="http://localhost:4000/year-archive/">Blog Posts</a></li>
          
            
            <li class="masthead__menu-item"><a href="http://localhost:4000/gsoc2020/">GSoC 2020</a></li>
          
            
            <li class="masthead__menu-item"><a href="http://localhost:4000/cv/">CV</a></li>
          
        </ul>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>

    





<div id="main" role="main">
  



  <article class="page" itemscope itemtype="http://schema.org/CreativeWork">
    <meta itemprop="headline" content="Kernels for GP Modelling in PyMC4.">
    <meta itemprop="description" content="">
    <meta itemprop="datePublished" content="July 03, 2020">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 class="page__title" itemprop="headline">Kernels for GP Modelling in PyMC4.
</h1>
          
            <p class="page__meta"><i class="fa fa-clock-o" aria-hidden="true"></i> 


  
	  32 minute read
	
</p>
          
        
        
        
          <p class="page__date"><strong><i class="fa fa-fw fa-calendar" aria-hidden="true"></i> Published:</strong> <time datetime="2020-07-03T00:00:00-07:00">July 03, 2020</time></p>
        
        
             
        
    
        </header>
      

      <section class="page__content" itemprop="text">
        <h1 id="kernels-for-gp-modelling-in-pymc4">Kernels for GP Modelling in PyMC4.</h1>

<p>In this tutorial, we will explore the covariance functions aka kernels present in <code class="language-plaintext highlighter-rouge">pm.gp</code> module and study their properties. This will help choose the appropriate kernel to model your data properly. We will also see the semantics of additive and multiplicative kernels.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">arviz</span> <span class="k">as</span> <span class="n">az</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">import</span> <span class="nn">matplotlib.cm</span> <span class="k">as</span> <span class="n">cmap</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>

<span class="kn">import</span> <span class="nn">pymc4</span> <span class="k">as</span> <span class="n">pm</span>
<span class="kn">from</span> <span class="nn">pymc4.gp.cov</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">pymc4.gp.util</span> <span class="kn">import</span> <span class="n">stabilize</span>

<span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="n">tf</span>

<span class="kn">from</span> <span class="nn">utils</span> <span class="kn">import</span> <span class="n">plot_samples</span><span class="p">,</span> <span class="n">plot_cov_matrix</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">%</span><span class="n">config</span> <span class="n">InlineBackend</span><span class="p">.</span><span class="n">figure_format</span> <span class="o">=</span> <span class="s">'retina'</span>
<span class="n">RANDOM_SEED</span> <span class="o">=</span> <span class="mi">4200</span>
<span class="n">tf</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="n">set_seed</span><span class="p">(</span><span class="n">RANDOM_SEED</span><span class="p">)</span>
<span class="n">az</span><span class="p">.</span><span class="n">style</span><span class="p">.</span><span class="n">use</span><span class="p">(</span><span class="s">'arviz-darkgrid'</span><span class="p">)</span>
</code></pre></div></div>

<h2 id="basic-api-walkthrough">Basic API Walkthrough</h2>

<p>Let’s start with a basic kernel called the constant kernel. Using this kernel, I will walk you through the basic API for working with any kernel function in GP.</p>

<p>The constant kernel just evaluates to a constant value in each entry of the covariance matrix irrespective of the input. It is very useful as a lightweight kernel when speed and performance is a primary goal. It doesn’t evaluate a complex function and so its gradients are faster and easier to compute.</p>

<p>The mathematical formula of the constant kernel is pretty straight forward:</p>

\[k(x, x') = c\]

<p>The signature of the constant kernel implemented in <code class="language-plaintext highlighter-rouge">pymc4</code> is:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">K</span> <span class="o">=</span> <span class="n">Constant</span><span class="p">(</span><span class="n">coef</span><span class="p">,</span> <span class="n">feature_ndims</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">active_dims</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">scale_diag</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>
</code></pre></div></div>

<p>The first argument <code class="language-plaintext highlighter-rouge">coef</code> to the constructor is the constant value <code class="language-plaintext highlighter-rouge">c</code> which represents the covariance between any two points. Thus, the covariance matrix just evaluates to this constant value.</p>

<p>The argument <code class="language-plaintext highlighter-rouge">feature_ndims</code> is the number of feature dimensions of the input between which you want to evaluate the covariance. We will see the effect of this argument later.</p>

<p>The third argument <code class="language-plaintext highlighter-rouge">active_dims</code> is the feature or the number of features of each of the <code class="language-plaintext highlighter-rouge">feature_ndims</code> number of feature dimensions that will be considered during the computation. We will explore this in detail later.</p>

<p>The last argument <code class="language-plaintext highlighter-rouge">scale_diag</code> is used to perform <strong>A</strong>utomatic <strong>R</strong>elevance <strong>D</strong>etermination (ARD) and is a scaling factor of the <code class="language-plaintext highlighter-rouge">length_scale</code> parameter of stationary covariance kernels.</p>

<p>One important boolean keyword argument is <code class="language-plaintext highlighter-rouge">ARD</code> that tells <code class="language-plaintext highlighter-rouge">pymc4</code> whether or not to perform ARD while modeling GPs. Its default value is <code class="language-plaintext highlighter-rouge">True</code>. A little overhead is incurred when <code class="language-plaintext highlighter-rouge">ARD</code> is enabled.</p>

<p>These four arguments <code class="language-plaintext highlighter-rouge">feature_ndims</code>, <code class="language-plaintext highlighter-rouge">active_dims</code>, <code class="language-plaintext highlighter-rouge">scale_diag</code>, and <code class="language-plaintext highlighter-rouge">ARD</code> are common in all the kernels implemented in <code class="language-plaintext highlighter-rouge">pymc4</code> and optional.</p>

<p>Other keywords arguments that can be passed are:</p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">validate_args</code>: A boolean indicating whether or not to validate arguments. Incurs a little overhead when set to <code class="language-plaintext highlighter-rouge">True</code>. Its default value is <code class="language-plaintext highlighter-rouge">False</code>.</li>
  <li><code class="language-plaintext highlighter-rouge">name</code>: You can optionally give a name to the kernels. All the operations will be preformed under that name.</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">coef</span> <span class="o">=</span> <span class="mf">1.0</span>

<span class="n">k</span> <span class="o">=</span> <span class="n">Constant</span><span class="p">(</span><span class="n">coef</span><span class="o">=</span><span class="n">coef</span><span class="p">,</span> <span class="n">ARD</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</code></pre></div></div>

<p>We can call the kernel object <code class="language-plaintext highlighter-rouge">k</code> to evaluate the covariance matrix between two arrays or tensors of points. It outputs a covariance matrix which is a <code class="language-plaintext highlighter-rouge">tf.Tensor</code> object.</p>

<p>It accepts any inputs with the shape of the form <code class="language-plaintext highlighter-rouge">(batch_shapes_1, m, features_1)</code> and <code class="language-plaintext highlighter-rouge">(batch_shapes_2, n, features_2)</code>. <code class="language-plaintext highlighter-rouge">batch_shapes_1</code> is the batch shape of the first tensor and <code class="language-plaintext highlighter-rouge">batch_shapes_2</code> is the batch shape of the second tensor. Multiple batches can be stacked together. Batch shapes must be equal or broadcastable according to the <a href="https://numpy.org/doc/stable/user/basics.broadcasting.html#general-broadcasting-rules">numpy’s rules for broadcasting</a>. <code class="language-plaintext highlighter-rouge">features_1</code> and <code class="language-plaintext highlighter-rouge">features_2</code> are the feature dimensions and their length must be equal to <code class="language-plaintext highlighter-rouge">feature_ndims</code>. The feature dimensions don’t need to be broadcastable. When the kernel object <code class="language-plaintext highlighter-rouge">k</code> is called on such inputs, it outputs a tensor of shape <code class="language-plaintext highlighter-rouge">(broadcasted_batch_shapes, m, n)</code> where <code class="language-plaintext highlighter-rouge">broadcasted_batch_shapes</code> is the broadcasted batch shape.</p>

<p>As an outer product is taken along all the entries of each <code class="language-plaintext highlighter-rouge">feature_ndims</code> dimensions, the output doesn’t contain these dimensions. Hence, having two feature dimensions of shape <code class="language-plaintext highlighter-rouge">(3, 3)</code> yields the same result as having a single feature dimension with all the <code class="language-plaintext highlighter-rouge">9</code> nine entries.</p>

<p>For example, take two inputs with the following shape:</p>

<pre><code class="language-none">x1 has shape `(5, 4, 1, 40, 2, 2)`
x2 has shape `(5, 1, 3, 80, 2, 2)`
              |______| |__| |___|
                 |      |     |
       batch_shapes     |   feature_ndims
                      points
</code></pre>

<p>Such input will produce an output of shape:</p>

<pre><code class="language-none">k(x1, x2) has shape `(5, 4, 3, 40, 80)`
                     |______| |__||__|
                        |      |   |
  broadcasted_batch_shapes     |   points in x2
                      points in x1
</code></pre>

<p>Let’s see some more examples</p>

<h4 id="example-1--only-one-batch-and-one-feature-dimension">Example 1 : Only one batch and one feature dimension.</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">x1</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">],</span> <span class="p">[</span><span class="mf">3.0</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">]])</span>
<span class="n">x2</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">5.0</span><span class="p">,</span> <span class="mf">6.0</span><span class="p">],</span> <span class="p">[</span><span class="mf">7.0</span><span class="p">,</span> <span class="mf">8.0</span><span class="p">]])</span>

<span class="n">k</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">)</span>
</code></pre></div></div>

<pre><code class="language-none">&lt;tf.Tensor: shape=(2, 2), dtype=float32, numpy=
array([[1., 1.],
        [1., 1.]], dtype=float32)&gt;
</code></pre>

<h4 id="example-2--multiple-batch-dimensions-and-one-feature-dimension">Example 2 : Multiple batch dimensions and one feature dimension</h4>

<p>Let’s batch two tensors of shape <code class="language-plaintext highlighter-rouge">(2, 2)</code> and call the kernel with that</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">batched_x1</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">([[[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">],</span> <span class="p">[</span><span class="mf">3.0</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">]],</span> <span class="p">[[</span><span class="mf">5.0</span><span class="p">,</span> <span class="mf">6.0</span><span class="p">],</span> <span class="p">[</span><span class="mf">7.0</span><span class="p">,</span> <span class="mf">8.0</span><span class="p">]]])</span>
<span class="n">batched_x2</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">([[[</span><span class="mf">9.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">],</span> <span class="p">[</span><span class="mf">11.0</span><span class="p">,</span> <span class="mf">12.0</span><span class="p">]],</span> <span class="p">[[</span><span class="mf">13.0</span><span class="p">,</span> <span class="mf">14.0</span><span class="p">],</span> <span class="p">[</span><span class="mf">15.0</span><span class="p">,</span> <span class="mf">16.0</span><span class="p">]]])</span>

<span class="k">print</span><span class="p">(</span><span class="n">batched_x1</span><span class="p">.</span><span class="n">shape</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">batched_x2</span><span class="p">.</span><span class="n">shape</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">k</span><span class="p">(</span><span class="n">batched_x1</span><span class="p">,</span> <span class="n">batched_x2</span><span class="p">))</span>
</code></pre></div></div>

<pre><code class="language-none">(2, 2, 2)
(2, 2, 2)
tf.Tensor(
[[[1. 1.]
    [1. 1.]]

    [[1. 1.]
    [1. 1.]]], shape=(2, 2, 2), dtype=float32)
</code></pre>

<h4 id="example-3--multiple-batches-and-feature-dimensions">Example 3 : Multiple batches and feature dimensions</h4>

<p>The below example has 2 batch dimensions and 2 feature dimensions. So the output will have a shape with the first two dimensions being the batch dimensions and the other two dimensions being the number of examples in each tensor. The <code class="language-plaintext highlighter-rouge">feature_ndims</code> are absorbed during the computation.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Notice that the batch shape is broadcatable but the
# feature dimensions need not be broadcastable.
</span><span class="n">batched_x1</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">batched_x2</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

<span class="n">k</span> <span class="o">=</span> <span class="n">Constant</span><span class="p">(</span><span class="n">coef</span><span class="o">=</span><span class="n">coef</span><span class="p">,</span> <span class="n">feature_ndims</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">ARD</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="n">batched_x1</span><span class="p">.</span><span class="n">shape</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">batched_x2</span><span class="p">.</span><span class="n">shape</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">k</span><span class="p">(</span><span class="n">batched_x1</span><span class="p">,</span> <span class="n">batched_x2</span><span class="p">).</span><span class="n">shape</span><span class="p">)</span>
</code></pre></div></div>

<pre><code class="language-none">(5, 4, 1, 40, 3, 3)
(5, 1, 3, 80, 2, 2)
(5, 4, 3, 40, 80)
</code></pre>

<p><strong>Note</strong>: It is not recommended to work with multiple feature dimensions as it incurs a substantial overhead.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">%</span><span class="n">timeit</span> <span class="n">k</span><span class="p">(</span><span class="n">batched_x1</span><span class="p">,</span> <span class="n">batched_x2</span><span class="p">)</span>
</code></pre></div></div>

<pre><code class="language-none">2 ms ± 56.8 µs per loop (mean ± std. dev. of 7 runs, 100 loops each)
</code></pre>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Let's see how it performs with a single feature dimension.
</span>
<span class="n">batched_x1</span> <span class="o">=</span> <span class="n">batched_x1</span><span class="p">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>
<span class="n">batched_x2</span> <span class="o">=</span> <span class="n">batched_x2</span><span class="p">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>

<span class="n">k</span> <span class="o">=</span> <span class="n">Constant</span><span class="p">(</span><span class="n">coef</span><span class="o">=</span><span class="n">coef</span><span class="p">,</span> <span class="n">feature_ndims</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ARD</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

<span class="o">%</span><span class="n">timeit</span> <span class="n">k</span><span class="p">(</span><span class="n">batched_x1</span><span class="p">,</span> <span class="n">batched_x2</span><span class="p">)</span>
</code></pre></div></div>

<pre><code class="language-none">2.01 ms ± 54.8 µs per loop (mean ± std. dev. of 7 runs, 100 loops each)
</code></pre>

<h4 id="example-4-active-dimensions">Example 4: Active Dimensions</h4>

<p>Active dimensions are (as the name suggests) active dimensions of each feature dimension which will be used during the computation of the covariance matrix. This sounds too complicated but easy to understand with an example. Let’s say we have two feature dimensions of size <code class="language-plaintext highlighter-rouge">(10, )</code> and <code class="language-plaintext highlighter-rouge">(20, )</code>. This means that our input is going to be of shape <code class="language-plaintext highlighter-rouge">(..., m, 10, 20)</code> and <code class="language-plaintext highlighter-rouge">(..., n, 10, 20)</code>.</p>

<p>Active dimensions allows you to choose only those dimensions that you want the kernel to use to calculate the covariance matrix. For example, <code class="language-plaintext highlighter-rouge">active_dims=[5, 10]</code> means the first 5 entries of the first feature dimension and the first 10 entries of the second feature dimension will be used during the computation.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">active_dims</span> <span class="o">=</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">]</span>

<span class="n">x1</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="n">normal</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">))</span>
<span class="n">x2</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="n">normal</span><span class="p">((</span><span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">))</span>

<span class="n">k</span> <span class="o">=</span> <span class="n">ExpQuad</span><span class="p">(</span><span class="n">length_scale</span><span class="o">=</span><span class="mf">10.0</span><span class="p">,</span> <span class="n">feature_ndims</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">active_dims</span><span class="o">=</span><span class="n">active_dims</span><span class="p">,</span> <span class="n">ARD</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

<span class="n">k</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">)</span>
</code></pre></div></div>

<pre><code class="language-none">&lt;tf.Tensor: shape=(4, 5), dtype=float32, numpy=
array([[0.671924  , 0.60107315, 0.6406969 , 0.5356703 , 0.61101484],
        [0.6593888 , 0.6020972 , 0.68694246, 0.6295366 , 0.5677304 ],
        [0.6531334 , 0.6526655 , 0.65813994, 0.55865365, 0.5552639 ],
        [0.6973517 , 0.5949804 , 0.689168  , 0.6187942 , 0.6739167 ]],
        dtype=float32)&gt;
</code></pre>

<p>You can also pick the entries you want to be active for each feature dimension.</p>

<p>For example, <code class="language-plaintext highlighter-rouge">active_dims=[[1, 4, 5], 10]</code> means 2’nd, 5’th, and 6’th entries are active in the first feature dimension and the first 10 entries are active in the second feature dimension.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">active_dims</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span> <span class="mi">10</span><span class="p">]</span>

<span class="n">x1</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="n">normal</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">))</span>
<span class="n">x2</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="n">normal</span><span class="p">((</span><span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">))</span>

<span class="n">k</span> <span class="o">=</span> <span class="n">ExpQuad</span><span class="p">(</span><span class="n">length_scale</span><span class="o">=</span><span class="mf">10.0</span><span class="p">,</span> <span class="n">feature_ndims</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">active_dims</span><span class="o">=</span><span class="n">active_dims</span><span class="p">,</span> <span class="n">ARD</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

<span class="n">k</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">)</span>
</code></pre></div></div>

<pre><code class="language-none">&lt;tf.Tensor: shape=(4, 5), dtype=float32, numpy=
array([[0.7338076 , 0.7271027 , 0.63948095, 0.74313736, 0.6497098 ],
        [0.76253086, 0.7478951 , 0.71348906, 0.7848295 , 0.8584582 ],
        [0.7686134 , 0.7458844 , 0.6849413 , 0.828126  , 0.74713683],
        [0.75363666, 0.80211973, 0.64971805, 0.80924386, 0.74323034]],
        dtype=float32)&gt;
</code></pre>

<h3 id="scale-diag">Scale Diag</h3>

<p>This is the scaling factor for the <code class="language-plaintext highlighter-rouge">length_scale</code> parameter present in the stationary kernels that come from <code class="language-plaintext highlighter-rouge">Squared Exponential</code>, <code class="language-plaintext highlighter-rouge">Rational Quadratic</code>, <code class="language-plaintext highlighter-rouge">Matern</code>, and <code class="language-plaintext highlighter-rouge">Periodic</code> families. It is ignored if <code class="language-plaintext highlighter-rouge">ARD=False</code>.</p>

<p>It is used to perform Automatic Relevance Determination (ARD) on stationary kernels. This parameter can be inferred during sampling or MAP estimation.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">x1</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">constant</span><span class="p">([[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">],</span> <span class="p">[</span><span class="mf">3.0</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">]])</span>
<span class="n">x2</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">constant</span><span class="p">([[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">],</span> <span class="p">[</span><span class="mf">3.0</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">]])</span>

<span class="n">k</span> <span class="o">=</span> <span class="n">ExpQuad</span><span class="p">(</span><span class="n">length_scale</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">feature_ndims</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ARD</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="n">k</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">))</span>

<span class="n">k</span> <span class="o">=</span> <span class="n">ExpQuad</span><span class="p">(</span><span class="n">length_scale</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">feature_ndims</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">scale_diag</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">ARD</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="n">k</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">))</span>
</code></pre></div></div>

<pre><code class="language-none">tf.Tensor(
[[1.         0.01831564]
    [0.01831564 1.        ]], shape=(2, 2), dtype=float32)
tf.Tensor(
[[1.         0.01831564]
    [0.01831564 1.        ]], shape=(2, 2), dtype=float32)
</code></pre>

<p>As you can see, the off-diagonal entries got scaled by <code class="language-plaintext highlighter-rouge">2</code> because <code class="language-plaintext highlighter-rouge">scale_diag</code> was <code class="language-plaintext highlighter-rouge">2</code>.</p>

<h2 id="stationary-kernels-in-pymc4">Stationary Kernels in PyMC4!</h2>

<p>PyMC4 implements 8 stationary kernels which are used extensively in Gaussian Process modeling. These kernels don’t change their parameter values at different points in space.</p>

<p>The stationary kernels implemented in PyMC4 are:</p>

<ul>
  <li><a href="#Constant-Kernel">Constant Kernel</a></li>
  <li><a href="#White-Nosie-Kernel">White Noise Kernel</a></li>
  <li><a href="#Exponential-Quadratic-Kernel">Exponential Quadratic Kernel</a></li>
  <li><a href="#Rational-Quadratic-Kernel">Rational Quadratic Kernel</a></li>
  <li><a href="#Matern-1/2-Kernel">Matern 1/2 Kernel</a></li>
  <li><a href="#Mtern-3/2-Kernel">Matern 3/2 Kernel</a></li>
  <li><a href="#Mtern-5/2-Kernel">Matern 5/3 Kernel</a></li>
  <li><a href="#Exponential-Kernel">Exponential Kernel</a></li>
</ul>

<h3 id="constant-kernel">Constant Kernel</h3>

<p>As we have seen above, the constant kernel is a lightweight constant function and gradients are easy to calculate. Now, let’s look at the function space and the covariance matrix.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># This is a batch of coefficients. You can batch several
# constant kernels together for fast vectorized computations.
</span><span class="n">coefs</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">constant</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="p">.</span><span class="n">float64</span><span class="p">)</span>

<span class="n">k</span> <span class="o">=</span> <span class="n">Constant</span><span class="p">(</span><span class="n">coef</span><span class="o">=</span><span class="n">coefs</span><span class="p">,</span> <span class="n">ARD</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="mi">100</span><span class="p">)[:,</span> <span class="n">np</span><span class="p">.</span><span class="n">newaxis</span><span class="p">]</span>

<span class="c1"># We stabilize the kernel to make it Positive Semi-Definite.
# It just adds a small shift to the diagonal entries and is
# necessary to sample from the MvNormal distribution.
</span><span class="n">covs</span> <span class="o">=</span> <span class="n">stabilize</span><span class="p">(</span><span class="n">k</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">),</span> <span class="n">shift</span><span class="o">=</span><span class="mf">1e-13</span><span class="p">)</span>
<span class="n">dists</span> <span class="o">=</span> <span class="n">pm</span><span class="p">.</span><span class="n">MvNormal</span><span class="p">(</span><span class="s">"_"</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">covariance_matrix</span><span class="o">=</span><span class="n">covs</span><span class="p">)</span>
<span class="n">samples</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">dists</span><span class="p">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">perm</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plot_samples</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">samples</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">coefs</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="s">"coef"</span><span class="p">)</span>
</code></pre></div></div>

<p><img src="/images/GP-Kernels_files/GP-Kernels_26_0.png" alt="png" /></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="n">np</span><span class="p">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">X2</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">x1</span><span class="p">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">40</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">x2</span><span class="p">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">40</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">coef</span> <span class="o">=</span> <span class="p">[</span><span class="mf">5.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">]</span>
<span class="n">k</span> <span class="o">=</span> <span class="n">Constant</span><span class="p">(</span><span class="n">coef</span><span class="o">=</span><span class="n">coef</span><span class="p">,</span> <span class="n">ARD</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

<span class="n">plot_cov_matrix</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">X2</span><span class="p">,</span> <span class="p">[</span><span class="n">coef</span><span class="p">],</span> <span class="p">[</span><span class="s">"coef"</span><span class="p">])</span>
</code></pre></div></div>

<p><img src="/images/GP-Kernels_files/GP-Kernels_27_0.png" alt="png" /></p>

<h3 id="white-noise-kernel">White Noise Kernel</h3>

<p>This kernel adds some noise to the covariance functions and is mostly
used to stabilize other Positive Semi-Definite (PSD) kernels. This helps them become non-singular
and makes cholesky decomposition possible for sampling from the
<code class="language-plaintext highlighter-rouge">MvNormalCholesky</code> distribution. It is recommended to use this kernel in
combination with other covariance/kernel function when working with GP on
large data.</p>

\[X(x_i, x_j) =
\begin{cases}
  \eta^2,  &amp;   i = j \\
  0,       &amp;   \text{otherwise}
\end{cases}\]

<p>where $\eta^2$ is ‘noise level’ or simply noise.</p>

<p>The signature of <code class="language-plaintext highlighter-rouge">WhiteNoise</code> kernel implemented in <code class="language-plaintext highlighter-rouge">pymc4</code> is:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">k</span> <span class="o">=</span> <span class="n">WhiteNoise</span><span class="p">(</span><span class="n">noise</span><span class="p">,</span> <span class="n">feature_ndims</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">active_dims</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">scale_diag</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">noises</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">constant</span><span class="p">([</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">,</span> <span class="mf">2.1</span><span class="p">])</span>

<span class="n">k</span> <span class="o">=</span> <span class="n">WhiteNoise</span><span class="p">(</span><span class="n">noise</span><span class="o">=</span><span class="n">noises</span><span class="p">,</span> <span class="n">ARD</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="mi">500</span><span class="p">)[:,</span> <span class="n">np</span><span class="p">.</span><span class="n">newaxis</span><span class="p">]</span>

<span class="n">covs</span> <span class="o">=</span> <span class="n">stabilize</span><span class="p">(</span><span class="n">k</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">),</span> <span class="n">shift</span><span class="o">=</span><span class="mf">1e-6</span><span class="p">)</span>
<span class="n">dists</span> <span class="o">=</span> <span class="n">pm</span><span class="p">.</span><span class="n">MvNormal</span><span class="p">(</span><span class="s">"_"</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">covariance_matrix</span><span class="o">=</span><span class="n">covs</span><span class="p">)</span>
<span class="n">samples</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">dists</span><span class="p">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">perm</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plot_samples</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">samples</span><span class="p">,</span> <span class="n">noises</span><span class="p">,</span> <span class="s">"$</span><span class="se">\\</span><span class="s">eta$"</span><span class="p">)</span>
</code></pre></div></div>

<p><img src="/images/GP-Kernels_files/GP-Kernels_31_0.png" alt="png" /></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="n">np</span><span class="p">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">X2</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">x1</span><span class="p">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">40</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">x2</span><span class="p">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">40</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">noise</span> <span class="o">=</span> <span class="p">[</span><span class="mf">5.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">]</span>
<span class="n">k</span> <span class="o">=</span> <span class="n">WhiteNoise</span><span class="p">(</span><span class="n">noise</span><span class="o">=</span><span class="n">noise</span><span class="p">,</span> <span class="n">ARD</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

<span class="n">plot_cov_matrix</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">X2</span><span class="p">,</span> <span class="p">[</span><span class="n">noise</span><span class="p">],</span> <span class="p">[</span><span class="s">"$</span><span class="se">\\</span><span class="s">eta$"</span><span class="p">])</span>
</code></pre></div></div>

<p><img src="/images/GP-Kernels_files/GP-Kernels_32_0.png" alt="png" /></p>

<h3 id="exponential-quadratic-kernel">Exponential Quadratic Kernel</h3>

<p>This is the most used kernel in GP Modelling because of its mathematical properties. It is infinitely differentiable and forces the covariance function to be smooth. It comes from Squared Exponential (SE) family of kernels which is also commonly called as the Radial Basis Kernel (RBF) Family.</p>

<p>It’s mathematical expression is:</p>

\[k(x, x') = \sigma^2 \exp\left( \frac{\|x-x'\|^2}{2\ell^2} \right)\]

<p>where $\sigma$ is called “amplitude” and $\ell$ is called “length scale” of the kernel.</p>

<p>Amplitude controls how many units away the covariance is from the mean and length scale controls the ‘wiggles’ in the function prior. In general, you won’t be able to extrapolate more than ℓ units away from your data. If a float, an isotropic kernel is used. If an array and <code class="language-plaintext highlighter-rouge">ARD=True</code>, an anisotropic kernel is used where each dimension defines the length-scale of the respective feature dimension.</p>

<p>The signature of Exponential Quadratic kernel implemented in <code class="language-plaintext highlighter-rouge">pymc4</code> is:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">k</span> <span class="o">=</span> <span class="n">ExpQuad</span><span class="p">(</span><span class="n">length_scale</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">amplitude</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">feature_ndims</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">active_dims</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">scale_diag</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># We are using tf.float64 for better numerical accuracy.
</span><span class="n">length_scales</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">constant</span><span class="p">([</span><span class="mf">0.4</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mf">6.0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="p">.</span><span class="n">float64</span><span class="p">)</span>
<span class="n">amplitudes</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">constant</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="p">.</span><span class="n">float64</span><span class="p">)</span>

<span class="n">k</span> <span class="o">=</span> <span class="n">ExpQuad</span><span class="p">(</span><span class="n">length_scale</span><span class="o">=</span><span class="n">length_scales</span><span class="p">,</span> <span class="n">amplitude</span><span class="o">=</span><span class="n">amplitudes</span><span class="p">,</span> <span class="n">ARD</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="mi">100</span><span class="p">)[:,</span> <span class="n">np</span><span class="p">.</span><span class="n">newaxis</span><span class="p">]</span>

<span class="n">covs</span> <span class="o">=</span> <span class="n">stabilize</span><span class="p">(</span><span class="n">k</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">),</span> <span class="n">shift</span><span class="o">=</span><span class="mf">1e-8</span><span class="p">)</span>
<span class="n">dists</span> <span class="o">=</span> <span class="n">pm</span><span class="p">.</span><span class="n">MvNormal</span><span class="p">(</span><span class="s">"_"</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">covariance_matrix</span><span class="o">=</span><span class="n">covs</span><span class="p">)</span>
<span class="n">samples</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">dists</span><span class="p">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">perm</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plot_samples</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">samples</span><span class="p">,</span> <span class="p">[</span><span class="n">length_scales</span><span class="p">,</span> <span class="n">amplitudes</span><span class="p">],</span> <span class="p">[</span><span class="s">"$</span><span class="se">\\</span><span class="s">ell$"</span><span class="p">,</span> <span class="s">"$</span><span class="se">\\</span><span class="s">sigma$"</span><span class="p">])</span>
</code></pre></div></div>

<p><img src="/images/GP-Kernels_files/GP-Kernels_36_0.png" alt="png" /></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="n">np</span><span class="p">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">X2</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">x1</span><span class="p">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">40</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">x2</span><span class="p">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">40</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">ls</span><span class="p">,</span> <span class="n">amp</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">],</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.4</span><span class="p">]</span>
<span class="n">k</span> <span class="o">=</span> <span class="n">ExpQuad</span><span class="p">(</span><span class="n">length_scale</span><span class="o">=</span><span class="n">ls</span><span class="p">,</span> <span class="n">amplitude</span><span class="o">=</span><span class="n">amp</span><span class="p">,</span> <span class="n">ARD</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

<span class="n">plot_cov_matrix</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">X2</span><span class="p">,</span> <span class="p">[</span><span class="n">ls</span><span class="p">,</span> <span class="n">amp</span><span class="p">],</span> <span class="p">[</span><span class="s">"$</span><span class="se">\\</span><span class="s">ell$"</span><span class="p">,</span> <span class="s">"$</span><span class="se">\\</span><span class="s">sigma$"</span><span class="p">])</span>
</code></pre></div></div>

<p><img src="/images/GP-Kernels_files/GP-Kernels_37_0.png" alt="png" /></p>

<h3 id="rational-quadratic-kernel">Rational Quadratic Kernel</h3>

<p>Rational Quadratic Kernel is a generalization over the Exponential Quadratic Kernel. It is equivalent to using a combination of Exponential Quadratic kernel with different length scales. One extra parameter $\alpha$ controls the “<em>mixture rate</em>” of the kernel and is also known as “scale mixture rate”. As this parameter approaches infinity, the kernel becomes exactly equivalent to the Exponential Quadratic Kernel. The mathematical formula for the kernel is given by:</p>

\[k(x,x') = \sigma^2 \left( 1 + \frac{\|x-x'\|^2}{2\alpha\ell^2} \right)^\alpha\]

<p>where $\sigma$ is the amplitude, $\ell$ is the length scale, and $\alpha$ is the scale mixture rate.</p>

<p>The signature of the kernel implemented in <code class="language-plaintext highlighter-rouge">pymc4</code> is:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">k</span> <span class="o">=</span> <span class="n">RatQuad</span><span class="p">(</span><span class="n">length_scale</span><span class="p">,</span> <span class="n">amplitude</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">scale_mixture_rate</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">feature_ndims</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">active_dims</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">scale_diag</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">length_scales</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">constant</span><span class="p">([</span><span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="p">.</span><span class="n">float64</span><span class="p">)</span>
<span class="n">amplitudes</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">constant</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="p">.</span><span class="n">float64</span><span class="p">)</span>
<span class="n">scale_mixture_rates</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">constant</span><span class="p">([</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">,</span> <span class="mf">10000.0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="p">.</span><span class="n">float64</span><span class="p">)</span>

<span class="n">k</span> <span class="o">=</span> <span class="n">RatQuad</span><span class="p">(</span>
    <span class="n">length_scale</span><span class="o">=</span><span class="n">length_scales</span><span class="p">,</span>
    <span class="n">amplitude</span><span class="o">=</span><span class="n">amplitudes</span><span class="p">,</span>
    <span class="n">scale_mixture_rate</span><span class="o">=</span><span class="n">scale_mixture_rates</span><span class="p">,</span>
    <span class="n">ARD</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
<span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="mi">100</span><span class="p">)[:,</span> <span class="n">np</span><span class="p">.</span><span class="n">newaxis</span><span class="p">]</span>

<span class="n">covs</span> <span class="o">=</span> <span class="n">stabilize</span><span class="p">(</span><span class="n">k</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">),</span> <span class="n">shift</span><span class="o">=</span><span class="mf">1e-8</span><span class="p">)</span>
<span class="n">dists</span> <span class="o">=</span> <span class="n">pm</span><span class="p">.</span><span class="n">MvNormal</span><span class="p">(</span><span class="s">"_"</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">covariance_matrix</span><span class="o">=</span><span class="n">covs</span><span class="p">)</span>
<span class="n">samples</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">dists</span><span class="p">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">perm</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plot_samples</span><span class="p">(</span>
    <span class="n">x</span><span class="p">,</span>
    <span class="n">samples</span><span class="p">,</span>
    <span class="p">[</span><span class="n">length_scales</span><span class="p">,</span> <span class="n">amplitudes</span><span class="p">,</span> <span class="n">scale_mixture_rates</span><span class="p">],</span>
    <span class="p">[</span><span class="s">"$</span><span class="se">\\</span><span class="s">ell$"</span><span class="p">,</span> <span class="s">"$</span><span class="se">\\</span><span class="s">sigma$"</span><span class="p">,</span> <span class="s">"$</span><span class="se">\\</span><span class="s">alpha$"</span><span class="p">],</span>
<span class="p">)</span>
</code></pre></div></div>

<p><img src="/images/GP-Kernels_files/GP-Kernels_41_0.png" alt="png" /></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="n">np</span><span class="p">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">X2</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">x1</span><span class="p">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">40</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">x2</span><span class="p">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">40</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">ls</span><span class="p">,</span> <span class="n">amp</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">],</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">5000.0</span><span class="p">]</span>
<span class="n">k</span> <span class="o">=</span> <span class="n">RatQuad</span><span class="p">(</span><span class="n">length_scale</span><span class="o">=</span><span class="n">ls</span><span class="p">,</span> <span class="n">amplitude</span><span class="o">=</span><span class="n">amp</span><span class="p">,</span> <span class="n">scale_mixture_rate</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span> <span class="n">ARD</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

<span class="n">plot_cov_matrix</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">X2</span><span class="p">,</span> <span class="p">[</span><span class="n">ls</span><span class="p">,</span> <span class="n">amp</span><span class="p">,</span> <span class="n">alpha</span><span class="p">],</span> <span class="p">[</span><span class="s">"$</span><span class="se">\\</span><span class="s">ell$"</span><span class="p">,</span> <span class="s">"$</span><span class="se">\\</span><span class="s">sigma$"</span><span class="p">,</span> <span class="s">"$</span><span class="se">\\</span><span class="s">alpha$"</span><span class="p">])</span>
</code></pre></div></div>

<p><img src="/images/GP-Kernels_files/GP-Kernels_42_0.png" alt="png" /></p>

<h3 id="matern-family-of-kernels">Matern Family of Kernels</h3>

<p>Matern family of kernels is a generalization over the RBF family of kernels. The $\nu$ parameter controls the smoothness of the kernel function. Higher values of $\nu$ result in smoother functions. The most common values of $\nu$ are 0.5, 1.5 and 2.5 as the modified Bessel’s function is analytical there. The full mathematical formula of matern kernels is given by:</p>

\[k(x_i, x_j) =  \frac{1}{\Gamma(\nu)2^{\nu-1}}\Bigg(
\frac{\sqrt{2\nu}}{l} d(x_i , x_j )
\Bigg)^\nu K_\nu\Bigg(
\frac{\sqrt{2\nu}}{l} d(x_i , x_j )\Bigg)\]

<p>where $d(.)$ is the Euclidean distance, $K_\nu(.)$ is a modified Bessel function and $\Gamma(.)$ is the gamma function.</p>

<p>For other values of $\nu$, the computational cost to evaluate the kernel is extremely high and so isn’t implemented in <code class="language-plaintext highlighter-rouge">pymc4</code>.</p>

<p>Let’s see the kernels we get for some special values of $\nu$</p>

<h3 id="matern-12-kernel">Matern 1/2 Kernel</h3>

<p>This kernel has the value of $\nu = 0.5$. It is used to model <em>Ornstein-Uhlenbeck processes</em>.</p>

<p>It is given by:</p>

\[k(x, x') = \sigma^2\mathrm{exp}\left( -\frac{\|x - x'\|}{\ell} \right)\]

<p>Its signature in <code class="language-plaintext highlighter-rouge">pymc4</code> is:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">k</span> <span class="o">=</span> <span class="n">Matern12</span><span class="p">(</span><span class="n">length_scale</span><span class="p">,</span> <span class="n">amplitude</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">feature_ndims</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">active_dims</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">scale_diag</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>
</code></pre></div></div>

<h4 id="example-1">Example 1</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">length_scales</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">constant</span><span class="p">([</span><span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="p">.</span><span class="n">float64</span><span class="p">)</span>
<span class="n">amplitudes</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">constant</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="p">.</span><span class="n">float64</span><span class="p">)</span>

<span class="n">k</span> <span class="o">=</span> <span class="n">Matern12</span><span class="p">(</span><span class="n">length_scale</span><span class="o">=</span><span class="n">length_scales</span><span class="p">,</span> <span class="n">amplitude</span><span class="o">=</span><span class="n">amplitudes</span><span class="p">,</span> <span class="n">ARD</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="mi">500</span><span class="p">)[:,</span> <span class="n">np</span><span class="p">.</span><span class="n">newaxis</span><span class="p">]</span>

<span class="n">covs</span> <span class="o">=</span> <span class="n">stabilize</span><span class="p">(</span><span class="n">k</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">),</span> <span class="n">shift</span><span class="o">=</span><span class="mf">1e-8</span><span class="p">)</span>
<span class="n">dists</span> <span class="o">=</span> <span class="n">pm</span><span class="p">.</span><span class="n">MvNormal</span><span class="p">(</span><span class="s">"_"</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">covariance_matrix</span><span class="o">=</span><span class="n">covs</span><span class="p">)</span>
<span class="n">samples</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">dists</span><span class="p">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">perm</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plot_samples</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">samples</span><span class="p">,</span> <span class="p">[</span><span class="n">length_scales</span><span class="p">,</span> <span class="n">amplitudes</span><span class="p">],</span> <span class="p">[</span><span class="s">"$\ell$"</span><span class="p">,</span> <span class="s">"$</span><span class="se">\\</span><span class="s">sigma$"</span><span class="p">])</span>
</code></pre></div></div>

<p><img src="/images/GP-Kernels_files/GP-Kernels_48_0.png" alt="png" /></p>

<h4 id="example-2">Example 2</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">length_scales</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">constant</span><span class="p">([</span><span class="mf">3.4</span><span class="p">,</span> <span class="mf">3.4</span><span class="p">,</span> <span class="mf">3.4</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="p">.</span><span class="n">float64</span><span class="p">)</span>
<span class="n">amplitudes</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">constant</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="p">.</span><span class="n">float64</span><span class="p">)</span>

<span class="n">k</span> <span class="o">=</span> <span class="n">Matern12</span><span class="p">(</span><span class="n">length_scale</span><span class="o">=</span><span class="n">length_scales</span><span class="p">,</span> <span class="n">amplitude</span><span class="o">=</span><span class="n">amplitudes</span><span class="p">,</span> <span class="n">ARD</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="mi">500</span><span class="p">)[:,</span> <span class="n">np</span><span class="p">.</span><span class="n">newaxis</span><span class="p">]</span>

<span class="n">covs</span> <span class="o">=</span> <span class="n">stabilize</span><span class="p">(</span><span class="n">k</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">),</span> <span class="n">shift</span><span class="o">=</span><span class="mf">1e-8</span><span class="p">)</span>
<span class="n">dists</span> <span class="o">=</span> <span class="n">pm</span><span class="p">.</span><span class="n">MvNormal</span><span class="p">(</span><span class="s">"_"</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">covariance_matrix</span><span class="o">=</span><span class="n">covs</span><span class="p">)</span>
<span class="n">samples</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">dists</span><span class="p">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">perm</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plot_samples</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">samples</span><span class="p">,</span> <span class="p">[</span><span class="n">length_scales</span><span class="p">,</span> <span class="n">amplitudes</span><span class="p">],</span> <span class="p">[</span><span class="s">"$\ell$"</span><span class="p">,</span> <span class="s">"$</span><span class="se">\\</span><span class="s">sigma$"</span><span class="p">])</span>
</code></pre></div></div>

<p><img src="/images/GP-Kernels_files/GP-Kernels_52_0.png" alt="png" /></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="n">np</span><span class="p">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">X2</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">x1</span><span class="p">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">40</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">x2</span><span class="p">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">40</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">ls</span><span class="p">,</span> <span class="n">amp</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.4</span><span class="p">,</span> <span class="mf">1.4</span><span class="p">],</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]</span>
<span class="n">k</span> <span class="o">=</span> <span class="n">Matern12</span><span class="p">(</span><span class="n">length_scale</span><span class="o">=</span><span class="n">ls</span><span class="p">,</span> <span class="n">amplitude</span><span class="o">=</span><span class="n">amp</span><span class="p">,</span> <span class="n">ARD</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

<span class="n">plot_cov_matrix</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">X2</span><span class="p">,</span> <span class="p">[</span><span class="n">ls</span><span class="p">,</span> <span class="n">amp</span><span class="p">],</span> <span class="p">[</span><span class="s">"$</span><span class="se">\\</span><span class="s">ell$"</span><span class="p">,</span> <span class="s">"$</span><span class="se">\\</span><span class="s">sigma$"</span><span class="p">])</span>
</code></pre></div></div>

<p><img src="/images/GP-Kernels_files/GP-Kernels_53_0.png" alt="png" /></p>

<h3 id="matern-32-kernel">Matern 3/2 Kernel</h3>

<p>This kernel has the value of $\nu = 1.5$.</p>

<p>It is given by:</p>

\[k(x, x') = \left(1 + \frac{\sqrt{3(x - x')^2}}{\ell}\right)
                   \mathrm{exp}\left( - \frac{\sqrt{3(x - x')^2}}{\ell} \right)\]

<p>Its signature in <code class="language-plaintext highlighter-rouge">pymc4</code> is:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">k</span> <span class="o">=</span> <span class="n">Matern32</span><span class="p">(</span><span class="n">length_scale</span><span class="p">,</span> <span class="n">amplitude</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">feature_ndims</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">active_dims</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">scale_diag</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>
</code></pre></div></div>

<h4 id="example-1-1">Example 1</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">length_scales</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">constant</span><span class="p">([</span><span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="p">.</span><span class="n">float64</span><span class="p">)</span>
<span class="n">amplitudes</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">constant</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="p">.</span><span class="n">float64</span><span class="p">)</span>

<span class="n">k</span> <span class="o">=</span> <span class="n">Matern32</span><span class="p">(</span><span class="n">length_scale</span><span class="o">=</span><span class="n">length_scales</span><span class="p">,</span> <span class="n">amplitude</span><span class="o">=</span><span class="n">amplitudes</span><span class="p">,</span> <span class="n">ARD</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="mi">500</span><span class="p">)[:,</span> <span class="n">np</span><span class="p">.</span><span class="n">newaxis</span><span class="p">]</span>

<span class="n">covs</span> <span class="o">=</span> <span class="n">stabilize</span><span class="p">(</span><span class="n">k</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">),</span> <span class="n">shift</span><span class="o">=</span><span class="mf">1e-8</span><span class="p">)</span>
<span class="n">dists</span> <span class="o">=</span> <span class="n">pm</span><span class="p">.</span><span class="n">MvNormal</span><span class="p">(</span><span class="s">"_"</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">covariance_matrix</span><span class="o">=</span><span class="n">covs</span><span class="p">)</span>
<span class="n">samples</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">dists</span><span class="p">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">perm</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plot_samples</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">samples</span><span class="p">,</span> <span class="p">[</span><span class="n">length_scales</span><span class="p">,</span> <span class="n">amplitudes</span><span class="p">],</span> <span class="p">[</span><span class="s">"$</span><span class="se">\\</span><span class="s">ell$"</span><span class="p">,</span> <span class="s">"$</span><span class="se">\\</span><span class="s">sigma$"</span><span class="p">])</span>
</code></pre></div></div>

<p><img src="/images/GP-Kernels_files/GP-Kernels_58_0.png" alt="png" /></p>

<h4 id="example-2-1">Example 2</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">length_scales</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">constant</span><span class="p">([</span><span class="mf">1.4</span><span class="p">,</span> <span class="mf">1.4</span><span class="p">,</span> <span class="mf">1.4</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="p">.</span><span class="n">float64</span><span class="p">)</span>
<span class="n">amplitudes</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">constant</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="p">.</span><span class="n">float64</span><span class="p">)</span>

<span class="n">k</span> <span class="o">=</span> <span class="n">Matern32</span><span class="p">(</span><span class="n">length_scale</span><span class="o">=</span><span class="n">length_scales</span><span class="p">,</span> <span class="n">amplitude</span><span class="o">=</span><span class="n">amplitudes</span><span class="p">,</span> <span class="n">ARD</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="mi">500</span><span class="p">)[:,</span> <span class="n">np</span><span class="p">.</span><span class="n">newaxis</span><span class="p">]</span>

<span class="n">covs</span> <span class="o">=</span> <span class="n">stabilize</span><span class="p">(</span><span class="n">k</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">),</span> <span class="n">shift</span><span class="o">=</span><span class="mf">1e-8</span><span class="p">)</span>
<span class="n">dists</span> <span class="o">=</span> <span class="n">pm</span><span class="p">.</span><span class="n">MvNormal</span><span class="p">(</span><span class="s">"_"</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">covariance_matrix</span><span class="o">=</span><span class="n">covs</span><span class="p">)</span>
<span class="n">samples</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">dists</span><span class="p">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plot_samples</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">samples</span><span class="p">,</span> <span class="p">[</span><span class="n">length_scales</span><span class="p">,</span> <span class="n">amplitudes</span><span class="p">],</span> <span class="p">[</span><span class="s">"$</span><span class="se">\\</span><span class="s">ell$"</span><span class="p">,</span> <span class="s">"$</span><span class="se">\\</span><span class="s">sigma$"</span><span class="p">])</span>
</code></pre></div></div>

<p><img src="/images/GP-Kernels_files/GP-Kernels_62_0.png" alt="png" /></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="n">np</span><span class="p">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">X2</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">x1</span><span class="p">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">40</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">x2</span><span class="p">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">40</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">ls</span><span class="p">,</span> <span class="n">amp</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.4</span><span class="p">,</span> <span class="mf">1.4</span><span class="p">],</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]</span>
<span class="n">k</span> <span class="o">=</span> <span class="n">Matern32</span><span class="p">(</span><span class="n">length_scale</span><span class="o">=</span><span class="n">ls</span><span class="p">,</span> <span class="n">amplitude</span><span class="o">=</span><span class="n">amp</span><span class="p">,</span> <span class="n">ARD</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

<span class="n">plot_cov_matrix</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">X2</span><span class="p">,</span> <span class="p">[</span><span class="n">ls</span><span class="p">,</span> <span class="n">amp</span><span class="p">],</span> <span class="p">[</span><span class="s">"$</span><span class="se">\\</span><span class="s">ell$"</span><span class="p">,</span> <span class="s">"$</span><span class="se">\\</span><span class="s">sigma$"</span><span class="p">])</span>
</code></pre></div></div>

<p><img src="/images/GP-Kernels_files/GP-Kernels_63_0.png" alt="png" /></p>

<h3 id="matern-52-kernel">Matern 5/2 Kernel</h3>

<p>This kernel has the value of $\nu = 2.5$ It can be analytically shown as:</p>

\[k(x, x') = \left(1 + \frac{\sqrt{5(x - x')^2}}{\ell} +
                   \frac{5(x-x')^2}{3\ell^2}\right)
                   \mathrm{exp}\left[ - \frac{\sqrt{5(x - x')^2}}{\ell} \right]\]

<p>Its signature in PyMC4 is:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">k</span> <span class="o">=</span> <span class="n">Matern52</span><span class="p">(</span><span class="n">length_scale</span><span class="p">,</span> <span class="n">amplitude</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">feature_ndims</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">active_dims</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">scale_diag</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>
</code></pre></div></div>

<h4 id="example-1-2">Example 1</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">length_scales</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">constant</span><span class="p">([</span><span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="p">.</span><span class="n">float64</span><span class="p">)</span>
<span class="n">amplitudes</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">constant</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="p">.</span><span class="n">float64</span><span class="p">)</span>

<span class="n">k</span> <span class="o">=</span> <span class="n">Matern52</span><span class="p">(</span><span class="n">length_scale</span><span class="o">=</span><span class="n">length_scales</span><span class="p">,</span> <span class="n">amplitude</span><span class="o">=</span><span class="n">amplitudes</span><span class="p">,</span> <span class="n">ARD</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="mi">500</span><span class="p">)[:,</span> <span class="n">np</span><span class="p">.</span><span class="n">newaxis</span><span class="p">]</span>

<span class="n">covs</span> <span class="o">=</span> <span class="n">stabilize</span><span class="p">(</span><span class="n">k</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">),</span> <span class="n">shift</span><span class="o">=</span><span class="mf">1e-8</span><span class="p">)</span>
<span class="n">dists</span> <span class="o">=</span> <span class="n">pm</span><span class="p">.</span><span class="n">MvNormal</span><span class="p">(</span><span class="s">"_"</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">covariance_matrix</span><span class="o">=</span><span class="n">covs</span><span class="p">)</span>
<span class="n">samples</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">dists</span><span class="p">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">perm</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plot_samples</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">samples</span><span class="p">,</span> <span class="p">[</span><span class="n">length_scales</span><span class="p">,</span> <span class="n">amplitudes</span><span class="p">],</span> <span class="p">[</span><span class="s">"$</span><span class="se">\\</span><span class="s">ell$"</span><span class="p">,</span> <span class="s">"$</span><span class="se">\\</span><span class="s">sigma$"</span><span class="p">])</span>
</code></pre></div></div>

<p><img src="/images/GP-Kernels_files/GP-Kernels_68_0.png" alt="png" /></p>

<h4 id="example-2-2">Example 2</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">length_scales</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">constant</span><span class="p">([</span><span class="mf">3.4</span><span class="p">,</span> <span class="mf">3.4</span><span class="p">,</span> <span class="mf">3.4</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="p">.</span><span class="n">float64</span><span class="p">)</span>
<span class="n">amplitudes</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">constant</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="p">.</span><span class="n">float64</span><span class="p">)</span>

<span class="n">k</span> <span class="o">=</span> <span class="n">Matern52</span><span class="p">(</span><span class="n">length_scale</span><span class="o">=</span><span class="n">length_scales</span><span class="p">,</span> <span class="n">amplitude</span><span class="o">=</span><span class="n">amplitudes</span><span class="p">,</span> <span class="n">ARD</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="mi">100</span><span class="p">)[:,</span> <span class="n">np</span><span class="p">.</span><span class="n">newaxis</span><span class="p">]</span>

<span class="n">covs</span> <span class="o">=</span> <span class="n">stabilize</span><span class="p">(</span><span class="n">k</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">),</span> <span class="n">shift</span><span class="o">=</span><span class="mf">1e-8</span><span class="p">)</span>
<span class="n">dists</span> <span class="o">=</span> <span class="n">pm</span><span class="p">.</span><span class="n">MvNormal</span><span class="p">(</span><span class="s">"_"</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">covariance_matrix</span><span class="o">=</span><span class="n">covs</span><span class="p">)</span>
<span class="n">samples</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">dists</span><span class="p">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">perm</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plot_samples</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">samples</span><span class="p">,</span> <span class="p">[</span><span class="n">length_scales</span><span class="p">,</span> <span class="n">amplitudes</span><span class="p">],</span> <span class="p">[</span><span class="s">"$</span><span class="se">\\</span><span class="s">ell$"</span><span class="p">,</span> <span class="s">"$</span><span class="se">\\</span><span class="s">sigma$"</span><span class="p">])</span>
</code></pre></div></div>

<p><img src="/images/GP-Kernels_files/GP-Kernels_72_0.png" alt="png" /></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="n">np</span><span class="p">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">X2</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">x1</span><span class="p">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">40</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">x2</span><span class="p">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">40</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">ls</span><span class="p">,</span> <span class="n">amp</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.4</span><span class="p">,</span> <span class="mf">1.4</span><span class="p">,</span> <span class="mf">1.4</span><span class="p">],</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.3</span><span class="p">]</span>
<span class="n">k</span> <span class="o">=</span> <span class="n">Matern52</span><span class="p">(</span><span class="n">length_scale</span><span class="o">=</span><span class="n">ls</span><span class="p">,</span> <span class="n">amplitude</span><span class="o">=</span><span class="n">amp</span><span class="p">,</span> <span class="n">ARD</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

<span class="n">plot_cov_matrix</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">X2</span><span class="p">,</span> <span class="p">[</span><span class="n">ls</span><span class="p">,</span> <span class="n">amp</span><span class="p">],</span> <span class="p">[</span><span class="s">"$</span><span class="se">\\</span><span class="s">ell$"</span><span class="p">,</span> <span class="s">"$</span><span class="se">\\</span><span class="s">sigma$"</span><span class="p">])</span>
</code></pre></div></div>

<p><img src="/images/GP-Kernels_files/GP-Kernels_73_0.png" alt="png" /></p>

<h3 id="exponential-kernel">Exponential Kernel</h3>

<p>It is also known as <code class="language-plaintext highlighter-rouge">Laplacian</code> kernel.</p>

<p>It’s mathematical formula can be given as:</p>

\[k(x,x') = \sigma^2 \mathrm{exp}\left( -\frac{||x - x'||}{2\ell^2} \right)\]

<p>The signature of this kernel is:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">k</span> <span class="o">=</span> <span class="n">Exponential</span><span class="p">(</span><span class="n">length_scale</span><span class="p">,</span> <span class="n">amplitude</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">feature_ndims</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">active_dims</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">scale_diag</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>
</code></pre></div></div>

<h4 id="example-1-3">Example 1</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">length_scales</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">constant</span><span class="p">([</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="p">.</span><span class="n">float64</span><span class="p">)</span>
<span class="n">amplitudes</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">constant</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="p">.</span><span class="n">float64</span><span class="p">)</span>

<span class="n">k</span> <span class="o">=</span> <span class="n">Exponential</span><span class="p">(</span><span class="n">length_scale</span><span class="o">=</span><span class="n">length_scales</span><span class="p">,</span> <span class="n">amplitude</span><span class="o">=</span><span class="n">amplitudes</span><span class="p">,</span> <span class="n">ARD</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="mi">500</span><span class="p">)[:,</span> <span class="n">np</span><span class="p">.</span><span class="n">newaxis</span><span class="p">]</span>

<span class="n">covs</span> <span class="o">=</span> <span class="n">stabilize</span><span class="p">(</span><span class="n">k</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">),</span> <span class="n">shift</span><span class="o">=</span><span class="mf">1e-8</span><span class="p">)</span>
<span class="n">dists</span> <span class="o">=</span> <span class="n">pm</span><span class="p">.</span><span class="n">MvNormal</span><span class="p">(</span><span class="s">"_"</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">covariance_matrix</span><span class="o">=</span><span class="n">covs</span><span class="p">)</span>
<span class="n">samples</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">dists</span><span class="p">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">perm</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plot_samples</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">samples</span><span class="p">,</span> <span class="p">[</span><span class="n">length_scales</span><span class="p">,</span> <span class="n">amplitudes</span><span class="p">],</span> <span class="p">[</span><span class="s">"$</span><span class="se">\\</span><span class="s">ell$"</span><span class="p">,</span> <span class="s">"$</span><span class="se">\\</span><span class="s">sigma$"</span><span class="p">])</span>
</code></pre></div></div>

<p><img src="/images/GP-Kernels_files/GP-Kernels_78_0.png" alt="png" /></p>

<h4 id="example-2-3">Example 2</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">length_scales</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">constant</span><span class="p">([</span><span class="mf">3.4</span><span class="p">,</span> <span class="mf">3.4</span><span class="p">,</span> <span class="mf">3.4</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="p">.</span><span class="n">float64</span><span class="p">)</span>
<span class="n">amplitudes</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">constant</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="p">.</span><span class="n">float64</span><span class="p">)</span>

<span class="n">k</span> <span class="o">=</span> <span class="n">Exponential</span><span class="p">(</span><span class="n">length_scale</span><span class="o">=</span><span class="n">length_scales</span><span class="p">,</span> <span class="n">amplitude</span><span class="o">=</span><span class="n">amplitudes</span><span class="p">,</span> <span class="n">ARD</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="mi">500</span><span class="p">)[:,</span> <span class="n">np</span><span class="p">.</span><span class="n">newaxis</span><span class="p">]</span>

<span class="n">covs</span> <span class="o">=</span> <span class="n">stabilize</span><span class="p">(</span><span class="n">k</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">),</span> <span class="n">shift</span><span class="o">=</span><span class="mf">1e-8</span><span class="p">)</span>
<span class="n">dists</span> <span class="o">=</span> <span class="n">pm</span><span class="p">.</span><span class="n">MvNormal</span><span class="p">(</span><span class="s">"_"</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">covariance_matrix</span><span class="o">=</span><span class="n">covs</span><span class="p">)</span>
<span class="n">samples</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">dists</span><span class="p">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">perm</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plot_samples</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">samples</span><span class="p">,</span> <span class="p">[</span><span class="n">length_scales</span><span class="p">,</span> <span class="n">amplitudes</span><span class="p">],</span> <span class="p">[</span><span class="s">"$\ell$"</span><span class="p">,</span> <span class="s">"$</span><span class="se">\\</span><span class="s">sigma$"</span><span class="p">])</span>
</code></pre></div></div>

<p><img src="/images/GP-Kernels_files/GP-Kernels_82_0.png" alt="png" /></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="n">np</span><span class="p">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">X2</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">x1</span><span class="p">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">40</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">x2</span><span class="p">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">40</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">ls</span><span class="p">,</span> <span class="n">amp</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">],</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]</span>
<span class="n">k</span> <span class="o">=</span> <span class="n">Exponential</span><span class="p">(</span><span class="n">length_scale</span><span class="o">=</span><span class="n">ls</span><span class="p">,</span> <span class="n">amplitude</span><span class="o">=</span><span class="n">amp</span><span class="p">,</span> <span class="n">ARD</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

<span class="n">plot_cov_matrix</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">X2</span><span class="p">,</span> <span class="p">[</span><span class="n">ls</span><span class="p">,</span> <span class="n">amp</span><span class="p">],</span> <span class="p">[</span><span class="s">"$</span><span class="se">\\</span><span class="s">ell$"</span><span class="p">,</span> <span class="s">"$</span><span class="se">\\</span><span class="s">sigma$"</span><span class="p">])</span>
</code></pre></div></div>

<p><img src="/images/GP-Kernels_files/GP-Kernels_83_0.png" alt="png" /></p>

<h2 id="periodic-kernels-in-pymc4">Periodic Kernels in PyMC4!</h2>

<p>A total of 2 periodic kernels have been implemented in PyMC4.</p>

<ul>
  <li><a href="#Exponential-Sine-Squared-Kernel">Exponential Sine Squared Kernel</a></li>
  <li><a href="#Cosine-Kernel">Cosine Kernel</a></li>
</ul>

<h3 id="exponential-sine-squared-kernel">Exponential Sine Squared Kernel</h3>

<p>Periodic kernel aka Exponential Sine Squared Kernel comes from the Periodic Family of kernels. This kernels occilates in space with a period $T$. This kernel is used mostly for time-series and other temporal prediction tasks. It can be expressed as:</p>

\[k(x, x') = \sigma^2 \exp\left(-\frac{2\sin^2\left(\frac{\pi\|x-x'\|}
           {T}\right)}{\ell^2}\right)\]

<p>where $T$ is the period of the kernel.</p>

<p>Its signature in PyMC4 is:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">k</span> <span class="o">=</span> <span class="n">Periodic</span><span class="p">(</span><span class="n">length_scale</span><span class="p">,</span> <span class="n">amplitude</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">period</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">feature_ndims</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">active_dims</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">scale_diag</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">length_scales</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">constant</span><span class="p">([</span><span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="p">.</span><span class="n">float64</span><span class="p">)</span>
<span class="n">amplitudes</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">constant</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="p">.</span><span class="n">float64</span><span class="p">)</span>
<span class="n">periods</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">constant</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="p">.</span><span class="n">float64</span><span class="p">)</span>

<span class="n">k</span> <span class="o">=</span> <span class="n">Periodic</span><span class="p">(</span>
    <span class="n">length_scale</span><span class="o">=</span><span class="n">length_scales</span><span class="p">,</span> <span class="n">amplitude</span><span class="o">=</span><span class="n">amplitudes</span><span class="p">,</span> <span class="n">period</span><span class="o">=</span><span class="n">periods</span><span class="p">,</span> <span class="n">ARD</span><span class="o">=</span><span class="bp">False</span>
<span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="mi">500</span><span class="p">)[:,</span> <span class="n">np</span><span class="p">.</span><span class="n">newaxis</span><span class="p">]</span>

<span class="n">covs</span> <span class="o">=</span> <span class="n">stabilize</span><span class="p">(</span><span class="n">k</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">),</span> <span class="n">shift</span><span class="o">=</span><span class="mf">1e-8</span><span class="p">)</span>
<span class="n">dists</span> <span class="o">=</span> <span class="n">pm</span><span class="p">.</span><span class="n">MvNormal</span><span class="p">(</span><span class="s">"_"</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">covariance_matrix</span><span class="o">=</span><span class="n">covs</span><span class="p">)</span>
<span class="n">samples</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">dists</span><span class="p">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">perm</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plot_samples</span><span class="p">(</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">samples</span><span class="p">,</span> <span class="p">[</span><span class="n">length_scales</span><span class="p">,</span> <span class="n">amplitudes</span><span class="p">,</span> <span class="n">periods</span><span class="p">],</span> <span class="p">[</span><span class="s">"$</span><span class="se">\\</span><span class="s">ell$"</span><span class="p">,</span> <span class="s">"$</span><span class="se">\\</span><span class="s">sigma$"</span><span class="p">,</span> <span class="s">"$T$"</span><span class="p">]</span>
<span class="p">)</span>
</code></pre></div></div>

<p><img src="/images/GP-Kernels_files/GP-Kernels_88_0.png" alt="png" /></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">30</span><span class="p">),</span> <span class="n">np</span><span class="p">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="n">X2</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">x1</span><span class="p">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">90</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">x2</span><span class="p">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">90</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">ls</span><span class="p">,</span> <span class="n">amp</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">],</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span> <span class="p">[</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">]</span>
<span class="n">k</span> <span class="o">=</span> <span class="n">Periodic</span><span class="p">(</span><span class="n">length_scale</span><span class="o">=</span><span class="n">ls</span><span class="p">,</span> <span class="n">amplitude</span><span class="o">=</span><span class="n">amp</span><span class="p">,</span> <span class="n">period</span><span class="o">=</span><span class="n">t</span><span class="p">,</span> <span class="n">ARD</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

<span class="n">plot_cov_matrix</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">X2</span><span class="p">,</span> <span class="p">[</span><span class="n">ls</span><span class="p">,</span> <span class="n">amp</span><span class="p">,</span> <span class="n">t</span><span class="p">],</span> <span class="p">[</span><span class="s">"$</span><span class="se">\\</span><span class="s">ell$"</span><span class="p">,</span> <span class="s">"$</span><span class="se">\\</span><span class="s">sigma$"</span><span class="p">,</span> <span class="s">"T"</span><span class="p">])</span>
</code></pre></div></div>

<p><img src="/images/GP-Kernels_files/GP-Kernels_89_0.png" alt="png" /></p>

<h3 id="cosine-kernel">Cosine Kernel</h3>

<p>This kernel is a part of the Periodic Kernels. It represents purely sinusoidal functions. It is given by:</p>

\[k(x,x') = \sigma^2\cos\left(\frac{2\pi\|x-x'\|^2}{\ell^2}\right)\]

<p>Its signature in PyMC4 is:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">k</span> <span class="o">=</span> <span class="n">Cosine</span><span class="p">(</span><span class="n">length_scale</span><span class="p">,</span> <span class="n">amplitude</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">feature_ndims</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">active_dims</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">scale_diag</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>
</code></pre></div></div>

<h4 id="example-1-4">Example 1</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">length_scales</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">constant</span><span class="p">([</span><span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="p">.</span><span class="n">float64</span><span class="p">)</span>
<span class="n">amplitudes</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">constant</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="p">.</span><span class="n">float64</span><span class="p">)</span>

<span class="n">k</span> <span class="o">=</span> <span class="n">Periodic</span><span class="p">(</span><span class="n">length_scale</span><span class="o">=</span><span class="n">length_scales</span><span class="p">,</span> <span class="n">amplitude</span><span class="o">=</span><span class="n">amplitudes</span><span class="p">,</span> <span class="n">ARD</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="mi">500</span><span class="p">)[:,</span> <span class="n">np</span><span class="p">.</span><span class="n">newaxis</span><span class="p">]</span>

<span class="n">covs</span> <span class="o">=</span> <span class="n">stabilize</span><span class="p">(</span><span class="n">k</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">),</span> <span class="n">shift</span><span class="o">=</span><span class="mf">1e-8</span><span class="p">)</span>
<span class="n">dists</span> <span class="o">=</span> <span class="n">pm</span><span class="p">.</span><span class="n">MvNormal</span><span class="p">(</span><span class="s">"_"</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">covariance_matrix</span><span class="o">=</span><span class="n">covs</span><span class="p">)</span>
<span class="n">samples</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">dists</span><span class="p">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">perm</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plot_samples</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">samples</span><span class="p">,</span> <span class="p">[</span><span class="n">length_scales</span><span class="p">,</span> <span class="n">amplitudes</span><span class="p">],</span> <span class="p">[</span><span class="s">"$</span><span class="se">\\</span><span class="s">ell$"</span><span class="p">,</span> <span class="s">"$</span><span class="se">\\</span><span class="s">sigma$"</span><span class="p">])</span>
</code></pre></div></div>

<p><img src="/images/GP-Kernels_files/GP-Kernels_94_0.png" alt="png" /></p>

<h4 id="example-2-4">Example 2</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">length_scales</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">constant</span><span class="p">([</span><span class="mf">3.4</span><span class="p">,</span> <span class="mf">3.4</span><span class="p">,</span> <span class="mf">3.4</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="p">.</span><span class="n">float64</span><span class="p">)</span>
<span class="n">amplitudes</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">constant</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="p">.</span><span class="n">float64</span><span class="p">)</span>

<span class="n">k</span> <span class="o">=</span> <span class="n">Periodic</span><span class="p">(</span><span class="n">length_scale</span><span class="o">=</span><span class="n">length_scales</span><span class="p">,</span> <span class="n">amplitude</span><span class="o">=</span><span class="n">amplitudes</span><span class="p">,</span> <span class="n">ARD</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="mi">500</span><span class="p">)[:,</span> <span class="n">np</span><span class="p">.</span><span class="n">newaxis</span><span class="p">]</span>

<span class="n">covs</span> <span class="o">=</span> <span class="n">stabilize</span><span class="p">(</span><span class="n">k</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">),</span> <span class="n">shift</span><span class="o">=</span><span class="mf">1e-8</span><span class="p">)</span>
<span class="n">dists</span> <span class="o">=</span> <span class="n">pm</span><span class="p">.</span><span class="n">MvNormal</span><span class="p">(</span><span class="s">"_"</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">covariance_matrix</span><span class="o">=</span><span class="n">covs</span><span class="p">)</span>
<span class="n">samples</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">dists</span><span class="p">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">perm</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plot_samples</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">samples</span><span class="p">,</span> <span class="p">[</span><span class="n">length_scales</span><span class="p">,</span> <span class="n">amplitudes</span><span class="p">],</span> <span class="p">[</span><span class="s">"$</span><span class="se">\\</span><span class="s">ell$"</span><span class="p">,</span> <span class="s">"$</span><span class="se">\\</span><span class="s">sigma$"</span><span class="p">])</span>
</code></pre></div></div>

<p><img src="/images/GP-Kernels_files/GP-Kernels_98_0.png" alt="png" /></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">30</span><span class="p">),</span> <span class="n">np</span><span class="p">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="n">X2</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">x1</span><span class="p">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">90</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">x2</span><span class="p">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">90</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">ls</span><span class="p">,</span> <span class="n">amp</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.8</span><span class="p">,</span> <span class="mf">1.8</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">],</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]</span>
<span class="n">k</span> <span class="o">=</span> <span class="n">Cosine</span><span class="p">(</span><span class="n">length_scale</span><span class="o">=</span><span class="n">ls</span><span class="p">,</span> <span class="n">amplitude</span><span class="o">=</span><span class="n">amp</span><span class="p">,</span> <span class="n">ARD</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

<span class="n">plot_cov_matrix</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">X2</span><span class="p">,</span> <span class="p">[</span><span class="n">ls</span><span class="p">,</span> <span class="n">amp</span><span class="p">],</span> <span class="p">[</span><span class="s">"$</span><span class="se">\\</span><span class="s">ell$"</span><span class="p">,</span> <span class="s">"$</span><span class="se">\\</span><span class="s">sigma$"</span><span class="p">])</span>
</code></pre></div></div>

<p><img src="/images/GP-Kernels_files/GP-Kernels_99_0.png" alt="png" /></p>

<h2 id="non-stationary-kernels">Non-Stationary Kernels</h2>

<p>There are a total of 5 non-stationary distributions in PyMC4. These kernels vary not only with respect to the parameters but also with the position of data in space.</p>

<ul>
  <li><a href="#">Linear</a></li>
  <li><a href="#">Polynomial</a></li>
  <li><a href="#Gibbs-Kernel">Gibbs Kernel</a></li>
  <li><a href="#Scaled-Covariance-Kernel">Scaled Covariance Kernel</a></li>
  <li><a href="#Warped-Input-Kernel">Warped Input Kernel</a></li>
</ul>

<h3 id="linear-kernel">Linear Kernel</h3>

<p>This kernel evaluates a linear function of the inputs $x$ and $x’$. It performs Bayesian linear regression on the inputs to produce random linear functions. The parameter $\sigma_b$ controls how far the covariance is from the mean value and is called “bias variance”. $\sigma_v$ controls how fast the covariance grows with respect to the origin point and is called “slope variance”. $c$ is the shift parameter which shift points closer to the origin by $c$ units.</p>

\[k(x, x') = \sigma_b^2 + \sigma_v^2\left(x - c\right)\left(x'-c\right)\]

<p>where $\sigma_b$ is bias variance, $\sigma_v$ is slope variance,
and $c$ is the shift parameter.</p>

<p>Its signature in <code class="language-plaintext highlighter-rouge">pymc4</code> is:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">k</span> <span class="o">=</span> <span class="n">Linear</span><span class="p">(</span><span class="n">bias_variance</span><span class="p">,</span> <span class="n">slope_variance</span><span class="p">,</span> <span class="n">shift</span><span class="p">,</span> <span class="n">feature_ndims</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">active_dims</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">scale_diag</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">bias_variances</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">constant</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="p">.</span><span class="n">float64</span><span class="p">)</span>
<span class="n">slope_variances</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">constant</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="p">.</span><span class="n">float64</span><span class="p">)</span>
<span class="n">shifts</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">constant</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">,</span> <span class="mf">50.0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="p">.</span><span class="n">float64</span><span class="p">)</span>

<span class="n">k</span> <span class="o">=</span> <span class="n">Linear</span><span class="p">(</span>
    <span class="n">bias_variance</span><span class="o">=</span><span class="n">bias_variances</span><span class="p">,</span>
    <span class="n">slope_variance</span><span class="o">=</span><span class="n">slope_variances</span><span class="p">,</span>
    <span class="n">shift</span><span class="o">=</span><span class="n">shifts</span><span class="p">,</span>
    <span class="n">ARD</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
<span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">100.0</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="mi">100</span><span class="p">)[:,</span> <span class="n">np</span><span class="p">.</span><span class="n">newaxis</span><span class="p">]</span>

<span class="n">covs</span> <span class="o">=</span> <span class="n">stabilize</span><span class="p">(</span><span class="n">k</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">),</span> <span class="n">shift</span><span class="o">=</span><span class="mf">1e-8</span><span class="p">)</span>
<span class="n">dists</span> <span class="o">=</span> <span class="n">pm</span><span class="p">.</span><span class="n">MvNormal</span><span class="p">(</span><span class="s">"_"</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">covariance_matrix</span><span class="o">=</span><span class="n">covs</span><span class="p">)</span>
<span class="n">samples</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">dists</span><span class="p">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">perm</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plot_samples</span><span class="p">(</span>
    <span class="n">x</span><span class="p">,</span>
    <span class="n">samples</span><span class="p">,</span>
    <span class="p">[</span><span class="n">bias_variances</span><span class="p">,</span> <span class="n">slope_variances</span><span class="p">,</span> <span class="n">shifts</span><span class="p">],</span>
    <span class="p">[</span><span class="s">"$</span><span class="se">\\</span><span class="s">sigma_b$"</span><span class="p">,</span> <span class="s">"$</span><span class="se">\\</span><span class="s">sigma_v$"</span><span class="p">,</span> <span class="s">"$c$"</span><span class="p">],</span>
<span class="p">)</span>
</code></pre></div></div>

<p><img src="/images/GP-Kernels_files/GP-Kernels_104_0.png" alt="png" /></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="n">np</span><span class="p">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">X2</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">x1</span><span class="p">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">40</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">x2</span><span class="p">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">40</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">bv</span><span class="p">,</span> <span class="n">sv</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">],</span> <span class="p">[</span><span class="mf">1.8</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]</span>
<span class="n">k</span> <span class="o">=</span> <span class="n">Linear</span><span class="p">(</span><span class="n">bias_variance</span><span class="o">=</span><span class="n">bv</span><span class="p">,</span> <span class="n">slope_variance</span><span class="o">=</span><span class="n">sv</span><span class="p">,</span> <span class="n">shift</span><span class="o">=</span><span class="n">c</span><span class="p">,</span> <span class="n">ARD</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

<span class="n">plot_cov_matrix</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">X2</span><span class="p">,</span> <span class="p">[</span><span class="n">bv</span><span class="p">,</span> <span class="n">sv</span><span class="p">,</span> <span class="n">c</span><span class="p">],</span> <span class="p">[</span><span class="s">"$</span><span class="se">\\</span><span class="s">sigma_b$"</span><span class="p">,</span> <span class="s">"$</span><span class="se">\\</span><span class="s">sigma_v$"</span><span class="p">,</span> <span class="s">"c"</span><span class="p">])</span>
</code></pre></div></div>

<p><img src="/images/GP-Kernels_files/GP-Kernels_105_0.png" alt="png" /></p>

<h3 id="polynomial-kernel">Polynomial Kernel</h3>

<p>This kernel is a generalization over the Linear Kernel and performs polynomial regression on the data to evaluate the covariance matrix. An extra parameter $\alpha$ controls the degree of the polynomial. This kernel is exactly the same as the Linear Kernel when $\alpha=1$.</p>

<p>This kernel can be represented mathematically as:</p>

\[k(x,x') = \sigma_b^2 + \sigma_v^2\left((x-c)(x'-c)\right)^\alpha\]

<p>where $\sigma_b$, $\sigma_v$ and $c$ are the same as before and $\alpha$ is the exponent.</p>

<p>Its signature in <code class="language-plaintext highlighter-rouge">pymc4</code> is:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">k</span> <span class="o">=</span> <span class="n">Polynomial</span><span class="p">(</span><span class="n">bias_variance</span><span class="p">,</span> <span class="n">slope_variance</span><span class="p">,</span> <span class="n">shift</span><span class="p">,</span> <span class="n">exponent</span><span class="p">,</span> <span class="n">feature_ndims</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">active_dims</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">scale_diag</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">bias_variances</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">constant</span><span class="p">([</span><span class="mf">1.0</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="p">.</span><span class="n">float64</span><span class="p">)</span>
<span class="n">slope_variances</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">constant</span><span class="p">([</span><span class="mf">2.0</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="p">.</span><span class="n">float64</span><span class="p">)</span>
<span class="n">shifts</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">constant</span><span class="p">([</span><span class="mf">0.0</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="p">.</span><span class="n">float64</span><span class="p">)</span>
<span class="n">exponents</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">constant</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="p">.</span><span class="n">float64</span><span class="p">)</span>

<span class="n">k</span> <span class="o">=</span> <span class="n">Polynomial</span><span class="p">(</span>
    <span class="n">bias_variance</span><span class="o">=</span><span class="n">bias_variances</span><span class="p">,</span>
    <span class="n">slope_variance</span><span class="o">=</span><span class="n">slope_variances</span><span class="p">,</span>
    <span class="n">shift</span><span class="o">=</span><span class="n">shifts</span><span class="p">,</span>
    <span class="n">exponent</span><span class="o">=</span><span class="n">exponents</span><span class="p">,</span>
    <span class="n">ARD</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
<span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="mi">100</span><span class="p">)[:,</span> <span class="n">np</span><span class="p">.</span><span class="n">newaxis</span><span class="p">]</span>

<span class="n">covs</span> <span class="o">=</span> <span class="n">stabilize</span><span class="p">(</span><span class="n">k</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">),</span> <span class="n">shift</span><span class="o">=</span><span class="mf">1e-8</span><span class="p">)</span>
<span class="n">dists</span> <span class="o">=</span> <span class="n">pm</span><span class="p">.</span><span class="n">MvNormal</span><span class="p">(</span><span class="s">"_"</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">covariance_matrix</span><span class="o">=</span><span class="n">covs</span><span class="p">)</span>
<span class="n">samples</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">dists</span><span class="p">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">perm</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plot_samples</span><span class="p">(</span>
    <span class="n">x</span><span class="p">,</span>
    <span class="n">samples</span><span class="p">,</span>
    <span class="p">[</span><span class="n">bias_variances</span><span class="p">,</span> <span class="n">slope_variances</span><span class="p">,</span> <span class="n">shifts</span><span class="p">,</span> <span class="n">exponents</span><span class="p">],</span>
    <span class="p">[</span><span class="s">"$</span><span class="se">\\</span><span class="s">sigma_b$"</span><span class="p">,</span> <span class="s">"$</span><span class="se">\\</span><span class="s">sigma_v$"</span><span class="p">,</span> <span class="s">"$c$"</span><span class="p">,</span> <span class="s">"$</span><span class="se">\\</span><span class="s">alpha$"</span><span class="p">],</span>
<span class="p">)</span>
</code></pre></div></div>

<p><img src="/images/GP-Kernels_files/GP-Kernels_109_0.png" alt="png" /></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="n">np</span><span class="p">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">X2</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">x1</span><span class="p">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">40</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">x2</span><span class="p">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">40</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">bv</span><span class="p">,</span> <span class="n">sv</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">e</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">]</span>
<span class="n">k</span> <span class="o">=</span> <span class="n">Polynomial</span><span class="p">(</span><span class="n">bias_variance</span><span class="o">=</span><span class="n">bv</span><span class="p">,</span> <span class="n">slope_variance</span><span class="o">=</span><span class="n">sv</span><span class="p">,</span> <span class="n">shift</span><span class="o">=</span><span class="n">c</span><span class="p">,</span> <span class="n">exponent</span><span class="o">=</span><span class="n">e</span><span class="p">,</span> <span class="n">ARD</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

<span class="n">plot_cov_matrix</span><span class="p">(</span>
    <span class="n">k</span><span class="p">,</span> <span class="n">X2</span><span class="p">,</span> <span class="p">[</span><span class="n">bv</span><span class="p">,</span> <span class="n">sv</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">e</span><span class="p">],</span> <span class="p">[</span><span class="s">"$</span><span class="se">\\</span><span class="s">sigma_b$"</span><span class="p">,</span> <span class="s">"$</span><span class="se">\\</span><span class="s">sigma_v$"</span><span class="p">,</span> <span class="s">"$c$"</span><span class="p">,</span> <span class="s">"$</span><span class="se">\\</span><span class="s">alpha$"</span><span class="p">]</span>
<span class="p">)</span>
</code></pre></div></div>

<p><img src="/images/GP-Kernels_files/GP-Kernels_110_0.png" alt="png" /></p>

<h3 id="gibbs-kernel">Gibbs Kernel</h3>

<p>This kernel comes from a non-stationary family of kernels. The <code class="language-plaintext highlighter-rouge">length_scale</code> parameter varies with varying inputs. It is expressed as:</p>

\[k(x, x') = \sqrt{\frac{2\ell(x)\ell(x')}{\ell^2(x) + \ell^2(x')}}
                   \mathrm{exp}\left( -\frac{\|x - x'\|^2}
                   {\ell^2(x) + \ell^2(x')} \right)\]

<p>where $\ell(.)$ is a function of inputs that outputs a different length scale for each of the input points.</p>

<p>The signature of this kernel in PyMC4 is</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">k</span> <span class="o">=</span> <span class="n">Gibbs</span><span class="p">(</span><span class="n">length_scale_fn</span><span class="p">,</span> <span class="n">fn_args</span><span class="p">,</span> <span class="n">feature_ndims</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">active_dims</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">scale_diag</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>
</code></pre></div></div>

<p>This kernel expects <code class="language-plaintext highlighter-rouge">length_scale_fn</code> to have the following signature:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">length_scale_fn</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">array_like</span><span class="p">,</span> <span class="o">*</span><span class="n">fn_args</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">array_like</span><span class="p">:</span>
    <span class="p">...</span>
</code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">array_like</code> type can be any type of array (numpy array, tensorflow tensor, etc) of the same shape as the input where each entry corresponds to the <code class="language-plaintext highlighter-rouge">length_scale</code> for that point.</p>

<h4 id="notes">Notes</h4>

<p>This kernel is very slow and computationally heavy compared to other kernels. It works best with inputs having a single feature dimension and a single entry in that dimension. This means the inputs should have the shape <code class="language-plaintext highlighter-rouge">(..., n, 1)</code> and <code class="language-plaintext highlighter-rouge">(..., m, 1)</code>. Other inputs will work but the evaluation will be very slow.</p>

<p>No argument validation is done even when <code class="language-plaintext highlighter-rouge">validate_args=True</code>.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">tanh_fn</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">ls1</span><span class="p">,</span> <span class="n">ls2</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">x0</span><span class="p">):</span>
    <span class="s">"""
    ls1: left saturation value
    ls2: right saturation value
    w:   transition width
    x0:  transition location.
    """</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">ls1</span> <span class="o">+</span> <span class="n">ls2</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="p">(</span><span class="n">ls1</span> <span class="o">-</span> <span class="n">ls2</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">tf</span><span class="p">.</span><span class="n">tanh</span><span class="p">((</span><span class="n">x</span> <span class="o">-</span> <span class="n">x0</span><span class="p">)</span> <span class="o">/</span> <span class="n">w</span><span class="p">)</span>


<span class="n">ls1</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">constant</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="p">.</span><span class="n">float64</span><span class="p">)</span>
<span class="n">ls2</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">constant</span><span class="p">(</span><span class="mf">1.6</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="p">.</span><span class="n">float64</span><span class="p">)</span>
<span class="n">w</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">constant</span><span class="p">(</span><span class="mf">1.3</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="p">.</span><span class="n">float64</span><span class="p">)</span>
<span class="n">x0</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">constant</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="p">.</span><span class="n">float64</span><span class="p">)</span>
<span class="c1"># You can also partial the length_scale function to avoid passing extra argumets.
# from functools import partial
# fn = partial(tanh_fn, ls1=ls1, ls2=ls2, w=w, x0=x0)
</span><span class="n">k</span> <span class="o">=</span> <span class="n">Gibbs</span><span class="p">(</span>
    <span class="n">length_scale_fn</span><span class="o">=</span><span class="n">tanh_fn</span><span class="p">,</span> <span class="n">fn_args</span><span class="o">=</span><span class="p">(</span><span class="n">ls1</span><span class="p">,</span> <span class="n">ls2</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">x0</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="p">.</span><span class="n">float64</span><span class="p">,</span> <span class="n">ARD</span><span class="o">=</span><span class="bp">False</span>
<span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Let's visualize the tanh function
</span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">5.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="mi">100</span><span class="p">)[:,</span> <span class="n">np</span><span class="p">.</span><span class="n">newaxis</span><span class="p">]</span>

<span class="n">wf</span> <span class="o">=</span> <span class="n">tanh_fn</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">ls1</span><span class="p">,</span> <span class="n">ls2</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">x0</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">plt</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">wf</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">"lengthscale"</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">"X"</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">title</span><span class="p">(</span><span class="s">"Lengthscale as a function of X"</span><span class="p">);</span>
</code></pre></div></div>

<p><img src="/images/GP-Kernels_files/GP-Kernels_113_0.png" alt="png" /></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Let's evaluate the covariance matrix.
</span><span class="n">covs</span> <span class="o">=</span> <span class="n">stabilize</span><span class="p">(</span><span class="n">k</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">),</span> <span class="n">shift</span><span class="o">=</span><span class="mf">1e-8</span><span class="p">)</span>
<span class="n">dists</span> <span class="o">=</span> <span class="n">pm</span><span class="p">.</span><span class="n">MvNormal</span><span class="p">(</span><span class="s">"_"</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">covariance_matrix</span><span class="o">=</span><span class="n">covs</span><span class="p">)</span>
<span class="n">samples</span> <span class="o">=</span> <span class="n">dists</span><span class="p">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plt</span><span class="p">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="p">[</span><span class="n">plt</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">samples</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)]</span>
<span class="n">plt</span><span class="p">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">"X"</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">"y"</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="/images/GP-Kernels_files/GP-Kernels_115_0.png" alt="png" /></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">40</span><span class="p">),</span> <span class="n">np</span><span class="p">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="n">X2</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">x1</span><span class="p">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">x2</span><span class="p">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">k</span> <span class="o">=</span> <span class="n">Gibbs</span><span class="p">(</span>
    <span class="n">length_scale_fn</span><span class="o">=</span><span class="n">tanh_fn</span><span class="p">,</span> <span class="n">fn_args</span><span class="o">=</span><span class="p">(</span><span class="n">ls1</span><span class="p">,</span> <span class="n">ls2</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">x0</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="p">.</span><span class="n">float64</span><span class="p">,</span> <span class="n">ARD</span><span class="o">=</span><span class="bp">False</span>
<span class="p">)</span>

<span class="n">cov</span> <span class="o">=</span> <span class="n">k</span><span class="p">(</span><span class="n">X2</span><span class="p">,</span> <span class="n">X2</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">m</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">cov</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s">"inferno"</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s">"none"</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">grid</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">m</span><span class="p">);</span>
</code></pre></div></div>

<p><img src="/images/GP-Kernels_files/GP-Kernels_116_0.png" alt="png" /></p>

<h3 id="scaled-covariance-kernel">Scaled Covariance Kernel</h3>

<p>This kernel uses a scaling function to scale the covariance between two points evaluated using some other kernel. This scaling function is a function of the inputs and returns an output of the same shape. It can be expressed as</p>

\[k'(x,x') = f(x) k(x,x')\]

<p>where $k(x,x’)$ is the kernel function used to evaluate the covariance matrix and $f(x, \theta)$ is the scaling function of the inputs $x$ and some $\theta$ that can be inferred during sampling/inference.</p>

<p>Its signature in PyMC4 is</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">k</span> <span class="o">=</span> <span class="n">ScaledCov</span><span class="p">(</span><span class="n">kernel</span><span class="p">,</span> <span class="n">scaling_fn</span><span class="p">,</span> <span class="n">fn_args</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>
</code></pre></div></div>

<p>This kernel expects the function <code class="language-plaintext highlighter-rouge">scaling_fn</code> to have a signature</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">scaling_fn</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">array_like</span><span class="p">,</span> <span class="o">*</span><span class="n">fn_args</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">array_like</span><span class="p">:</span>
    <span class="p">...</span>
</code></pre></div></div>

<p>It must return an array of the same shape as that of the input <code class="language-plaintext highlighter-rouge">x</code>.</p>

<h4 id="notes-1">Notes</h4>

<p>This kernel doesn’t perform argument validation even when <code class="language-plaintext highlighter-rouge">validate_args=True</code>.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">logistic</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
    <span class="c1"># a is the slope, x0 is the location
</span>    <span class="c1"># d is the coefficient of the sigmoid term
</span>    <span class="c1"># c is the bias of the linear equation
</span>    <span class="k">return</span> <span class="n">d</span> <span class="o">*</span> <span class="n">tf</span><span class="p">.</span><span class="n">sigmoid</span><span class="p">(</span><span class="n">a</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">x0</span><span class="p">))</span> <span class="o">+</span> <span class="n">c</span>


<span class="n">a</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">constant</span><span class="p">(</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="p">.</span><span class="n">float64</span><span class="p">)</span>
<span class="n">x0</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">constant</span><span class="p">(</span><span class="mf">5.0</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="p">.</span><span class="n">float64</span><span class="p">)</span>
<span class="n">c</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">constant</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="p">.</span><span class="n">float64</span><span class="p">)</span>
<span class="n">d</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">constant</span><span class="p">(</span><span class="mf">10.0</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="p">.</span><span class="n">float64</span><span class="p">)</span>

<span class="n">kernel</span> <span class="o">=</span> <span class="n">ExpQuad</span><span class="p">(</span><span class="n">tf</span><span class="p">.</span><span class="n">constant</span><span class="p">(</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="p">.</span><span class="n">float64</span><span class="p">),</span> <span class="n">ARD</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="n">k</span> <span class="o">=</span> <span class="n">ScaledCov</span><span class="p">(</span><span class="n">kernel</span><span class="o">=</span><span class="n">kernel</span><span class="p">,</span> <span class="n">scaling_fn</span><span class="o">=</span><span class="n">logistic</span><span class="p">,</span> <span class="n">fn_args</span><span class="o">=</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">),</span> <span class="n">ARD</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Let's visualize the logistic function.
</span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">3.0</span><span class="p">,</span> <span class="mf">13.0</span><span class="p">,</span> <span class="mi">500</span><span class="p">)[:,</span> <span class="bp">None</span><span class="p">]</span>
<span class="n">lfunc</span> <span class="o">=</span> <span class="n">logistic</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span>

<span class="n">plt</span><span class="p">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">plt</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">lfunc</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">"X"</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">"$\phi(x)$"</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">title</span><span class="p">(</span><span class="s">"The scaling function"</span><span class="p">);</span>
</code></pre></div></div>

<p><img src="/images/GP-Kernels_files/GP-Kernels_119_0.png" alt="png" /></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Let's evaluate the covariance matrix.
</span><span class="n">covs</span> <span class="o">=</span> <span class="n">stabilize</span><span class="p">(</span><span class="n">k</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">),</span> <span class="n">shift</span><span class="o">=</span><span class="mf">1e-8</span><span class="p">)</span>
<span class="n">dists</span> <span class="o">=</span> <span class="n">pm</span><span class="p">.</span><span class="n">MvNormal</span><span class="p">(</span><span class="s">"_"</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">covariance_matrix</span><span class="o">=</span><span class="n">covs</span><span class="p">)</span>
<span class="n">samples</span> <span class="o">=</span> <span class="n">dists</span><span class="p">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plt</span><span class="p">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="p">[</span><span class="n">plt</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">samples</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)]</span>
<span class="n">plt</span><span class="p">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">"X"</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">"y"</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="/images/GP-Kernels_files/GP-Kernels_121_0.png" alt="png" /></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">50</span><span class="p">),</span> <span class="n">np</span><span class="p">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="n">X2</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">x1</span><span class="p">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">150</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">x2</span><span class="p">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">150</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">ls</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.2</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">]</span>
<span class="n">kernel</span> <span class="o">=</span> <span class="n">ExpQuad</span><span class="p">(</span><span class="n">tf</span><span class="p">.</span><span class="n">constant</span><span class="p">(</span><span class="n">ls</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="p">.</span><span class="n">float64</span><span class="p">),</span> <span class="n">ARD</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="n">k</span> <span class="o">=</span> <span class="n">ScaledCov</span><span class="p">(</span><span class="n">kernel</span><span class="o">=</span><span class="n">kernel</span><span class="p">,</span> <span class="n">scaling_fn</span><span class="o">=</span><span class="n">logistic</span><span class="p">,</span> <span class="n">fn_args</span><span class="o">=</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">),</span> <span class="n">ARD</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

<span class="n">plot_cov_matrix</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">X2</span><span class="p">,</span> <span class="p">[</span><span class="n">ls</span><span class="p">],</span> <span class="p">[</span><span class="s">"$</span><span class="se">\\</span><span class="s">ell$"</span><span class="p">])</span>
</code></pre></div></div>

<p><img src="/images/GP-Kernels_files/GP-Kernels_122_0.png" alt="png" /></p>

<h3 id="warped-input-kernel">Warped Input Kernel</h3>

<p>This kernel transforms the input using a transformation function and uses it instead to evaluate the covariance matrix. This is also called <code class="language-plaintext highlighter-rouge">FeatureTransformed</code> kernel. It’s mathematical form is</p>

\[k'(x,x') = k(f(x), f(x'))\]

<p>where $f(.)$ is a warping (transformation) function.</p>

<p>Its signature in PyMC4 is</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">k</span> <span class="o">=</span> <span class="n">WarpedInput</span><span class="p">(</span><span class="n">kernel</span><span class="p">,</span> <span class="n">warp_fn</span><span class="p">,</span> <span class="n">fn_args</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>
</code></pre></div></div>

<p>It expects the signature of function <code class="language-plaintext highlighter-rouge">warp_fn</code> to be:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">warp_fn</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">array_like</span><span class="p">,</span> <span class="o">*</span><span class="n">fn_args</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">array_like</span><span class="p">:</span>
    <span class="p">...</span>
</code></pre></div></div>

<p>Below is an example of constructing a <code class="language-plaintext highlighter-rouge">Periodic</code> kernel using the warped input kernel!</p>

<h4 id="notes-2">Notes</h4>

<p>This kernel doesn’t perform argument validation even if <code class="language-plaintext highlighter-rouge">validate_args=True</code>.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">mapping</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">T</span><span class="p">):</span>
    <span class="n">c</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="n">pi</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="n">T</span><span class="p">)</span>
    <span class="n">u</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">concat</span><span class="p">((</span><span class="n">tf</span><span class="p">.</span><span class="n">math</span><span class="p">.</span><span class="n">sin</span><span class="p">(</span><span class="n">c</span> <span class="o">*</span> <span class="n">x</span><span class="p">),</span> <span class="n">tf</span><span class="p">.</span><span class="n">math</span><span class="p">.</span><span class="n">cos</span><span class="p">(</span><span class="n">c</span> <span class="o">*</span> <span class="n">x</span><span class="p">)),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">u</span>


<span class="n">T</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">constant</span><span class="p">(</span><span class="mf">0.6</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="p">.</span><span class="n">float64</span><span class="p">)</span>
<span class="n">ls</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">constant</span><span class="p">(</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="p">.</span><span class="n">float64</span><span class="p">)</span>

<span class="n">kernel</span> <span class="o">=</span> <span class="n">ExpQuad</span><span class="p">(</span><span class="n">ls</span><span class="p">,</span> <span class="n">ARD</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="n">k</span> <span class="o">=</span> <span class="n">WarpedInput</span><span class="p">(</span><span class="n">kernel</span><span class="o">=</span><span class="n">kernel</span><span class="p">,</span> <span class="n">warp_fn</span><span class="o">=</span><span class="n">mapping</span><span class="p">,</span> <span class="n">fn_args</span><span class="o">=</span><span class="p">(</span><span class="n">T</span><span class="p">,),</span> <span class="n">ARD</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">400</span><span class="p">)[:,</span> <span class="bp">None</span><span class="p">]</span>
<span class="n">covs</span> <span class="o">=</span> <span class="n">stabilize</span><span class="p">(</span><span class="n">k</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">),</span> <span class="n">shift</span><span class="o">=</span><span class="mf">1e-8</span><span class="p">)</span>
<span class="n">dists</span> <span class="o">=</span> <span class="n">pm</span><span class="p">.</span><span class="n">MvNormal</span><span class="p">(</span><span class="s">"_"</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">covariance_matrix</span><span class="o">=</span><span class="n">covs</span><span class="p">)</span>
<span class="n">samples</span> <span class="o">=</span> <span class="n">dists</span><span class="p">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plt</span><span class="p">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="p">[</span><span class="n">plt</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">samples</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)]</span>
<span class="n">plt</span><span class="p">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">"X"</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">"y"</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="/images/GP-Kernels_files/GP-Kernels_126_0.png" alt="png" /></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">50</span><span class="p">),</span> <span class="n">np</span><span class="p">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="n">X2</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">x1</span><span class="p">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">150</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">x2</span><span class="p">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">150</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">ls</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">constant</span><span class="p">([</span><span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="p">.</span><span class="n">float64</span><span class="p">)</span>
<span class="n">kernel</span> <span class="o">=</span> <span class="n">ExpQuad</span><span class="p">(</span><span class="n">ls</span><span class="p">,</span> <span class="n">ARD</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="n">k</span> <span class="o">=</span> <span class="n">WarpedInput</span><span class="p">(</span><span class="n">kernel</span><span class="o">=</span><span class="n">kernel</span><span class="p">,</span> <span class="n">warp_fn</span><span class="o">=</span><span class="n">mapping</span><span class="p">,</span> <span class="n">fn_args</span><span class="o">=</span><span class="p">(</span><span class="n">T</span><span class="p">,),</span> <span class="n">ARD</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

<span class="n">plot_cov_matrix</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">X2</span><span class="p">,</span> <span class="p">[</span><span class="n">ls</span><span class="p">],</span> <span class="p">[</span><span class="s">"$</span><span class="se">\\</span><span class="s">ell$"</span><span class="p">])</span>
</code></pre></div></div>

<p><img src="/images/GP-Kernels_files/GP-Kernels_127_0.png" alt="png" /></p>

<h2 id="combinations-of-kernel">Combinations of Kernel</h2>

<p>PyMC4 allows combinations of kernels to generate new kernels. This can be very helpful to construct new kernels that aren’t directly imlemented in PyMC4. This includes</p>

<ul>
  <li><a href="#Locally-Periodic-Kernel">Locally Periodic Kernel.</a></li>
  <li><a href="#Changepoint-Kernel">Changepoint Kernel.</a></li>
</ul>

<p>This section shows how to use both addition and multiplication on kernels.</p>

<h3 id="locally-periodic-kernel">Locally Periodic Kernel</h3>

<p>Locally Periodic kernel is a product of the <code class="language-plaintext highlighter-rouge">ExpQuad</code> and periodic kernel. Its mathematical formula is</p>

\[k_{\textrm{LocalPer}}(x, x') = k_{\textrm{Per}}(x, x')k_{\textrm{SE}}(x, x') = \sigma^2\exp\left(-\frac{2\sin^2(\frac{\pi|x - x'|}{T})}{\ell^2}\right) \exp\left(-\frac{\|x - x'\|^2}{2\ell^2}\right)\]

<p>It can be impemented in PyMC4 using the product <code class="language-plaintext highlighter-rouge">*</code> operator.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">k</span> <span class="o">=</span> <span class="n">ExpQuad</span><span class="p">(</span><span class="n">length_scale</span><span class="p">,</span> <span class="n">amplitude</span><span class="p">,</span> <span class="p">...)</span> <span class="o">*</span> <span class="n">Periodic</span><span class="p">(</span><span class="n">length_scale</span><span class="p">,</span> <span class="n">amplitude</span><span class="p">,</span> <span class="n">period</span><span class="p">,</span> <span class="p">...)</span>
</code></pre></div></div>

<p>This new kernel <code class="language-plaintext highlighter-rouge">k</code> has all the methods that other covariance functions have.</p>

<h4 id="example-1-5">Example 1</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ls</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">constant</span><span class="p">([</span><span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="p">.</span><span class="n">float64</span><span class="p">)</span>
<span class="n">amp</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">constant</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="p">.</span><span class="n">float64</span><span class="p">)</span>

<span class="n">k1</span> <span class="o">=</span> <span class="n">ExpQuad</span><span class="p">(</span><span class="n">length_scale</span><span class="o">=</span><span class="n">ls</span><span class="p">,</span> <span class="n">amplitude</span><span class="o">=</span><span class="n">amp</span><span class="p">,</span> <span class="n">ARD</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

<span class="n">periods</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">constant</span><span class="p">([</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="p">.</span><span class="n">float64</span><span class="p">)</span>

<span class="n">k2</span> <span class="o">=</span> <span class="n">Periodic</span><span class="p">(</span><span class="n">length_scale</span><span class="o">=</span><span class="n">ls</span><span class="p">,</span> <span class="n">amplitude</span><span class="o">=</span><span class="n">amp</span><span class="p">,</span> <span class="n">period</span><span class="o">=</span><span class="n">periods</span><span class="p">,</span> <span class="n">ARD</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

<span class="n">k</span> <span class="o">=</span> <span class="n">k1</span> <span class="o">*</span> <span class="n">k2</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="mi">500</span><span class="p">)[:,</span> <span class="n">np</span><span class="p">.</span><span class="n">newaxis</span><span class="p">]</span>

<span class="n">covs</span> <span class="o">=</span> <span class="n">stabilize</span><span class="p">(</span><span class="n">k</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">),</span> <span class="n">shift</span><span class="o">=</span><span class="mf">1e-8</span><span class="p">)</span>
<span class="n">dists</span> <span class="o">=</span> <span class="n">pm</span><span class="p">.</span><span class="n">MvNormal</span><span class="p">(</span><span class="s">"_"</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">covariance_matrix</span><span class="o">=</span><span class="n">covs</span><span class="p">)</span>
<span class="n">samples</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">dists</span><span class="p">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">perm</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plot_samples</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">samples</span><span class="p">,</span> <span class="p">[</span><span class="n">ls</span><span class="p">,</span> <span class="n">amp</span><span class="p">,</span> <span class="n">periods</span><span class="p">],</span> <span class="p">[</span><span class="s">"$</span><span class="se">\\</span><span class="s">ell$"</span><span class="p">,</span> <span class="s">"$</span><span class="se">\\</span><span class="s">sigma$"</span><span class="p">,</span> <span class="s">"$T$"</span><span class="p">])</span>
</code></pre></div></div>

<p><img src="/images/GP-Kernels_files/GP-Kernels_133_0.png" alt="png" /></p>

<h4 id="example-2-5">Example 2</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ls</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">constant</span><span class="p">([</span><span class="mf">1.4</span><span class="p">,</span> <span class="mf">1.4</span><span class="p">,</span> <span class="mf">1.4</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="p">.</span><span class="n">float64</span><span class="p">)</span>
<span class="n">amp</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">constant</span><span class="p">([</span><span class="mf">2.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="p">.</span><span class="n">float64</span><span class="p">)</span>

<span class="n">k1</span> <span class="o">=</span> <span class="n">ExpQuad</span><span class="p">(</span><span class="n">length_scale</span><span class="o">=</span><span class="n">ls</span><span class="p">,</span> <span class="n">amplitude</span><span class="o">=</span><span class="n">amp</span><span class="p">,</span> <span class="n">ARD</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

<span class="n">periods</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">constant</span><span class="p">([</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="p">.</span><span class="n">float64</span><span class="p">)</span>

<span class="n">k2</span> <span class="o">=</span> <span class="n">Periodic</span><span class="p">(</span><span class="n">length_scale</span><span class="o">=</span><span class="n">ls</span><span class="p">,</span> <span class="n">amplitude</span><span class="o">=</span><span class="n">amp</span><span class="p">,</span> <span class="n">period</span><span class="o">=</span><span class="n">periods</span><span class="p">,</span> <span class="n">ARD</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

<span class="n">k</span> <span class="o">=</span> <span class="n">k1</span> <span class="o">*</span> <span class="n">k2</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="mi">500</span><span class="p">)[:,</span> <span class="n">np</span><span class="p">.</span><span class="n">newaxis</span><span class="p">]</span>

<span class="n">covs</span> <span class="o">=</span> <span class="n">stabilize</span><span class="p">(</span><span class="n">k</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">),</span> <span class="n">shift</span><span class="o">=</span><span class="mf">1e-8</span><span class="p">)</span>
<span class="n">dists</span> <span class="o">=</span> <span class="n">pm</span><span class="p">.</span><span class="n">MvNormal</span><span class="p">(</span><span class="s">"_"</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">covariance_matrix</span><span class="o">=</span><span class="n">covs</span><span class="p">)</span>
<span class="n">samples</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">dists</span><span class="p">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">perm</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plot_samples</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">samples</span><span class="p">,</span> <span class="p">[</span><span class="n">ls</span><span class="p">,</span> <span class="n">amp</span><span class="p">,</span> <span class="n">periods</span><span class="p">],</span> <span class="p">[</span><span class="s">"$</span><span class="se">\\</span><span class="s">ell$"</span><span class="p">,</span> <span class="s">"$</span><span class="se">\\</span><span class="s">sigma$"</span><span class="p">,</span> <span class="s">"$T$"</span><span class="p">])</span>
</code></pre></div></div>

<p><img src="/images/GP-Kernels_files/GP-Kernels_137_0.png" alt="png" /></p>

<h3 id="changepoint-kernel">Changepoint Kernel</h3>

<p>The <code class="language-plaintext highlighter-rouge">ScaledCov</code> kernel can be used to create the <code class="language-plaintext highlighter-rouge">Changepoint</code> covariance. This covariance models a process that gradually transitions from one type of behavior to another.</p>

<p>The changepoint kernel is given by</p>

\[k(x,x') = \phi(x)k_1(x,x')\phi(x') + (1-\phi(x))k_2(x,x')(1-\phi(x'))\]

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">logistic</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">x0</span><span class="p">):</span>
    <span class="c1"># a is the slope, x0 is the location
</span>    <span class="k">return</span> <span class="n">tf</span><span class="p">.</span><span class="n">sigmoid</span><span class="p">(</span><span class="n">a</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">x0</span><span class="p">))</span>


<span class="n">a</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">constant</span><span class="p">(</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="p">.</span><span class="n">float64</span><span class="p">)</span>
<span class="n">x0</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">constant</span><span class="p">(</span><span class="mf">5.0</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="p">.</span><span class="n">float64</span><span class="p">)</span>

<span class="n">k1</span> <span class="o">=</span> <span class="n">ScaledCov</span><span class="p">(</span>
    <span class="n">kernel</span><span class="o">=</span><span class="n">ExpQuad</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">(</span><span class="mf">0.2</span><span class="p">),</span> <span class="n">ARD</span><span class="o">=</span><span class="bp">False</span><span class="p">),</span>
    <span class="n">scaling_fn</span><span class="o">=</span><span class="n">logistic</span><span class="p">,</span>
    <span class="n">fn_args</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="n">a</span><span class="p">,</span> <span class="n">x0</span><span class="p">),</span>
    <span class="n">ARD</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">k2</span> <span class="o">=</span> <span class="n">ScaledCov</span><span class="p">(</span>
    <span class="n">kernel</span><span class="o">=</span><span class="n">Cosine</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">(</span><span class="mf">0.5</span><span class="p">),</span> <span class="n">ARD</span><span class="o">=</span><span class="bp">False</span><span class="p">),</span>
    <span class="n">scaling_fn</span><span class="o">=</span><span class="n">logistic</span><span class="p">,</span>
    <span class="n">fn_args</span><span class="o">=</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">x0</span><span class="p">),</span>
    <span class="n">ARD</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">k</span> <span class="o">=</span> <span class="n">k1</span> <span class="o">+</span> <span class="n">k2</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">400</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">plt</span><span class="p">.</span><span class="n">fill_between</span><span class="p">(</span>
    <span class="n">x</span><span class="p">,</span>
    <span class="n">np</span><span class="p">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">400</span><span class="p">),</span>
    <span class="n">logistic</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="o">-</span><span class="n">a</span><span class="p">,</span> <span class="n">x0</span><span class="p">),</span>
    <span class="n">label</span><span class="o">=</span><span class="s">"ExpQuad region"</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s">"slateblue"</span><span class="p">,</span>
    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">fill_between</span><span class="p">(</span>
    <span class="n">x</span><span class="p">,</span>
    <span class="n">np</span><span class="p">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">400</span><span class="p">),</span>
    <span class="n">logistic</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">x0</span><span class="p">),</span>
    <span class="n">label</span><span class="o">=</span><span class="s">"Cosine region"</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s">"firebrick"</span><span class="p">,</span>
    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="p">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">"X"</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">"$\phi(x)$"</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">title</span><span class="p">(</span><span class="s">"The two scaling functions"</span><span class="p">);</span>
</code></pre></div></div>

<p><img src="/images/GP-Kernels_files/GP-Kernels_140_0.png" alt="png" /></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">covs</span> <span class="o">=</span> <span class="n">stabilize</span><span class="p">(</span><span class="n">k</span><span class="p">(</span><span class="n">x</span><span class="p">[:,</span> <span class="bp">None</span><span class="p">],</span> <span class="n">x</span><span class="p">[:,</span> <span class="bp">None</span><span class="p">]),</span> <span class="n">shift</span><span class="o">=</span><span class="mf">1e-8</span><span class="p">)</span>
<span class="n">dists</span> <span class="o">=</span> <span class="n">pm</span><span class="p">.</span><span class="n">MvNormal</span><span class="p">(</span><span class="s">"_"</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">covariance_matrix</span><span class="o">=</span><span class="n">covs</span><span class="p">)</span>
<span class="n">samples</span> <span class="o">=</span> <span class="n">dists</span><span class="p">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plt</span><span class="p">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="p">[</span><span class="n">plt</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">samples</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)]</span>
<span class="n">plt</span><span class="p">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">"X"</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">"y"</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="/images/GP-Kernels_files/GP-Kernels_142_0.png" alt="png" /></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">%</span><span class="n">load_ext</span> <span class="n">watermark</span>
<span class="o">%</span><span class="n">watermark</span> <span class="o">-</span><span class="n">n</span> <span class="o">-</span><span class="n">u</span> <span class="o">-</span><span class="n">v</span> <span class="o">-</span><span class="n">iv</span> <span class="o">-</span><span class="n">w</span>
</code></pre></div></div>

<pre><code class="language-none">pymc4      4.0a2
numpy      1.18.5
tensorflow 2.3.0-dev20200608
arviz      0.8.3
last updated: Thu Jul 02 2020 

CPython 3.7.3
IPython 7.15.0
watermark 2.0.2
</code></pre>

<h2 id="references">References</h2>

<ul>
  <li><a href="https://scikit-learn.org/stable/modules/generated/sklearn.gaussian_process.kernels.Matern.html">SciKit-Learn Matern Kernels Documentation</a></li>
  <li><a href="https://www.cs.toronto.edu/~duvenaud/cookbook/">The Kernel Cookbook by David Duvenaud</a></li>
  <li><a href="https://github.com/pymc-devs/pymc3/blob/master/docs/source/notebooks/GP-MeansAndCovs.ipynb">PyMC3’s GP submodule</a></li>
</ul>


        
      </section>

      <footer class="page__meta">
        
        


  




  
  
  

  <p class="page__taxonomy">
    <strong><i class="fa fa-fw fa-tags" aria-hidden="true"></i> Tags: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="http://localhost:4000/tags/#gaussian-processes" class="page__taxonomy-item" rel="tag">Gaussian Processes</a><span class="sep">, </span>
    
      
      
      <a href="http://localhost:4000/tags/#gsoc-2020" class="page__taxonomy-item" rel="tag">GSoC 2020</a><span class="sep">, </span>
    
      
      
      <a href="http://localhost:4000/tags/#machine-learning" class="page__taxonomy-item" rel="tag">Machine Learning</a>
    
    </span>
  </p>




  






  
  
  

  <p class="page__taxonomy">
    <strong><i class="fa fa-fw fa-folder-open" aria-hidden="true"></i> Categories: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="http://localhost:4000/categories/#gaussian-processes" class="page__taxonomy-item" rel="tag">Gaussian Processes</a><span class="sep">, </span>
    
      
      
      <a href="http://localhost:4000/categories/#gsoc-2020" class="page__taxonomy-item" rel="tag">GSoC 2020</a><span class="sep">, </span>
    
      
      
      <a href="http://localhost:4000/categories/#machine-learning" class="page__taxonomy-item" rel="tag">Machine Learning</a>
    
    </span>
  </p>


      </footer>

      

      


  <nav class="pagination">
    
      <a href="http://localhost:4000/gsoc2020/writing-notebooks-on-gp-kernels" class="pagination--pager" title="GSoC Week 4 - Writing Notebooks on GP Kernels!
">Previous</a>
    
    
      <a href="http://localhost:4000/gsoc2020/gsoc-phase-1-summary" class="pagination--pager" title="GSoC’20 Phase 1 Report
">Next</a>
    
  </nav>

    </div>

    
      

<div class="page__comments">
  
  
</div>
    
  </article>

  
  
</div>


    <div class="page__footer">
      <footer>
        <!-- start custom footer snippets -->
<a href="/sitemap/">Sitemap</a>
<!-- end custom footer snippets -->

        

<div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>Follow:</strong></li>
    
    
    
    
      <li><a href="http://github.com/tirthasheshpatel"><i class="fab fa-github" aria-hidden="true"></i> GitHub</a></li>
    
    
    <li><a href="http://localhost:4000/feed.xml"><i class="fa fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2020 Tirth Patel. Powered by <a href="http://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://github.com/academicpages/academicpages.github.io">AcademicPages</a>, a fork of <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    <script src="http://localhost:4000/assets/js/main.min.js"></script>




  <script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-161186729-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>










  </body>
</html>

